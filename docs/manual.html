<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="keywords" content="forth, 6502, assembler, programming, 8-bit, vintage, retro">
<meta name="author" content="Sam Colwell, Scot W. Stevenson">
<title>Manual for Tali Forth 2 for the 65c02</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Manual for Tali Forth 2 for the 65c02</h1>
<div class="details">
<span id="author" class="author">Sam Colwell</span><br>
<span id="author2" class="author">Scot W. Stevenson</span><br>
<span id="revnumber">version 1.0,</span>
<span id="revdate">03. Jan 2019</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_dedication">Dedication</a></li>
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel1">
<li><a href="#_but_why">But why?</a>
<ul class="sectlevel2">
<li><a href="#_the_big_picture">The Big Picture</a></li>
<li><a href="#_forth">Forth</a></li>
<li><a href="#_writing_your_own_forth">Writing Your Own Forth</a></li>
</ul>
</li>
<li><a href="#_overview_of_tali_forth">Overview of Tali Forth</a>
<ul class="sectlevel2">
<li><a href="#_design_considerations">Design Considerations</a></li>
<li><a href="#_deeper_down_the_rabbit_hole">Deeper down the rabbit hole</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_user_guide">User Guide</a>
<ul class="sectlevel1">
<li><a href="#_installing_tali_forth">Installing Tali Forth</a>
<ul class="sectlevel2">
<li><a href="#_downloading">Downloading</a></li>
<li><a href="#_running">Running</a></li>
<li><a href="#_installing_on_your_own_hardware">Installing on Your Own Hardware</a></li>
<li><a href="#_hardware_projects_with_tali_forth_2">Hardware Projects with Tali Forth 2</a></li>
</ul>
</li>
<li><a href="#_running_tali_forth">Running Tali Forth</a>
<ul class="sectlevel2">
<li><a href="#_booting">Booting</a></li>
<li><a href="#_command_line_history">Command-Line History</a></li>
<li><a href="#_words">Words</a></li>
<li><a href="#_wordlists_and_search_order">Wordlists and Search Order</a></li>
<li><a href="#_native_compiling">Native Compiling</a></li>
<li><a href="#_underflow_detection">Underflow Detection</a></li>
<li><a href="#_restarting">Restarting</a></li>
<li><a href="#_gotchas">Gotchas</a></li>
</ul>
</li>
<li><a href="#_major_components">Major Components</a>
<ul class="sectlevel2">
<li><a href="#_blocks">Blocks</a></li>
<li><a href="#_the_block_editor">The Block Editor</a></li>
<li><a href="#_the_line_based_editor_code_ed_code">The Line-Based Editor <code>ed</code></a></li>
<li><a href="#_the_assembler">The Assembler</a></li>
<li><a href="#_the_disassembler">The Disassembler</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_developer_guide">Developer Guide</a>
<ul class="sectlevel1">
<li><a href="#_how_tali_forth_works">How Tali Forth Works</a>
<ul class="sectlevel2">
<li><a href="#_memory_map">Memory Map</a></li>
<li><a href="#_the_data_stack">The Data Stack</a></li>
<li><a href="#_dictionary">Dictionary</a></li>
<li><a href="#_input">Input</a></li>
<li><a href="#_the_words_code_create_code_and_code_does_code">The Words <code>create</code> and <code>does&gt;</code></a></li>
<li><a href="#_control_flow">Control Flow</a></li>
<li><a href="#_native_compiling_2">Native Compiling</a></li>
<li><a href="#_code_cmove_code_code_cmove_code_and_code_move_code"><code>cmove</code>, <code>cmove&gt;</code> and <code>move</code></a></li>
</ul>
</li>
<li><a href="#_developing">Developing</a>
<ul class="sectlevel2">
<li><a href="#_adding_new_words">Adding New Words</a></li>
<li><a href="#_deeper_changes">Deeper Changes</a></li>
<li><a href="#_converting_forth_to_assembly">Converting Forth to Assembly</a></li>
<li><a href="#_code_cheat_sheets">Code Cheat Sheets</a></li>
</ul>
</li>
<li><a href="#_future_and_long_term_plans">Future and Long-Term plans</a></li>
</ul>
</li>
<li><a href="#_tutorials">Tutorials</a>
<ul class="sectlevel1">
<li><a href="#_working_with_blocks">Working with Blocks</a>
<ul class="sectlevel2">
<li><a href="#_first_steps_with_blocks">First steps with blocks</a></li>
<li><a href="#_editing_a_screen">Editing a screen</a></li>
<li><a href="#_working_with_blocks_2">Working with blocks</a></li>
<li><a href="#_storing_binary_data_in_blocks">Storing Binary Data in Blocks</a></li>
</ul>
</li>
<li><a href="#_the_code_ed_code_line_based_editor_a_id_ed_tutorial_a">The <code>ed</code> Line-Based Editor<a id="ed-tutorial"></a></a>
<ul class="sectlevel2">
<li><a href="#_first_steps_with_code_ed_code">First steps with <code>ed</code></a></li>
<li><a href="#_saving_your_text">Saving Your Text</a></li>
<li><a href="#_getting_out_of_code_ed_code">Getting Out of <code>ed</code></a></li>
<li><a href="#_programming_with_code_ed_code">Programming with <code>ed</code></a></li>
<li><a href="#_further_information">Further Information</a></li>
</ul>
</li>
<li><a href="#_wordlists_and_the_search_order">Wordlists and the Search Order</a>
<ul class="sectlevel2">
<li><a href="#_using_the_built_in_wordlists">Using the built-in wordlists</a></li>
<li><a href="#_making_new_wordlists">Making New Wordlists</a></li>
<li><a href="#_older_vocabulatory_words">Older Vocabulatory Words</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_appendix">Appendix</a>
<ul class="sectlevel1">
<li><a href="#_glossary">Glossary</a></li>
<li><a href="#_reporting_problems">Reporting Problems</a></li>
<li><a href="#_faq">FAQ</a></li>
<li><a href="#_testing_tali_forth_2">Testing Tali Forth 2</a>
<ul class="sectlevel2">
<li><a href="#_user_tests">User Tests</a></li>
<li><a href="#_cycle_tests">Cycle Tests</a></li>
<li><a href="#_old_tests">Old Tests</a></li>
</ul>
</li>
<li><a href="#_the_simpler_assembler_notation_san_format">The Simpler Assembler Notation (SAN) format</a>
<ul class="sectlevel2">
<li><a href="#_background">Background</a></li>
<li><a href="#_complete_list_of_65c02_addressing_modes">Complete list of 65c02 addressing modes</a></li>
</ul>
</li>
<li><a href="#_thanks">Thanks</a></li>
<li><a href="#_references_and_further_reading">References and Further Reading</a></li>
<li><a href="#_colophon">Colophon</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Tali Forth 2 is a bare-metal ANS(ish) Forth for the 65c02 8-bit MPU. It aims
to be, roughly in order of importance, easy to try out (just run the included
binary), simple (subroutine threading model), specific (for the 65c02 only), and
standardized (ANS Forth).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dedication">Dedication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For the crew at 6502.org, who made this possible in more ways than one.</p>
</div>
</div>
</div>
<h1 id="_introduction" class="sect0">Introduction</h1>
<div class="sect1">
<h2 id="_but_why">But why?</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
Forth is well suited to resource-constrained situations. It doesn&#8217;t need lots
of memory and doesn&#8217;t have much overhead. <a href="#CHM1">[CHM1]</a>
</blockquote>
<div class="attribution">
&#8212; Charles H. Moore<br>
<cite>redgate Hub 2009</cite>
</div>
</div>
<div class="sect2">
<h3 id="_the_big_picture">The Big Picture</h3>
<div class="paragraph">
<p>This section provides background information on Forth, the 6502 processor, and
why anybody would want to combine the two. It can be skipped if you already know
all those things.</p>
</div>
<div class="sect3">
<h4 id="_the_6502_cpu">The 6502 CPU</h4>
<div class="paragraph">
<p>It is a well-established fact that humanity reached the apex of processor design
with the 6502 in 1976.</p>
</div>
<div id="img_65c02" class="imageblock" style="float: left">
<div class="content">
<img src="pics/W65c02.jpg" alt="W65c02">
</div>
<div class="title">Figure 1. by Anthony King, public domain</div>
</div>
<div class="paragraph">
<p>Created by a team including Chuck Peddle and Bill
Mensch, it was the engine that powered the 8-bit home
computer revolution of the 1980s.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup> The
VIC-20, Commodore PET, Apple II,
and Atari 800 all used the 6502, among others.</p>
</div>
<div class="paragraph">
<p>More than 40 years later, the processor is still in production by the
<a href="http://www.westerndesigncenter.com/wdc/w65c02s-chip.cfm">Western Design
Center</a>. Apart from commercial uses, there is an active hobbyist scene
centered on the website <a href="http://6502.org/">6502.org</a>. A
number of people have built their own 8-bit computers based on this chip and
the instructions there, including a
<a href="http://wilsonminesco.com/6502primer/">primer</a> by Garth Wilson. It is for these systems that Tali Forth 2 was created.</p>
</div>
<div class="paragraph">
<p>The most important variant of the 6502 produced today is the
<a href="https://en.wikipedia.org/wiki/WDC\_65C02">65c02</a>, a CMOS chip with
some additional instructions. It is for this chip that Tali Forth 2 was written.</p>
</div>
<div class="paragraph">
<p>But why program in 8-bit assembler at all? The 65c02 is fun to work with
because of its clean instruction set architecture (ISA) This is not the place to explain the joys of assembler.
The official handbook for the 65c02 is <em>Programming the 65816</em> <a href="#EnL">[EnL]</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Garth  Wilson answers this question in greater
detail as part of his 6502 primer at <a href="http://wilsonminesco.com/6502primer/" class="bare">http://wilsonminesco.com/6502primer/</a> .
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_forth">Forth</h3>
<div class="quoteblock">
<blockquote>
If C gives you enough rope to hang yourself, Forth is a flamethrower crawling with
cobras. <a href="#EW">[EW]</a>
</blockquote>
<div class="attribution">
&#8212; Elliot Williams<br>
<cite>Forth: The Hacker's language</cite>
</div>
</div>
<div class="paragraph">
<p>Forth is the <em>enfant terrible</em> of programming languages. It was
invented by Charles "Chuck" H. Moore in the 1960s to do
work with radio astronomy, way before there were modern operating systems or
programming languages.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A brief history of Forth can be found at
<a href="https://www.forth.com/resources/forth-programming-language" class="bare">https://www.forth.com/resources/forth-programming-language</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As a language for people who actually need to get things done, it lets you run
with scissors, play with fire, and cut corners until you&#8217;ve turned a square
into a circle. Forth is not for the faint-hearted: It is trivial, for
instance, to redefine <code>1</code> as <code>2</code> and <code>true</code> as <code>false</code>. Though you can do really,
really clever things with few lines of code, the result can be hard for other
people to understand, leading to the reputation of Forth begin a "write-only
language". However, Forth excels when you positively, absolutely have to get
something done with hardware that is really too weak for the job.</p>
</div>
<div class="paragraph">
<p>It should be no surprise that NASA is one of the organizations that
uses Forth. The <em>Cassini</em> mission to Saturn used a
<a href="http://www.cpushack.com/2013/02/21/charles-moore-forth-stack-processors/">Forth
CPU</a>, for instance. It is also perfect for small computers like the 8-bit
65c02. After a small boom in the 1980s, more powerful computers led to a
decline of the language. The "Internet of Things" (IOT)  with embedded small processors has led to a certain amount of
<a href="https://www.embedded.com/design/programming-languages-and-tools/4431133/Go-Forth-">renewed
interest</a> in the language. It helps that Forth is easy to implement: It is
stack-based, uses Reverse Polish Notation (RPN)
and a simple threaded interpreter model.</p>
</div>
<div class="paragraph">
<p>There is no way this document can provide an adequate introduction to Forth.
There are quite a number of tutorials, however, such as <em>A Beginner&#8217;s Guide to
Forth</em> by J.V. Nobel <a href="#JVN">[JVN]</a> or the classic (but slightly
dated) <em>Starting Forth</em> by Leo Brodie.<a href="#LB1">[LB1]</a>
Gforth, one of the more powerful free Forths, comes with its own
<a href="http://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Tutorial.html">tutorial</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Once you have understood the basics of the language, do yourself a favor
and read <em>Thinking Forth</em> by Brodie<a href="#LB2">[LB2]</a> which deals with
the philosophy of the language. Even if you never code a line of Forth in your
life, exposure to Forth will change the way you think about programming, much
like Lisp.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_writing_your_own_forth">Writing Your Own Forth</h3>
<div class="paragraph">
<p>Even if the 65c02 is great and Forth is brilliant, why go to the effort of
writing a new, bare-metal version of the languages? After almost 50 years,
shouldn&#8217;t there be a bunch of Forths around already?</p>
</div>
<div class="sect3">
<h4 id="_fig_forth">FIG Forth</h4>
<div class="paragraph">
<p>In fact, the classic Forth available for the whole group of 8-bit MPUs is FIG
Forth. "FIG" stands for "Forth Interest Group". Ported to various
architectures, it was original based on an incarnation for the 6502 written by
Bill Ragsdale and Robert Selzer.
There are PDFs of the <a href="http://www.forth.org/fig-forth/fig-forth\_6502.pdf">6502
version</a> from September 1980 freely available&#8201;&#8212;&#8201;there is a tradition of placing
Forth in the public domain&#8201;&#8212;&#8201;and more than one hobbyist has revised it to his
machine.</p>
</div>
<div class="paragraph">
<p>However, Forth has changed a lot in the past three decades. There is now a
standardized version called <a href="https://forth-standard.org/">ANS Forth</a>, which
includes very basic changes such as how the <code>do</code> loop works. Learning the
language with FIG Forth is like learning English with <em>The Canterbury
Tales</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_a_modern_forth_for_the_65c02">A Modern Forth for the 65c02</h4>
<div class="paragraph">
<p>Tali Forth was created to provide an easy to understand modern Forth written
especially for the 65c02 that anybody can understand, adapt to their own use,
and maybe actually work with. As part of that effort, the source code is heavily
commented and this document tries to explain the internals in more detail.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview_of_tali_forth">Overview of Tali Forth</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_design_considerations">Design Considerations</h3>
<div class="paragraph">
<p>When creating a new Forth, there are a bunch of design decisions to be
made.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Probably the best introduction to these questions is found in "Design
Decisions in the Forth Kernel" at
<a href="http://www.bradrodriguez.com/papers/moving1.htm" class="bare">http://www.bradrodriguez.com/papers/moving1.htm</a> by Brad Rodriguez.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Spoiler alert: Tali Forth is a subroutine-threaded (STC) variant with a 16-bit
cell size and a dictionary that keeps headers and code separate. If you don&#8217;t
care and just want to use the program, skip ahead.</p>
</div>
<div class="sect3">
<h4 id="_characteristics_of_the_65c02">Characteristics of the 65c02</h4>
<div class="paragraph">
<p>Since this is a bare-metal Forth, the most important consideration is the target
processor. The 65c02 only has one full register, the accumulator A, as well as
two secondary registers X and Y. All are 8-bit wide. There are 256 bytes that
are more easily addressable on the Zero Page. A single hardware stack is used
for subroutine jumps. The address bus is 16 bits wide for a maximum of 64 KiB of
RAM and ROM.</p>
</div>
<div class="paragraph">
<p>For the default setup, we assume 32 KiB of each, but allow this to be changed so
people can adapt Tali to their own hardware.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cell_size">Cell Size</h4>
<div class="paragraph">
<p>The 16-bit address bus suggests the cell size should be 16 bits as well. This is
still easy enough to realize on a 8-bit MPU.</p>
</div>
</div>
<div class="sect3">
<h4 id="_threading_technique">Threading Technique</h4>
<div class="paragraph">
<p>A "thread" in Forth is simply a list of addresses of words to be executed.
There are four basic threading techniques: <a href="#GK">[GK]</a></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Indirect threading (ITC)</dt>
<dd>
<p>The oldest, original variant, used by FIG Forth. All
other versions are modifications of this model.</p>
</dd>
<dt class="hdlist1">Direct threading (DTC)</dt>
<dd>
<p>Includes more assembler code to speed things up, but
slightly larger than ITC.</p>
</dd>
<dt class="hdlist1">Token threading (TTC)</dt>
<dd>
<p>The reverse of DTC in that it is slower, but uses less
space than the other Forths. Words are created as a table of tokens.</p>
</dd>
<dt class="hdlist1">Subroutine threading (STC)</dt>
<dd>
<p>Converts the words to a simple
series of <code>jsr</code> combinations. Easy to understand and less complex than the other
variants, but uses more space and is slower.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Our lack of registers and the goal of creating a simple and easy to understand
Forth makes subroutine threading the most attractive solution, so Tali 2 is an
STC Forth. We try to mitigate the pain caused by the 12 cycle cost of each and
every <code>jsr</code>-<code>rts</code> combination by including a relatively high number of native
words.</p>
</div>
</div>
<div class="sect3">
<h4 id="_register_use">Register Use</h4>
<div class="paragraph">
<p>The lack of registers&#8201;&#8212;&#8201;and any registers larger than 8 bit at that&#8201;&#8212;&#8201;becomes
apparent when you realize that Forth classically uses at least four virtual
registers:</p>
</div>
<table class="tableblock frame-all grid-all">
<caption class="title">Table 1. The classic Forth registers</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Register</th>
<th class="tableblock halign-left valign-top">Name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Working Register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interpreter Pointer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Stack Pointer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RSP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return Stack Pointer</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>On a modern processor like a RISC-V RV32I with 32 registers of 32 bit each, none
of this would be a problem (in fact, we&#8217;d probably run out of ways to use the
registers). On the 65c02, at least we get the RSP for free with the built-in
stack pointer. This still leaves three registers. We cut that number down by one
through subroutine threading, which gets rid of the IP. For the DSP, we use the
65c02&#8217;s Zero Page indirect addressing mode with the X register. This leaves W,
which we put on the Zero Page as well.</p>
</div>
</div>
<div class="sect3">
<h4 id="_data_stack_design">Data Stack Design</h4>
<div class="paragraph">
<p>We&#8217;ll go into greater detail on how the Data Stack works in a later chapter
when we look at the internals. Briefly, the stack is realized on the Zero Page
for speed. For stability, we provide underflow checks in the relevant words, but
give the user the option of stripping it out for native compilation. There are
no checks for overflow because those cases tend to be rare.</p>
</div>
</div>
<div class="sect3">
<h4 id="_dictionary_structure">Dictionary Structure</h4>
<div class="paragraph">
<p>Each Forth word consists of the actual code and the header that holds the
meta-data. The headers are arranged as a simple single-linked list.</p>
</div>
<div class="paragraph">
<p>In contrast to Tali Forth 1, which kept the header and body of the words
together, Tali Forth 2 keeps them separate. This lets us play various tricks
with the code to make it more effective.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deeper_down_the_rabbit_hole">Deeper down the rabbit hole</h3>
<div class="paragraph">
<p>This concludes our overview of the basic Tali Forth 2 structure. For those
interested, a later chapter will provide far more detail.</p>
</div>
</div>
</div>
</div>
<h1 id="_user_guide" class="sect0">User Guide</h1>
<div class="sect1">
<h2 id="_installing_tali_forth">Installing Tali Forth</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_downloading">Downloading</h3>
<div class="paragraph">
<p>Tali Forth 2 lives on GitHub at
<a href="https://github.com/scotws/TaliForth2" class="bare">https://github.com/scotws/TaliForth2</a>. This is where you will always find the
current version. You can either clone the code with git or simply
download it. To just test Tali Forth, all you need is the binary file
<code>taliforth-py65mon.bin</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_running">Running</h3>
<div class="sect3">
<h4 id="_downloading_the_py65mon_simulator">Downloading the py65mon Simulator</h4>
<div class="paragraph">
<p>Tali was written to run out of the box on the py65mon simulator from
<a href="https://github.com/mnaberez/py65" class="bare">https://github.com/mnaberez/py65</a>. This is a Python
program that should run on various operating systems. Py65mon is also required
for the test suite.</p>
</div>
<div class="paragraph">
<p>To install py65mon on Linux, use one of the following commands</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Install for only your user:
pip install -U py65 --user

# Install for all users:
sudo pip install -U py65</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t have <code>pip</code> installed, you will have to add it first with
something like <code>sudo apt-get install python-pip</code> (Ubuntu Linux). There is a
<code>setup.py</code> script as part of the package.</p>
</div>
</div>
<div class="sect3">
<h4 id="_running_the_binary">Running the Binary</h4>
<div class="paragraph">
<p>To start the emulator, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">py65mon -m 65c02 -r taliforth-py65mon.bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the option <code>-m 65c02</code> is required, because Tali Forth makes extensive
use of the additional commands of the CMOS version and will not run on a stock
6502 MPU.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installing_on_your_own_hardware">Installing on Your Own Hardware</h3>
<div class="paragraph">
<p>The Tali Forth project started out as a way to run Forth on my own 65c02
computer, the bersquirrel. Though it soon developed a life of
its own, a central aim of the project is to provide a working, modern Forth that
people can install on their projects.</p>
</div>
<div id="img_uebersquirrel" class="imageblock">
<div class="content">
<img src="pics/uebersquirrel.jpg" alt="uebersquirrel" width="50%">
</div>
<div class="title">Figure 2. The functioning bersquirrel Mark Zero prototype, August 2013. Photo by Scot W. Stevenson</div>
</div>
<div class="sect3">
<h4 id="_the_platform_files">The Platform Files</h4>
<div class="paragraph">
<p>For this to work, you need to go to the <code>platform</code> folder and create your own
kernel code to replace <code>platform-py65mon.asm</code>, the default kernel
for use with the py65mon kernel. By convention, the name should
start with <code>platform-</code>. See the <code>README.md</code> file in the the <code>platform</code> folder
for details.</p>
</div>
<div class="paragraph">
<p>Once you have configured your platform file in the plaform folder, you
can build a binary (typically programmed into an EEPROM) for your
hardware with make.  If you made a platform file named
<code>platform-mycomp.asm</code>, then you should <code>cd</code> to the main Tali folder
and run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">make taliforth-mycomp.bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>The bin file will be created in the main folder.  You should, of
course, replace the "mycomp" portion of that command with whatever you
named your platform.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hardware_projects_with_tali_forth_2">Hardware Projects with Tali Forth 2</h3>
<div class="paragraph">
<p>This is a list of projects known to run Tali Forth 2. Please let me know if you
want to have your project added to the list.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Steckschwein</strong> (<a href="https://steckschwein.de/" class="bare">https://steckschwein.de/</a>) by Thomas Woinke and Marko
Lauke. A multi-board 8 MHz 65c02 system. Platform file:
<code>platform-steckschwein.asm</code> (26. Oct 2018)</p>
</li>
<li>
<p><strong>SamCo&#8217;s SBC</strong> (<a href="https://github.com/SamCoVT/SBC" class="bare">https://github.com/SamCoVT/SBC</a>) by Sam Colwell.  A
single-board computer running at 4MHz.  Platform file:
<code>platform-sbc.asm</code> (29. Oct 2018)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are various benchmarks of Tali Forth 2 running different hardware at <em>The
Ultimate Forth Benchmark</em> (<a href="https://theultimatebenchmark.org/#sec-7" class="bare">https://theultimatebenchmark.org/#sec-7</a>).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_tali_forth">Running Tali Forth</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
One doesn&#8217;t write programs in Forth. Forth is the program.
</blockquote>
<div class="attribution">
&#8212; Charles Moore<br>
<cite>Masterminds of Programming</cite>
</div>
</div>
<div class="sect2">
<h3 id="_booting">Booting</h3>
<div class="paragraph">
<p>Out of the box, Tali Forth boots a minimal kernel to connect to the
<code>py65mon</code>  simulator. By default, this stage ends with a line such
as</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Tali Forth 2 default kernel for py65mon (18. Feb 2018)</pre>
</div>
</div>
<div class="paragraph">
<p>When you port Tali Forth to your own hardware, you&#8217;ll have to include your own
kernel (and probably should print out a different line).</p>
</div>
<div class="paragraph">
<p>Tali Forth itself boots next, and after setting up various internal
things, compiles the high level words. This causes a slight delay, depending on
the number and length of these words. As the last step, Forth should spit out a
boot string like</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Tali Forth 2 for the 65c02
Version ALPHA 24. December 2018
Copyright 2014-2018 Scot W. Stevenson
Tali Forth 2 comes with absolutely NO WARRANTY
Type 'bye' to exit</pre>
</div>
</div>
<div class="paragraph">
<p>Because these are the last high-level commands Tali Forth executes, this
functions as a primitive self-test. If you have modified the high level Forth
words in either <code>forth_words.fs</code> or <code>user_words.fs</code>, the boot process might
fail with a variant of the error message "unknown word". The built-in, native
words should always work. For this <code>dump</code>  is a built-in word&#8201;&#8212;&#8201;it is very
useful for testing.</p>
</div>
</div>
<div class="sect2">
<h3 id="_command_line_history">Command-Line History</h3>
<div class="paragraph">
<p>Tali&#8217;s command line includes a simple, eight-element history function. To
access the previous entries, press <code>CONTROL-p</code>, to go forward to the next
entry, press <code>CONTROL-n</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_words">Words</h3>
<div class="paragraph">
<p>Tali Forth comes with the following Forth words out of the
box:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>order .wid drop dup swap ! @ over &gt;r r&gt; r@ nip rot -rot tuck , c@ c! +! execute
emit type . u. u.r .r d. d.r ud. ud.r ? false true space 0 1 2 2dup ?dup + - abs
dabs and or xor rshift lshift pick char [char] char+ chars cells cell+ here 1-
1+ 2* 2/ = &lt;&gt; &lt; u&lt; u&gt; &gt; 0= 0&lt;&gt; 0&gt; 0&lt; min max 2drop 2swap 2over 2! 2@ 2variable
2constant 2literal 2r@ 2r&gt; 2&gt;r invert negate dnegate c, bounds spaces bl
-trailing -leading /string refill accept input&gt;r r&gt;input unused depth key allot
create does&gt; variable constant value to s&gt;d d&gt;s d- d+ erase blank fill find-name
' ['] name&gt;int int&gt;name name&gt;string &gt;body defer latestxt latestnt parse-name
parse source source-id : ; :noname compile, [ ] literal sliteral ." s" s\"
postpone immediate compile-only never-native always-native allow-native nc-limit
strip-underflow abort abort" do ?do i j loop +loop exit unloop leave recurse
quit begin again state evaluate base digit? number &gt;number hex decimal count m*
um* * um/mod sm/rem fm/mod / /mod mod */mod */ \ move cmove&gt; cmove pad cleave
hexstore within &gt;in &lt;# # #s #&gt; hold sign output input cr page at-xy marker words
wordsize aligned align bell dump .s disasm compare search environment? find word
( .( if then else repeat until while case of endof endcase defer@ defer! is
action-of useraddr buffer: buffstatus buffblocknum blkbuffer scr blk block-write
block-write-vector block-read block-read-vector save-buffers block update buffer
empty-buffers flush load thru list block-ramdrive-init definitions wordlist
search-wordlist set-current get-current set-order get-order root-wordlist
assembler-wordlist editor-wordlist forth-wordlist only also previous &gt;order
forth see ed cold bye</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This list might be outdated. To get the current list, run <code>words</code> from
inside Tali Forth.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Though the list might look unsorted, it actually reflects the priority in the
dictionary, that is, which words are found first. For instance,
the native words &#8201;&#8212;&#8201;those coded in assembler&#8201;&#8212;&#8201;always start
with <code>drop</code> and end with <code>bye</code>. This is the last word that Tali will find in
the dictionary. <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</sup> The words before <code>drop</code> are those that are defined in high-level
Forth. For more information on individual the words, use the <code>see</code> command.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To find out if a given word is available, you can use the sequence
<code>s" myword" find-name 0&lt;&gt;</code> which will return a <code>true</code> or <code>false</code> flag.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the built-in words are lower case.  While Tali is not case sensitive&#8201;&#8212;&#8201;<code>KASUMI</code> is the same word as <code>Kasumi</code> &#8201;&#8212;&#8201;newly defined words will be
lowercased as they are created and entered into the dictionary.  There is a
slight speed advantage during lookup to using lowercase words (because Tali
doesn&#8217;t have to lowercase the entered text), so all of the tests for Tali are
in lowercase.</p>
</div>
<div class="sect3">
<h4 id="_the_ans_standard">The ANS Standard</h4>
<div class="paragraph">
<p>Tali Forth is orientated on ANS Forth, the standard defined by the American
National Standards Institute (ANSI). See
<a href="https://forth-standard.org/standard/alpha" class="bare">https://forth-standard.org/standard/alpha</a> for the complete list of ANS Forth
words.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gforth">Gforth</h4>
<div class="paragraph">
<p>Tali also adopted some words from Gforth such as <code>bounds</code> or <code>execute-parsing</code>.
In practical terms, Tali aims to be a subset of Gforth: If a program runs on
Tali, it should run on Gforth the same way or have a very good reason not to.
See <a href="https://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Word-Index.html" class="bare">https://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Word-Index.html</a> for
a complete list of Gforth words.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tali_specific_words">Tali-Specific Words</h4>
<div class="paragraph">
<p>In addition, there are words that are specific to Tali Forth.</p>
</div>
<div class="paragraph">
<p><strong>0 ( -- 0 )</strong> - Push the number 0 on the Data Stack. Having this as an actual
word speeds up processing because the interpreter doesn&#8217;t have to convert the
character "0" into the number <code>0</code>.</p>
</div>
<div class="paragraph">
<p><strong>1 ( -- 0 )</strong> - Push the number 1 on the Data Stack.</p>
</div>
<div class="paragraph">
<p><strong>2 ( -- 0 )</strong> - Push the number 2 on the Data Stack.</p>
</div>
<div class="paragraph">
<p><strong>allow-native ( -- )</strong> - Mark last word in dictionary to that it can be natively
compiled if it is less than or equal to nc-limit in size.</p>
</div>
<div class="paragraph">
<p><strong>always-native ( -- )</strong> - Mark last word in dictionary so that it is always natively compiled.</p>
</div>
<div class="paragraph">
<p><strong>bell ( -- )</strong> - Ring the terminal bell (ASCII 07).</p>
</div>
<div class="paragraph">
<p><strong>block-read ( addr blk# -- )</strong> - This is a vectored word the user can change to point
to their own routine for reading 1K blocks into memory from storage.</p>
</div>
<div class="paragraph">
<p><strong>block-read-vector ( -- addr )</strong> - This is the address of the vector
for block-read.  Save the xt of your word here.</p>
</div>
<div class="paragraph">
<p><strong>block-write ( addr blk# -- )</strong> - This is a vectored word the user can change to point
to their own routine for writing 1K blocks from memory to storage.</p>
</div>
<div class="paragraph">
<p><strong>block-write-vector ( -- addr )</strong> - This is the address of the vector
for block-write.  Save the xt of your word here.</p>
</div>
<div class="paragraph">
<p><strong>block-ramdrive-init ( u -- )</strong> - Create a RAM drive with the given number of
blocks (numbered 0 to (u-1)) to allow use of the block words with no additional
hardware.  Because the blocks are only held in RAM, they will be lost when the
hardware is powered down or the simulator is stopped.</p>
</div>
<div class="paragraph">
<p><strong>cleave ( addr u -- addr2 u2 addr1 u1 )</strong> - Given a block of character memory
with words separated by whitespace, split off the first sub-block and put it in
TOS and NOS.  Leave the rest lower down on the stack. This allows breaking off
single words (or zero-terminated strings in memory, with a different delimiter)
for further processing. Use with loops:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        : tokenize ( addr u -- )
            begin
                cleave
                cr type  \ &lt;-- processing of single word
            dup 0= until
            2drop ;</pre>
</div>
</div>
<div class="paragraph">
<p>For a string such as <code>s" emergency induction port"</code>, this gives us:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        emergency
        induction
        port</pre>
</div>
</div>
<div class="paragraph">
<p>The payload of such a loop can be modified to process any <code>( addr u )</code>. For
example, using the <code>execute-parsing</code> word, we can define a series of variables
at run time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        : make-variables ( addr u -- )
            begin
                cleave
                ['] variable execute-parsing  \ &lt;-- new function
            dup 0= until
            2drop ;</pre>
</div>
</div>
<div class="paragraph">
<p>Running <code>s" tali garrus joker shepard" make-variables</code> will define those four
words as variables, as <code>words</code> will show. More generally, we can use <code>cleave</code> to
create a version of the <code>map</code> higher-order function in Forth.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        : map ( addr u xt -- )
            &gt;r
            begin
                cleave
                r@ execute  \ &lt;-- must consume ( addr u )
            dup 0= until
            2drop  r&gt; drop ;</pre>
</div>
</div>
<div class="paragraph">
<p><strong>compile-only ( -- )</strong> - Mark last word in dictionary as compile-only.</p>
</div>
<div class="paragraph">
<p><strong>digit? ( char -- u f | char f )</strong> - If character is a digit, convert and set flag to
<code>true</code>, otherwise return the offending character and a <code>false</code> flag.</p>
</div>
<div class="paragraph">
<p><strong>ed ( -- )</strong> - Start the command-line editor. There is a whole chapter on this father
down.</p>
</div>
<div class="paragraph">
<p><strong>hexstore ( addr u addr1 -- u2 )</strong> - Store string of numbers in memory. Given a
string with numbers of the current base seperated by spaces, store the numbers
at the address <code>addr1</code>, returning the number of elements. Non-number elements
are skipped, an zero-length string produces a zero output. Use as a poor man&#8217;s
assembler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        hex  s" ca ca 95 00 74 01" myprog hexstore
        myprog swap execute</pre>
</div>
</div>
<div class="paragraph">
<p>With this behavior, <code>hexstore</code> functions as a reverse <code>dump</code>. The names "store"
or "numberstore" might have been more appropriate, but "hexstore" as the
association of the Unix command <code>hexdump</code> and should be easier to understand.</p>
</div>
<div class="paragraph">
<p><strong>input ( -- )</strong> - Return the address where the vector for the input routine is
stored (not the vector itself). Used for input redirection for
<code>emit</code> and others.</p>
</div>
<div class="paragraph">
<p><strong>input&gt;r ( -- ) ( R: -- n n n n )</strong> - Saves the current input state to the
Return Stack. This is used for <code>evaluate</code>. ANS Forth does provide the word
<code>save-input</code> (see <a href="https://forth-standard.org/standard/core/SAVE-INPUT" class="bare">https://forth-standard.org/standard/core/SAVE-INPUT</a>), but it
pushes the state to the Data Stack, not the Return Stack. The reverse operation
is <code>r&gt;input</code>.</p>
</div>
<div class="paragraph">
<p><strong>int&gt;name ( xt -- nt )</strong> - Given the execution execution token (xt)* -, return the
name token (nt)* -.</p>
</div>
<div class="paragraph">
<p><strong>latestnt ( -- nt )</strong> - Return the last used name token. The Gforth version of this
 word is called <code>latest</code>.</p>
</div>
<div class="paragraph">
<p><strong>nc-limit ( -- addr )</strong> - Return the address where the threshold value for native
compiling native compiling is kept. To check the value of this parameter, use <code>nc-limit ?</code>.
The default value is 20.</p>
</div>
<div class="paragraph">
<p><strong>never-native ( -- )</strong> - Mark most recent word so it is never natively compiled.</p>
</div>
<div class="paragraph">
<p><strong>number ( addr u -- u | d )</strong> - Convert a string to a number.  Gforth uses
<code>s&gt;number?</code> and returns a success flag as well.</p>
</div>
<div class="paragraph">
<p><strong>output ( -- addr )</strong> - Return the address where the vector for the output routine is
stored (not the vector itself)* -. Used for output redirection for <code>emit</code> and
others.</p>
</div>
<div class="paragraph">
<p><strong>r&gt;input ( --) ( R: n n n n -- )</strong> - Restore input state from Return Stack.
See <code>input&gt;r</code> for details.</p>
</div>
<div class="paragraph">
<p><strong>strip-underflow ( -- addr )</strong> - Return the address where the flag is kept that decides
if the underflow checks are removed during native compiling. To check the value
of this flag, use <code>strip-underflow ?</code>.</p>
</div>
<div class="paragraph">
<p><strong>useraddr ( -- addr )</strong> - Return the base address of the block of memory holding the
user variables.</p>
</div>
<div class="paragraph">
<p><strong>wordsize ( nt -- u )</strong> - Given the name token (<code>nt</code>) of a Forth word, return
its size in bytes. Used to help tune native compiling. Note that <code>wordsize</code>
expects the name token (<code>nt</code>) of a word, not the execution token (<code>xt</code>). This
might be changed in future versions.</p>
</div>
<div class="paragraph">
<p><strong>-leading ( addr u -- addr1 u1 )</strong> - Strip any leading whitespace. This is the
other side of the ANS Forth string word <code>-trailing</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wordlists_and_search_order">Wordlists and Search Order</h3>
<div class="paragraph">
<p>Tali Forth implements the optional Search-Order words, including the extended
words.  These words can be used to hide certain words or to rearrange the order
the words are searched in, allowing configurable substitution in the case of
words that have the same name but live in different wordlists.</p>
</div>
<div class="paragraph">
<p>On startup, only the FORTH-WORDLIST is in the search order, so only those words
will be found.  Tali also comes with an EDITOR-WORDLIST and an
ASSEMBLER-WORDLIST, however those are not fully populated (mostly empty would be
a better description of the current situation).  Room for 8 user wordlists is
available, and the search order can also hold 8 wordlist identifiers. See
<a href="https://forth-standard.org/standard/search" class="bare">https://forth-standard.org/standard/search</a> for more information on wordlists and
the search order.</p>
</div>
<div class="paragraph">
<p>The WORDLIST word will create a new wordlist (or print an error message if all 8
user wordlists have already been created).  It puts the wordlist identifer (wid)
on the stack.  This is simply a number that uniquely identifes the wordlist, and
it&#8217;s common practice to give it a name rather than use the number directly.  An
example might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>wordlist constant MY-WORDLIST</pre>
</div>
</div>
<div class="paragraph">
<p>While this creates a new wordlist and gives it a name, the wordlist isn&#8217;t
currently set up to be used.  When Tali starts, only the FORTH-WORDLIST is set
up in the search order and all compilation of new words goes into the
FORTH-WORDLIST.  After creating a new wordlist, you need to set it up for new
words to be compiled to it using SET-CURRENT and you need to add it to the
search order using SET-ORDER if you want the new words to be found.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>\ Set up the new wordlist as the current (compilation) wordlist
\ New words are always put in the current wordlist.
MY-WORDLIST set-current

\ Put this wordlist in the search order so it will be searched
\ before the FORTH-WORDLIST.  To set the search order, put the
\ wids on the stack in reverse order (last one listed is seached
\ first), then the number of wids, and then SET-ORDER.
FORTH-WORDLIST MY-WORDLIST 2 set-order

: new-word s" This word is in MY-WORDLIST"

\ Go back to compiling into the FORTH-WORDLIST.
FORTH-WORDLIST set-current</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_native_compiling">Native Compiling</h3>
<div class="paragraph">
<p>As the name says, subroutine threaded code encodes the words as a series of
subroutine jumps. Because of the overhead caused by these jumps, this can make
the code slow. Therefore, Tali Forth enables native compiling, where the
machine code from the word itself is included instead of a subroutine jump. This
is also called "inlining".</p>
</div>
<div class="paragraph">
<p>The parameter <code>nc-limit</code> sets the limit of how small words have to be to be
natively compiled. To get the current value (usually 20), check the value of
the system variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nc-limit ?</pre>
</div>
</div>
<div class="paragraph">
<p>To set a new limit, save the maximal allowed number of bytes in the machine
code like any other Forth variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>40 nc-limit !</pre>
</div>
</div>
<div class="paragraph">
<p>To completely turn off native compiling, set this value to zero.</p>
</div>
</div>
<div class="sect2">
<h3 id="_underflow_detection">Underflow Detection</h3>
<div class="paragraph">
<p>When a word tries to access more words on the stack than it is holding, an
"underflow" error occurs. Whereas Tali Forth 1 didn&#8217;t check
for these errors, this version does.</p>
</div>
<div class="paragraph">
<p>However, this slows the program down. Because of this, the user can turn off
underflow detection for words that are natively compiled into new words. To do
this, set the system variable <code>strip-underflow</code> to <code>true</code>. Note this does not
turn off underflow detection in the built-in words. Also, words with underflow
detection that are not included in new words through native compiling will also
retain their tests.</p>
</div>
</div>
<div class="sect2">
<h3 id="_restarting">Restarting</h3>
<div class="paragraph">
<p>Tali Forth has a non-standard word <code>cold</code> that resets the system. This doesn&#8217;t
erase any data in memory, but just moves the pointers back. When in doubt, you
might be better off quitting and restarting completely.</p>
</div>
</div>
<div class="sect2">
<h3 id="_gotchas">Gotchas</h3>
<div class="paragraph">
<p>Some things to look out for when using Tali Forth.</p>
</div>
<div class="sect3">
<h4 id="_cell_size_2">Cell Size</h4>
<div class="paragraph">
<p>Tali has a 16-bit cell size.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use <code>1 cells 8 * .</code> to get the cell size in bits with any Forth.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This can trip up calculations when compared to the <em>de facto</em> standard Gforth
with 64 bits. Take this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>( Gforth )      decimal 1000 100 um* hex swap u. u.  ( returns 186a0 0  ok )
( Tali Forth)   decimal 1000 100 um* hex swap u. u.  ( returns 86a0 1  ok )</pre>
</div>
</div>
<div class="paragraph">
<p>Tali has to use the upper cell of a double-celled number to correctly report
the result, while Gforth doesn&#8217;t. If the conversion from double to single is
only via a <code>drop</code> instruction, this will produce different results.</p>
</div>
<div class="paragraph">
<p>There is a similar effect with the Gforth word <code>bounds</code>: Because of Tali&#8217;s 16
bit address space, it wraps the upper address if we go beyond $FFFF:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>( Gforth )      hex FFFF 2 bounds  swap u. u.  ( returns 10001 ffff  ok  )
( Tali )        hex FFFF 2 bounds  swap u. u.  ( returns     1 ffff  ok )</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delimiters_during_parsing">Delimiters During Parsing</h4>
<div class="paragraph">
<p>Both <code>parse-name</code> and <code>parse</code> skip white space - defined as ASCII characters
from 00 to 32 (SPACE) inclusive - when the standard talks about "spaces".
Otherwise, Tali would choke on TABs during compiling, and the <code>ed</code> editor
couldn&#8217;t be used to edit programs because of the Line Feed characters. This is
covered in the standard, see the footnote at
<a href="https://forth-standard.org/standard/core/PARSE-NAME" class="bare">https://forth-standard.org/standard/core/PARSE-NAME</a> by Anton Ertl, referencing
<a href="http://forth-standard.org/standard/usage#subsubsection.3.4.1.1" class="bare">http://forth-standard.org/standard/usage#subsubsection.3.4.1.1</a> and
<a href="http://forth-standard.org/standard/file#subsection.11.3.5" class="bare">http://forth-standard.org/standard/file#subsection.11.3.5</a> .</p>
</div>
</div>
<div class="sect3">
<h4 id="_negative_code_allot_code">Negative <code>allot</code></h4>
<div class="paragraph">
<p>The ANSI standard does not define what happens if there is an attempt to free
more memory with <code>allot</code> by passing a negative value than is available. Tali
will let the user free memory up the beginning of RAM assigned to the Dictionary
(marked with <code>cp0</code> in the code), even though this can mean that the Dictionary
itself is compromised. This is Forth, you&#8217;re the boss.</p>
</div>
<div class="paragraph">
<p>However, any attempt to free more memory than that will set the beginning of RAM
to <code>cp0</code>. Also, the Dictionary Pointer <code>dp</code> will point to the <em>last native word</em>
of the Dictionary, which is usually <code>drop</code>. Because of this, the high level
words defined during boot will <em>not</em> be available. There will be an error
message to document this. Realistically, you&#8217;ll probably want to restart with
<code>cold</code> if any of this happens.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_major_components">Major Components</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_blocks">Blocks</h3>
<div class="paragraph">
<p>Tali supports the optional BLOCK word set. The 2012 Forth standard
defines a block as 1024 bytes, and the buffers for them are the same
size (as opposed to some older forths that had smaller buffers.) Tali
currently comes with one buffer.</p>
</div>
<div class="paragraph">
<p>Before these words can be used, the user needs to write two routines: one for
reading blocks into RAM and one for writing blocks out from RAM. Both of these
should have the signature <code>( addr blk#&#8201;&#8212;&#8201;)</code>. Once these have been written, they
can be incorporated into the BLOCK word set by changing the vectors for words
<code>block-read</code> and <code>block-write</code>. That might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>' myblockreader BLOCK-READ-VECTOR !
' myblockwriter BLOCK-WRITE-VECTOR !</pre>
</div>
</div>
<div class="paragraph">
<p>These vectors determine what runs when the words <code>block-read</code> and
<code>block-write</code> are used.  Both of these words start with an error
message asking you to update the vectors.  Once these two vectors have
been updated, you can use the block words.</p>
</div>
<div class="paragraph">
<p>If you would like to play with some blocks, but don&#8217;t have any
hardware or are running Tali in a simulator, fear not!  Tali has a
built-in RAM drive that can be accessed by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>4 block-ramdrive-init</pre>
</div>
</div>
<div class="paragraph">
<p>This reserves a chunk of ram with four blocks in it (numbered 0-3) which is
enough to play around with. It also sets up the routines for reading and writing
blocks in this ramdrive for you. If you want more blocks, you can change the
number. Because they start at zero, the last valid block will always be one less
than the number you provide.</p>
</div>
<div class="paragraph">
<p>Be careful about creating too many blocks as they are 1K each.  It&#8217;s also worth
noting that running <code>block-ramdrive-init</code> again will create another ramdrive and
the existing one will be inaccessible while still taking up space in
RAM.</p>
</div>
<div class="paragraph">
<p>See the tutorials on working with blocks for more information on how to use them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_block_editor">The Block Editor</h3>
<div class="paragraph">
<p>If you are using blocks (see the block chapter), you can use the following words
to enter text or Forth code.  The built-in editor allows you to replace a
single line or an entire screen. Screens are 16 lines (numbered 0-15) of 64
characters each, for a total of 1K characters.  Because newlines are not stored
in the blocks (the remainder of each line is filled with spaces,) you should
leave a space in the very last character of each line to separate the words in
that line from the words in the next line.</p>
</div>
<div class="paragraph">
<p>To get started, the editor words need to be added to the search order.  To do
that, you can just run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>editor-wordlist &gt;order</pre>
</div>
</div>
<div class="paragraph">
<p>To use the editor, first select a screen to work with by running <code>list</code> on it. If
you are planning on using <code>load</code> to run some code later, it&#8217;s worth noting that
only screens above 0 can be LOADed. Screen 0 is reserved for comments describing
what is on the other screens.  It can be LISTed and edited, but cannot be
LOADed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1 list</pre>
</div>
</div>
<div class="paragraph">
<p>Tali will show you the current (blank) contents of that screen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Screen #   1
 0
 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
 ok</pre>
</div>
</div>
<div class="paragraph">
<p>To add some text to line 3, you might say</p>
</div>
<div class="listingblock">
<div class="content">
<pre>3 o</pre>
</div>
</div>
<div class="paragraph">
<p>This will give you a prompt to enter the text to overwrite line 3.
You can enter up to 64 characters.  Once you have selected a screen
with <code>list</code>, you can use just <code>L</code> to list it again.</p>
</div>
<div class="paragraph">
<p>To replace the contents of an entire screen, you can say something
like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>2 enter-screen</pre>
</div>
</div>
<div class="paragraph">
<p>This will prompt you, line by line, for the new contents to screen 2.</p>
</div>
<div class="paragraph">
<p>Once you have your screens the way you want them, you can type</p>
</div>
<div class="listingblock">
<div class="content">
<pre>flush</pre>
</div>
</div>
<div class="paragraph">
<p>to flush your changes out to storage.</p>
</div>
<div class="paragraph">
<p>You can enter Forth code on these screens. At the moment, Tali only
supports comments in parentheses inside of blocks, so make sure you
put your comments ( like this ) rather than using \ when entering
Forth code.  To load the Forth code on a screen, just type something
like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>2 load</pre>
</div>
</div>
<div class="paragraph">
<p>Because a screen only holds 16 lines, you may need to split your code
across multiple screens.  You can load a series of screens (in order)
using the <code>thru</code> command like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1 3 thru</pre>
</div>
</div>
<div class="paragraph">
<p>For more examples of the block editor being used, see the tutorials on working
with blocks.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_line_based_editor_code_ed_code">The Line-Based Editor <code>ed</code></h3>
<div class="quoteblock">
<blockquote>
Ed makes no response to most commands  there is no prompting or typing of
messages like "ready". (This silence is preferred by experienced users, but
sometimes a hangup for beginners.) <a href="#BWK">[BWK]</a>
</blockquote>
<div class="attribution">
&#8212; B. W. Kernighan<br>
<cite>A Tutorial Introduction to the UNIX Text Editor</cite>
</div>
</div>
<div class="paragraph">
<p>Tali Forth 2 currently ships with a clone of the <code>ed</code> line-based editor of Unix
fame. It is envoked with <code>ed</code>, though the formal name is <code>ed6502</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>ed</code> uses about 2 KB of ROM in the default setup. If you know for certain
you are not going to be using it, you can reclaim that space by commenting out
the line <code>.require "ed.asm"</code> in <code>taliforth.asm</code> and the subroutine jump
<code>jsr ed6502</code> for the <code>ed</code> command in <code>native_words.asm</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For those not familiar with <code>ed</code>, there is <a href="#ed-tutorial">a tutorial</a> included
in this manual. This section is a brief overview of the currently available
functions.</p>
</div>
<div class="sect3">
<h4 id="_supported_commands">Supported Commands</h4>
<div class="paragraph">
<p><code>ed</code> currently supports only a small number of the commands of the Unix version:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
a
</td>
<td class="hdlist2">
<p>Add new lines below given line</p>
</td>
</tr>
<tr>
<td class="hdlist1">
d
</td>
<td class="hdlist2">
<p>Delete line</p>
</td>
</tr>
<tr>
<td class="hdlist1">
f
</td>
<td class="hdlist2">
<p>Show current target address for writes (<code>w</code>)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
i
</td>
<td class="hdlist2">
<p>Add new lines above given line</p>
</td>
</tr>
<tr>
<td class="hdlist1">
q
</td>
<td class="hdlist2">
<p>Quit if no unsaved work</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Q
</td>
<td class="hdlist2">
<p>Unconditional quit, unsaved work is lost</p>
</td>
</tr>
<tr>
<td class="hdlist1">
w
</td>
<td class="hdlist2">
<p>Write text to given memory location (eg <code>7000w</code>)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
=
</td>
<td class="hdlist2">
<p>Print value of given parameter (eg <code>$=</code> gives number of last line)</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following parameters are currently available:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
.
</td>
<td class="hdlist2">
<p>Current line number</p>
</td>
</tr>
<tr>
<td class="hdlist1">
,
</td>
<td class="hdlist2">
<p>When alone: All lines, the same as <code>1,$</code> or <code>%</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
;
</td>
<td class="hdlist2">
<p>Range from current line to end, same as <code>.,$</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
$
</td>
<td class="hdlist2">
<p>Last line</p>
</td>
</tr>
<tr>
<td class="hdlist1">
%
</td>
<td class="hdlist2">
<p>All lines, the same as <code>1,$</code> or <code>,</code> alone</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An empty line (pressing the ENTER key) will advance by one line and print it. A
simple number will print that line without the line number and make that line
the new current line.</p>
</div>
</div>
<div class="sect3">
<h4 id="_future_planned_commands">Future planned commands</h4>
<div class="paragraph">
<p>These are subject to available memory. There is also no time frame for these
additions.</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
+
</td>
<td class="hdlist2">
<p>Advance by one line, print it and make it the new current line</p>
</td>
</tr>
<tr>
<td class="hdlist1">
-
</td>
<td class="hdlist2">
<p>Go back by one line, print it and make it the new current line</p>
</td>
</tr>
<tr>
<td class="hdlist1">
c
</td>
<td class="hdlist2">
<p>Change a line, possibly adding new lines</p>
</td>
</tr>
<tr>
<td class="hdlist1">
e
</td>
<td class="hdlist2">
<p>Edit lines given as <code>addr,u</code> in text buffer</p>
</td>
</tr>
<tr>
<td class="hdlist1">
j
</td>
<td class="hdlist2">
<p>Join two lines to a new line</p>
</td>
</tr>
<tr>
<td class="hdlist1">
m
</td>
<td class="hdlist2">
<p>Move block of text to new line</p>
</td>
</tr>
<tr>
<td class="hdlist1">
r
</td>
<td class="hdlist2">
<p>Append text from a block to end of text buffer</p>
</td>
</tr>
<tr>
<td class="hdlist1">
s
</td>
<td class="hdlist2">
<p>Substitute one string on line with another</p>
</td>
</tr>
<tr>
<td class="hdlist1">
!
</td>
<td class="hdlist2">
<p>Execute a shell command (Forth command in our case)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
#
</td>
<td class="hdlist2">
<p>Comment, ignore rest of the line</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_differences_to_unix_ed">Differences to Unix ed</h4>
<div class="paragraph">
<p>Apart from missing about 90 percent of the features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>w</code> (write) command takes its parameter before and not after the word.
Where Unix ed uses the format <code>w &lt;FILENAME&gt;</code>, ed6502 takes the address
to write the text to as <code>7000w</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>ed</code> currently only works with decimal numbers. When in doubt, use
<code>decimal</code> to make sure your using base ten.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_using_code_ed_code_for_programming">Using <code>ed</code> for programming</h4>
<div class="paragraph">
<p><code>Ed</code> can be used to write programs and then execute them with <code>evaluate</code>. For
instance, a session to add a small string could look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        ed
        a
        .( Shepard, is that ... You're alive?)
        .
        7000w <i class="conum" data-value="1"></i><b>(1)</b>
        22    <i class="conum" data-value="2"></i><b>(2)</b>
        q</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Address we save the command to</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Number of characters saved including final line feed</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is a common mistake to forget the <code>.</code> (dot) to end the input, and try to
go immediately to saving the text. Then, we can run the program:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        evaluate</pre>
</div>
</div>
<div class="paragraph">
<p>ote that <code>evaluate</code> will handle line feeds, carriage returns and other white
space apart from simple spaces without problems.</p>
</div>
</div>
<div class="sect3">
<h4 id="_known_issues">Known Issues</h4>
<div class="sect4">
<h5 id="_memory_use">Memory use</h5>
<div class="paragraph">
<p><code>Ed</code> currently uses memory without releasing it when done. For small, quick
edits, this probably is not a problem. However, if you known you are going to be
using more memory, you probably will want to set a marker first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        marker pre-edit <i class="conum" data-value="1"></i><b>(1)</b>
        ed              <i class="conum" data-value="2"></i><b>(2)</b>
        pre-edit        <i class="conum" data-value="3"></i><b>(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set marker at current value of <code>here</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Edit normally</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call marker, releasing memory</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This issue might be taken care of in a future release.</p>
</div>
</div>
<div class="sect4">
<h5 id="_address_of_saved_text">Address of Saved Text</h5>
<div class="paragraph">
<p><code>Ed</code> returns the address of the saved text on the stack as <code>(&#8201;&#8212;&#8201;addr u )</code>.  If
nothing is saved, the program would return a zero length as TOS.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_developer_information">Developer Information</h4>
<div class="paragraph">
<p>The "buffer" of <code>ed</code> is a simple single-linked list of nodes, consisting of a pointer
to the next entry, a pointer to the string address, and the length of that
string.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pics/ed_node.png" alt="ed node">
</div>
</div>
<div class="paragraph">
<p>Each entry is two bytes, making six bytes in total for each node. A
value of 0000 in the pointer to the next address signals the end of the list.
The buffer starts at the point of the <code>cp</code> (accessed with the Forth word <code>here</code>)
and is only saved to the given location when the <code>w</code> command is given.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_assembler">The Assembler</h3>
<div class="paragraph">
<p>Tali Forth is shipped with a built-in assembler that uses the Simpler Assembler
Format (SAN). See the Appendix for an introduction to SAN.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The code was originally part of a stand-alone 65c02 assembler in Forth
named tasm65c02. See <a href="https://github.com/scotws/tasm65c02" class="bare">https://github.com/scotws/tasm65c02</a> for details. Tasm65c02
is in the public domain.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_adding_assembler_code_at_the_command_line">Adding assembler code at the command line</h4>
<div class="paragraph">
<p>Because Tali Forth is a Subroutine Threaded (STC) Forth, inserting assembler
instructions is easy. In fact, the only real problem is accessing the assembler
wordlist, which is normally not in the search tree because of its length. This,
then, is one way to add assembler code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        assembler-wordlist &gt;order
        here            \ Remember where we are
        1 lda.#         \ LDA #1 in Simpler Assembler Notation (SAN)
        push-a          \ Pseudo-instruction, pushes A on the Forth data stack
        rts             \ End subroutine. Don't use BRK!
        execute         \ Run our code using value from HERE
        .s              \ Will show 1 as TOS
        previous</pre>
</div>
</div>
<div class="paragraph">
<p>The first line is required to give the user access to the list of assembler
mnemonics. They are not in the default wordlist path because of their sheer
number:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        adc.# adc.x adc.y adc.z adc.zi adc.ziy adc.zx adc.zxi and. and.# and.x
        and.y and.z and.zi and.ziy and.zx and.zxi asl asl.a asl.x asl.z asl.zx
        bcc bcs beq bit bit.# bit.x bit.z bit.zx bmi bne bpl bra brk bvc bvs clc
        cld cli clv cmp cmp.# cmp.x cmp.y cmp.z cmp.zi cmp.ziy cmp.zx cmp.zxi
        cpx cpx.# cpx.z cpy cpy.# cpy.z dec dec.a dec.x dec.z dec.zx dex dey eor
        eor.# eor.x eor.y eor.z eor.zi eor.ziy eor.zx eor.zxi inc inc.a inc.x
        inc.z inc.zx inx iny jmp jmp.i jmp.xi jsr lda lda.# lda.x lda.y lda.z
        lda.zi lda.ziy lda.zx lda.zxi ldx ldx.# ldx.y ldx.z ldx.zy ldy ldy.#
        ldy.x ldy.z ldy.zx lsr lsr.a lsr.x lsr.z lsr.zx nop ora ora.# ora.x
        ora.y ora.z ora.zi ora.ziy ora.zx ora.zxi pha php phx phy pla plp plx
        ply rol rol.a rol.x rol.z rol.zx ror ror.a ror.x ror.z ror.zx rti rts
        sbc sbc.# sbc.x sbc.y sbc.z sbc.zi sbc.ziy sbc.zx sbc.zxi sec sed sei
        sta sta.x sta.y sta.z sta.zi sta.ziy sta.zx sta.zxi stx stx.z stx.zy sty
        sty.z sty.zx stz stz.x stz.z stz.zx tax tay trb trb.z tsb tsb.z tsx txa
        txs tya</pre>
</div>
</div>
<div class="paragraph">
<p>The last line in our code, <code>previous</code>, removes the assembler wordlist again.</p>
</div>
<div class="paragraph">
<p>In the example above, it is important to use <code>rts</code> and not <code>brk</code> as the last
instruction to return to the command line.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Seriously. Never use <code>brk</code> inside Tali Forth assembler code!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note you can freely mix Forth high-level words and assembler instructions. For
example, this will work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        hex
        10 lda.#        \ LDA #$10
        decimal
        10 ldx.#        \ LDA #10</pre>
</div>
</div>
<div class="paragraph">
<p>Running the disassembler gives us (actual addresses may vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        12BF    10 lda.#
        12C1     A ldx.#</pre>
</div>
</div>
<div class="paragraph">
<p>This also allows the use various different formatting tricks like putting more
than one assembler instruction in a line or including in-line comments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        dec.a dec.a     \ DEC twice
        nop ( just chilling ) nop ( still don't want to work )
        nop ( not going to happen ) nop ( just go away already! )</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_adding_assembler_code_to_new_words">Adding assembler code to new words</h4>
<div class="paragraph">
<p>The assembler words are immediate, that is, they are executed even during
compilation. Simply adding them to a word doesn&#8217;t work. For example, if we want
a word that pushes 1 on the Forth data stack, we might be tempted to do this
(assuming <code>assembler-wordlist &gt;order</code> first):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        : one-to-tos  compiled
        1 lda.#                 \ fails with "Stack underflow"</pre>
</div>
</div>
<div class="paragraph">
<p>The problem is that the number <code>1</code> is compiled, and then the immediate word
<code>lda.#</code> is executed, but it can&#8217;t find its operand on the stack. To avoid this
problem, we can use the <code>[</code> and <code>]</code> words:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        : one-to-tos  compiled
        [ 1 lda.# ]  compiled
        [ push-a ]  compiled
        u. ;  ok</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We do not need to add an explicit <code>rts</code> instruction when compiling new
words with assembler because the <code>;</code> does it automatically. This is because Tali
Forth uses Subroutine Threaded Code (STC).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Running <code>one-to-tos</code> prints the number <code>1</code>. We can use a slightly simpler variant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        : one-to-tos  compiled
        [ 1 lda.#  ok
        push-a ]  compiled
        u. ;  ok</pre>
</div>
</div>
<div class="paragraph">
<p>This time, we&#8217;ve only used one left square bracket to start the assembler code
and one right bracket to end it. Because of this, we get <code>ok</code> instead of
<code>compiled</code> because we are technically not in compile-mode anymore. <code>1 lda.#</code> can
write the machine code right away.</p>
</div>
<div class="paragraph">
<p>Looking at our new word with <code>see</code> gives us (addresses may vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        nt: A2A  xt: A3C
        flags (CO AN IM NN UF HC): 0 0 0 1 0 1
        size (decimal): 19

        0A3C  A9 01 CA CA 95 00 74 01  20 3D D6 20 89 D6 A9 20  ......t.  =. ...
        0A4C  20 30 8E   0.

        A3C      1 lda.#   <i class="conum" data-value="1"></i><b>(1)</b>
        A3E        dex     <i class="conum" data-value="2"></i><b>(2)</b>
        A3F        dex
        A40      0 sta.zx
        A42      1 stz.zx
        A44   D63D jsr     <i class="conum" data-value="3"></i><b>(3)</b>
        A47   D689 jsr
        A4A     20 lda.#
        A4C   8E30 jsr</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>1 lda.#</code> as a single line;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Four lines of code for <code>push-a</code>;</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Four lines from <code>u.</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some Forths add the words <code>code</code> and <code>end-code</code> to mark the beginning and end of
an assembler blocks. In our case, these would just be simple synonyms for <code>[</code>
and <code>]</code>, so we don&#8217;t bother.</p>
</div>
</div>
<div class="sect3">
<h4 id="_accessing_forth_words_from_assembler">Accessing Forth words from assembler</h4>
<div class="paragraph">
<p>To execute Forth words when then assembler code is run, we need to store a
subroutine jump to the word&#8217;s execution token (xt). This we can get with <code>'</code>
("tick"). For instance, to print the byte in the accumulator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        here
        10 lda.#
        push-a          <i class="conum" data-value="1"></i><b>(1)</b>
        ' u. jsr        <i class="conum" data-value="2"></i><b>(2)</b>
        rts
        execute</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Push the value from A to TOS</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Code a subroutine jump to <code>u.</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will print <code>10</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_labels_jumps_and_branches">Labels, jumps, and branches</h4>
<div class="paragraph">
<p>The support for labels is currently very limited. An anonymous label can be
marked with <code>--&gt;</code> (the "arrow") as a target for a backwards jump with <code>&lt;j</code>
(the "back jump". A primitive example (that produces an endless loop):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        : .nums
        [ 0 lda.#
        --&gt;                     ; anonymous label
        inc.a push-a pha ]      ; PHA required because u. will overwrite A
        u.
        [ pla &lt;j jmp ]          ; endless loop
        ;</pre>
</div>
</div>
<div class="paragraph">
<p>Executing the word <code>.nums</code> will print numbers starting with 1 till 255 and then
wrap.</p>
</div>
<div class="paragraph">
<p>The directive <code>&lt;j</code> is actually a dummy, or to put a bit more politely, syntactic
sugar: The <code>jmp</code> instruction itself takes the value from the stack. <code>--&gt;</code>
itself is nothing more than an immediate version of <code>here</code> and in fact shares
the same assembler code.</p>
</div>
<div class="paragraph">
<p>Disassembling <code>.nums</code> shows how this code works (addresses may vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        99D      0 lda.#
        99F        inc.a   <i class="conum" data-value="1"></i><b>(1)</b>
        9A0        dex
        9A1        dex
        9A2      0 sta.zx
        9A4      1 stz.zx
        9A6        pha
        9A7   D676 jsr
        9AA   D6C2 jsr
        9AD     20 lda.#
        9AF   8E18 jsr
        9B2        pla
        9B3    99F jmp     <i class="conum" data-value="2"></i><b>(2)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Address specified by label <code>-&gt;</code> is <code>$099F</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Address was picked up by <code>jmp</code> instruction</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Branches work similar. Instead of <code>&lt;j</code> as a "back jump", we use <code>&lt;b</code> as a "back
branch". For example, this word takes a number of "a" to print (in slightly
different notation):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        : .na ( n -- )
        [
              0 lda.zx  <i class="conum" data-value="1"></i><b>(1)</b>
                tay
        --&gt;
             97 lda.#
                push-a
                phy
        ]
        emit
        [
                ply
                dey
             &lt;b bne
                inx  <i class="conum" data-value="2"></i><b>(2)</b>
                inx
        ]
        ;</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>LDA 0,X</code> in traditional notation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Assembler version of <code>drop</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Looking at the assembler code with <code>see</code>, we can see that the branch instruction
takes $F2 as an operand.</p>
</div>
<div class="paragraph">
<p>Currently, there is no mechanism that checks to see if the operand is in the
correct range for a branch. It is assumed that the assembler will be used only
for small code snippets where this will not be a problem.</p>
</div>
</div>
<div class="sect3">
<h4 id="_pseudo_instructions_and_macros">Pseudo-instructions and macros</h4>
<div class="paragraph">
<p><strong>push-a</strong> takes the byte in the Accumulator A and pushes it to the top of the
Forth Data Stack. This is a convenience macro for</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        dex
        dex
        sta.zx 0        ; STA 0,X
        stz.zx 1        ; STZ 1,X</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_under_the_hood">Under the hood</h4>
<div class="paragraph">
<p>The assembler instructions are in fact just normal, very simple Forth words that
send the opcode and the length of the instruction in bytes to common routines
for processing.</p>
</div>
<div class="paragraph">
<p>The assembler instructions will trigger an underflow error if there is no
operand on the stack when required.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        lda.#   \ requires operand first on the stack -&gt; triggers error</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gotchas_and_known_issues">Gotchas and known issues</h4>
<div class="paragraph">
<p>Working with assembler requires an intimate knowledge of Tali Forth&#8217;s internals.
Some of the things that range from just very dangerous to downright suicidal
are:</p>
</div>
<div class="paragraph">
<p><strong>Using the X register.</strong> Tali Forth uses X to hold the Data Stack pointer.
Manipulating it risks crashing the whole system beyond any hope of recovery. If
for some reason you feel you must use X, be careful to save and restore the
original value, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        phx
        ( do something with X )
        plx</pre>
</div>
</div>
<div class="paragraph">
<p><strong>There are currently no forward branches.</strong> The words <code>b&gt;</code> and <code>j&gt;</code> will be used
once they are added. Forward branches are more complex because they require
backtracking to fill in the address that is not known when the jump or branch
instruction is coded.</p>
</div>
<div class="paragraph">
<p><strong>The assembler instruction <code>and</code></strong> receives a dot for absolute addressing to avoid
conflict with the Forth word of the same name: <code>and. 1000</code> is the correct form.</p>
</div>
<div class="paragraph">
<p><strong><code>brk</code> is a two-byte instruction</strong> because the assembler enforces the signature
byte. You shouldn&#8217;t use <code>brk</code> anyway.</p>
</div>
</div>
<div class="sect3">
<h4 id="_other_ways_to_insert_assembler_code">Other ways to insert assembler code</h4>
<div class="paragraph">
<p>Sometimes the assembler can be overkill, or we are given a dump of hex values
from a different assembler to store. Probably the very simplest way is to add
the opcodes and operands directly with the <code>c,</code> instruction to store the machine
code byte by byte. Our very first example of pushing the number 1 to the Data
Stack in assembler  becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        hex  here a9 c, 01 c, ca c, ca c, 95 c, 00 c, 74 c, 01 c, 60 c,</pre>
</div>
</div>
<div class="paragraph">
<p>This leaves the address of this routine on the stack through the <code>here</code>. We run
this fragment with <code>execute</code> and find the number 1 on the stack.</p>
</div>
<div class="paragraph">
<p>This, however, is error-prone to type. Tali Forth provides a special word
called <code>hexstore ( addr u addr1&#8201;&#8212;&#8201;u )</code> for those occasions. It stores the
string provided by <code>( addr u )</code> at the location <code>addr1</code> and returns the number of
bytes stored.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>       hex
       s" a9 01 ca ca 95 00 74 01 60" 6000 hexstore
       drop     <i class="conum" data-value="1"></i><b>(1)</b>
       6000 execute</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get rid of return value bytes stored</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This word can be tricky to use with <code>here</code> because the string storage command
<code>s"</code> uses memory. The current address must be chosen <em>before</em> the string is
stored:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        hex
        here dup  s" a9 01 ca ca 95 00 74 01 60" rot hexstore
        drop execute</pre>
</div>
</div>
<div class="paragraph">
<p>Instead of <code>drop execute</code> in the last line, a <code>dump</code> will show that the correct
bytes were stored (address may vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        0990  A9 01 CA CA 95 00 74 01  60  ......t. `</pre>
</div>
</div>
<div class="paragraph">
<p>Disassembly gives us the fragment we were expecting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        9AD      1 lda.#
        9AF        dex
        9B0        dex
        9B1      0 sta.zx
        9B3      1 stz.zx
        9B5        rts</pre>
</div>
</div>
<div class="paragraph">
<p>Note here again the <code>rts</code> as last instruction.</p>
</div>
<div class="paragraph">
<p>We can also use the line-editor <code>ed</code> to add hex values for <code>hexstore</code>, which
makes it easier to correct typing errors. Adding our code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        ed
        a
        a9 01 ca ca 95 00 74 01 60
        .
        5000w  <i class="conum" data-value="1"></i><b>(1)</b>
        27     <i class="conum" data-value="2"></i><b>(2)</b>
        q</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Save string at address 5000</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Shows us length of number string saved</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Unless we ran <code>hex</code> before adding the word, the string is no stored at the
decimal addresss 5000. However, we&#8217;ve added the words as hexadecimal code. To
call <code>hexstore</code>, we must switch at the right time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        5000 27 6000 hex hexstore  ok
        drop
        decimal
        6000 execute</pre>
</div>
</div>
<div class="paragraph">
<p>You can get around this by either using all-hex numbers or enter the number
string in decimal.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_disassembler">The Disassembler</h3>
<div class="paragraph">
<p>Tali Forth is currently shipped with a very primitive disassembler, which is
started with <code>disasm ( addr u&#8201;&#8212;&#8201;)</code>.</p>
</div>
<div class="sect3">
<h4 id="_format">Format</h4>
<div class="paragraph">
<p>The output format is in Simpler Assembler Notation (SAN). Briefly, the
instruction&#8217;s mode is added to the mnemonic, leaving the operand a pure number.
For use in a postfix environment like Tali Forth, the operand is listed <em>before</em>
the mnemonic. This way, traditional assembly code such as</p>
</div>
<div class="listingblock">
<div class="content">
<pre>LDA #1
DEC
STA $1000
STA $80
NOP
LDA ($80)</pre>
</div>
</div>
<div class="paragraph">
<p>becomes (assuming <code>hex</code> for hexadecimal numbers):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        1 lda.#
          dec.a
     1000 sta
       80 sta.z
          nop
       80 lda.zi</pre>
</div>
</div>
<div class="paragraph">
<p>See the Appendix for a more detailed discussion of the format.</p>
</div>
</div>
<div class="sect3">
<h4 id="_output">Output</h4>
<div class="paragraph">
<p>The disassembler prints the address of the instruction, followed by any operand
and the mnemonic. To get the code of <code>drop</code>, for instance, we can use
<code>' drop 10 disasm</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>36204    119 cpx.#
36206      3 bmi
36208  56282 jmp
36211        inx
36212        inx
36213        rts</pre>
</div>
</div>
<div class="paragraph">
<p>The Forth word <code>see</code> calls the disassembler while using a hexadecimal number
base. So <code>see drop</code> produces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> nt: CF04  xt: 8D6C  UF
 size (decimal): 9

8D6C  E0 77 30 03 4C DA DB E8  E8  .w0.L... .

8D6C     77 cpx.#
8D6E      3 bmi
8D70   DBDA jmp
8D73        inx
8D74        inx</pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>see</code> does not print the final <code>rts</code> instruction.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gotchas_and_known_issues_2">Gotchas and known issues</h4>
<div class="paragraph">
<p>Tali Forth enforces the <strong>signature byte</strong> of the <code>brk</code> assembler instruction.
That is, it is treated like a two-byte instruction. Since you probably shouldn&#8217;t be
using <code>brk</code> anyway, this behavior is usually only interesting when examing the
code, where a block of zeros will produce something like the following with the
disassembler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>124B      0 brk
124D      0 brk
124F      0 brk
1251      0 brk</pre>
</div>
</div>
<div class="paragraph">
<p>Because of the stack structure of Forth, the disassembler will not catch
assembler instructions that were <strong>assigned an operand by mistake</strong>. Take this
(broken) code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nop
10 dex  <i class="conum" data-value="1"></i><b>(1)</b>
nop
rts</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Error: DEX does not take an operand!</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The disassembler will output this code (addresses might vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>4661        nop
4662        dex  <i class="conum" data-value="1"></i><b>(1)</b>
4663        nop
4664        rts</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Incorrect operand for DEX was silently ignored</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The 10 we had passed as an operand are still on the stack, as <code>.s</code> will show. A
<code>dump</code> of the code will show that the number was ignored, leading to code that
will actually run correctly (again, addresses will vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1235  EA CA EA 60</pre>
</div>
</div>
<div class="paragraph">
<p>These mistakes can surface further downstream when the incorrect value on the
Data Stack causes problems.</p>
</div>
</div>
</div>
</div>
</div>
<h1 id="_developer_guide" class="sect0">Developer Guide</h1>
<div class="sect1">
<h2 id="_how_tali_forth_works">How Tali Forth Works</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
Our intent was to create a pleasant computing environment
for ourselves, and our hope was that others liked it. <a href="#DMR">[DMR]</a>
</blockquote>
<div class="attribution">
&#8212; Dennis M. Ritchie<br>
<cite>Reflections on Software Research</cite>
</div>
</div>
<div class="sect2">
<h3 id="_memory_map">Memory Map</h3>
<div class="paragraph">
<p>Tali Forth can be configured to work with various memory layouts and amounts of
RAM and ROM. Out of the box, the version that runs with the py65 emulator looks
like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pics/memory_map.png" alt="memory map">
</div>
</div>
<div class="paragraph">
<p>Note that some of these values are hard-coded into the test suite; see the file
<code>definitions.txt</code> for details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_data_stack">The Data Stack</h3>
<div class="paragraph">
<p>Tali Forth uses the lowest part of the top half of the Zero Page for the Data Stack (DS). This leaves the lower half of the Zero Page
for any kernel stuff the user might require. The DS grows towards the initial
user variables. See the file <code>definitions.asm</code> for details. Because of the
danger of underflow, it is recommended that the user kernel&#8217;s
variables are kept closer to $0100 than to $007F.</p>
</div>
<div class="paragraph">
<p>The X register is used as the Data Stack Pointer (DSP). It
points to the least significant byte of the current top element of the stack
("Top of the Stack", TOS).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the first versions of Tali Forth 1, the DSP pointed to the next <em>free</em>
element of the stack. The new system makes detecting underflow easier and
follows the convention in Liara Forth.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Initially, the DSP points to $78, not $7F as might be expected. This provides a
few bytes as a "floodplain" for underflow. The initial value of
the DSP is defined as <code>dsp0</code> in the code.</p>
</div>
<div class="sect3">
<h4 id="_single_cell_values">Single Cell Values</h4>
<div class="paragraph">
<p>Since the cell size is 16 bits, each stack entry consists of two bytes. They are
stored little endian (least significant byte first). Therefore, the DSP points
to the LSB of the current TOS. <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnote_3" title="View footnote.">3</a>]</sup></p>
</div>
<div class="paragraph">
<p>Because the DSP points to the current top of the stack, the byte it points to
after boot&#8201;&#8212;&#8201;<code>dsp0</code>&#8201;&#8212;&#8201;will never be accessed: The DSP is decremented first
with two <code>dex</code> instructions, and then the new value is placed on the stack.
This means that the initial byte is garbage and can be considered part of the
floodplain.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pics/stack_diagram.png" alt="stack diagram">
</div>
<div class="title">Figure 3. Snapshot of the Data Stack with one entry as TOS. The DSP has been increased by one and the value written.</div>
</div>
<div class="paragraph">
<p>Note that the 65c02 system stack&#8201;&#8212;&#8201;used as the Return Stack (RS) by Tali&#8201;&#8212;&#8201;pushes the MSB on first and then the LSB (preserving little endian), so the
basic structure is the same for both stacks.</p>
</div>
<div class="paragraph">
<p>Because of this stack design, the second entry ("next on stack", NOS) starts at
<code>02,X</code> and the third entry ("third on stack", 3OS) at <code>04,X</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_underflow_detection_2">Underflow Detection</h4>
<div class="paragraph">
<p>Most native words come with built-in underflow detection. This is realized with
a subroutine jump to specialized routines for the number of cells (not: bytes)
that are expected on the Data Stack. For example, a word such as <code>drop</code> starts
with the test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>                jsr underflow_1</pre>
</div>
</div>
<div class="paragraph">
<p>Underflow detection adds three bytes and 16 cycles to the words that have it.
However, it increases the stability of the program. There is an option for
stripping it out during for user-defined words (see below).</p>
</div>
<div class="paragraph">
<p>Tali Forth does not check for overflow, which in normal operation is too rare
to justify the computing expense.</p>
</div>
</div>
<div class="sect3">
<h4 id="_double_cell_values">Double Cell Values</h4>
<div class="paragraph">
<p>The double cell is stored on top of the single cell.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pics/double_cell.png" alt="double cell">
</div>
</div>
<div class="paragraph">
<p>Note this places the sign bit of the double cell number (<strong>S</strong>) at the beginning
of the byte below the DSP.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dictionary">Dictionary</h3>
<div class="paragraph">
<p>Tali Forth follows the traditional model of a Forth dictionary&#8201;&#8212;&#8201;a linked list
of words terminated with a zero pointer. The headers and code are kept separate
to allow various tricks in the code.</p>
</div>
<div class="sect3">
<h4 id="_elements_of_the_header">Elements of the Header</h4>
<div class="paragraph">
<p>Each header is at least eight bytes long:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pics/header_diagram.png" alt="header diagram">
</div>
</div>
<div class="paragraph">
<p>Each word has a <code>name token</code> (nt, <code>nt_word</code> in the code) that points to the
first byte of the header. This is the length of the word&#8217;s name string, which
is limited to 255 characters.</p>
</div>
<div class="paragraph">
<p>The second byte in the header (index 1) is the status byte. It is created by
the flags defined in the file <code>definitions.asm</code>:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
CO
</td>
<td class="hdlist2">
<p><strong>Compile Only.</strong> This word may only be used inside definitions of new words.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
IM
</td>
<td class="hdlist2">
<p><strong>Immediate.</strong> This Word is executed immediately during definitions of new words.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
NN
</td>
<td class="hdlist2">
<p><strong>Never Native.</strong> This Word is never inlined. Usually means that the return address
from a subroutine jump is required for processing.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
AN
</td>
<td class="hdlist2">
<p><strong>Always Native.</strong> This word must always be inlined.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
UF
</td>
<td class="hdlist2">
<p><strong>Undeflow Detection.</strong> This word checks for Data Stack underflow before it is
executed.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
HC
</td>
<td class="hdlist2">
<p><strong>Has CFA.</strong> Consider first three bytes of the word&#8217;s code the Code Field
Area (CFA) of the word. Used by words defined with <code>create</code> so <code>&gt;body</code> returns
the correct value.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note there are currently two bits unused.</p>
</div>
<div class="paragraph">
<p>The status byte is followed by the <strong>pointer to the next header</strong> in the linked
list, which makes it the name token of the next word. A 0000 in this position
signals the end of the linked list, which by convention is the word <code>bye</code> for
the native code words.</p>
</div>
<div class="paragraph">
<p>This is followed by the current word&#8217;s <strong>execution token</strong> (xt, <code>xt_word</code>) that
points to the start of the actual code. Some words that have the same
functionality point to the same code block.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because Tali uses a subroutine threaded model (STC), the classic Forth
distinction between the Code Field Area (CFA) and the Parameter Field Area
(PFA, also Data Field Area) is meaningless&#8201;&#8212;&#8201;it&#8217;s all "payload".
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next pointer is for the <strong>end of the code</strong> (<code>z_word</code>) to enable native
compilation of the word (if allowed and requested).</p>
</div>
<div class="paragraph">
<p>The <strong>name string</strong> starts at the eighth byte. The string is <em>not</em>
zero-terminated.  Tali Forth lowercases names as they are copied into the
dictionary and also lowercases during lookup, so <code>quarian</code> is the same word as
<code>QUARIAN</code>.  If the name in the dictionary is directly modified, it is important
to ensure that only lowercase letters are used, or else Tali will not be able
to find that word.</p>
</div>
</div>
<div class="sect3">
<h4 id="_structure_of_the_header_list">Structure of the Header List</h4>
<div class="paragraph">
<p>Tali Forth distinguishes between three different word sources: The <strong>native
words</strong> that are hard-coded in the file <code>native_words.asm</code>, the <strong>Forth words</strong>
from <code>forth_words.asm</code> which are defined as high-level words and then generated
at run-time when Tali Forth starts up, and <strong>user words</strong> in the file
<code>user_words.asm</code>.</p>
</div>
<div class="paragraph">
<p>Tali has an unusually high number of native words in an attempt to make the
Forth as fast as possible on the 65c02 and compensate for the disadvantages of
the subroutine threading model (STC). The first word on that list&#8201;&#8212;&#8201;the one
that is checked first&#8201;&#8212;&#8201;is always <code>drop</code>, the last one&#8201;&#8212;&#8201;the one checked for
last&#8201;&#8212;&#8201;is always <code>bye</code>. The words which are (or are assumed to be) used more
than others come first. Since humans are slow, words that are used more
interactively like <code>words</code> always come later.</p>
</div>
<div class="paragraph">
<p>The list of Forth words ends with the intro strings. This functions as a
primitive form of a self-test: If you see the welcome message, compilation of
the Forth words worked.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_input">Input</h3>
<div class="paragraph">
<p>Tali Forth follows the ANS Forth input model with <code>refill</code> instead of older
forms. There are four possible input sources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The keyboard ("user input device", can be redirected)</p>
</li>
<li>
<p>A character string in memory</p>
</li>
<li>
<p>A block file</p>
</li>
<li>
<p>A text file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To check which one is being used, we first call <code>blk</code> which gives us the number
of a mass storage block being used, or 0 for the one of the other input sources.
In the second case, we use <code>source-id</code> to find out where input is coming from:</p>
</div>
<table class="tableblock frame-all grid-all">
<caption class="title">Table 2. Non-block input sources</caption>
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Source</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">keyboard (can be redirected)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string in memory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>n</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file-id (not currently supported)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The input can be redirected by storing the address of your routine in
the memory location given by the word <code>input</code>.  Tali expects this
routine to wait until a character is available and to return the
character in A, rather than on the stack.</p>
</div>
<div class="paragraph">
<p>The output can similarly be redirected by storing the address of your
routine in the memory location given by the word <code>output</code>.  Tali
expects this routine to accept the character to out in A, rather than
on the stack.</p>
</div>
<div class="paragraph">
<p>Both the input routine and output routine may use the tmp1, tmp2, and
tmp3 memory locations (defined in assembly.asm), but they need to
push/pop them so they can restore the original values before
returning.  If the input or output routines are written in Forth,
extra care needs to be taken because many of the Forth words use these
tmp variables and it&#8217;s not immediately obvious without checking the
assembly for each word.</p>
</div>
<div class="sect3">
<h4 id="_booting_2">Booting</h4>
<div class="paragraph">
<p>The initial commands after reboot flow into each other: <code>cold</code> to <code>abort</code> to
<code>quit</code>. This is the same as with pre-ANS Forths.  However, <code>quit</code> now calls
<code>refill</code> to get the input.  <code>refill</code> does different things based on which of the
four input sources (see above) is active:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
Keyboard entry
</td>
<td class="hdlist2">
<p>This is the default. Get line of input via <code>accept</code> and return <code>true</code>
even if the input string was empty.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>evaluate</code> string
</td>
<td class="hdlist2">
<p>Return a <code>false</code> flag</p>
</td>
</tr>
<tr>
<td class="hdlist1">
Input from a buffer
</td>
<td class="hdlist2">
<p><em>Not implemented at this time</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
Input from a file
</td>
<td class="hdlist2">
<p><em>Not implemented at this time</em></p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_the_command_line_interface_cli">The Command Line Interface (CLI)</h4>
<div class="paragraph">
<p>Tali Forth accepts input lines of up to 256 characters. The address of the
current input buffer is stored in <code>cib</code>. The length of the current buffer is
stored in <code>ciblen</code>&#8201;&#8212;&#8201;this is the address that <code>&gt;in</code> returns.  <code>source</code> by
default returns <code>cib</code> and <code>ciblen</code> as the address and length of the input
buffer.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_word_code_evaluate_code">The Word <code>evaluate</code></h4>
<div class="paragraph">
<p>The word `evaluate`is used to execute commands that are in a string. A simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>s" 1 2 + ." evaluate</pre>
</div>
</div>
<div class="paragraph">
<p>Tali Forth uses <code>evaluate</code> to load high-level Forth words from the file
<code>forth_words.asc</code> and, if present, any extra, user-defined words from
<code>user_words.asc</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_words_code_create_code_and_code_does_code">The Words <code>create</code> and <code>does&gt;</code></h3>
<div class="paragraph">
<p>The tandem of words <code>create</code> and <code>does&gt;</code> is the most complex, but also most
powerful part of Forth. Understanding how it works in Tali Forth is important
if you want to be able to modify the code. In this text, we walk through the
generation process for a subroutine threaded code (STC) such as Tali Forth.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For a more general explanation, see Brad Rodriguez' series of articles at
<a href="http://www.bradrodriguez.com/papers/moving3.htm" class="bare">http://www.bradrodriguez.com/papers/moving3.htm</a> There is a discussion of this
walkthrough at <a href="http://forum.6502.org/viewtopic.php?f=9&amp;t=3153" class="bare">http://forum.6502.org/viewtopic.php?f=9&amp;t=3153</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We start with the following standard example, a high-level Forth version of the
word <code>constant</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: constant  ( "name" -- )  create , does&gt; @ ;</pre>
</div>
</div>
<div class="paragraph">
<p>We examine this in three phases or "sequences", following Rodriguez (based on
<a href="#DB">[DB]</a>).</p>
</div>
<div class="sect3">
<h4 id="_sequence_1_compiling_the_word_code_constant_code">Sequence 1: Compiling the Word <code>constant</code></h4>
<div class="paragraph">
<p><code>constant</code> is a defining word, one that makes new words. In pseudocode,
ignoring any compilation to native 65c02 assembler, the above compiles to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        jsr CREATE
        jsr COMMA
        jsr (DOES&gt;)         ; from DOES&gt;
   a:   jsr DODOES          ; from DOES&gt;
   b:   jsr FETCH
        rts</pre>
</div>
</div>
<div class="paragraph">
<p>To make things easier to explain later, we&#8217;ve added the labels <code>a</code> and
<code>b</code> in the listing.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This example uses the traditional word <code>(does&gt;)</code>, which in Tali Forth 2
is actually an internal routine that does not appear as a separate word. This
version is easier to explain.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>does&gt;</code> is an immediate word that adds not one, but two subroutine jumps, one
to <code>(does&gt;)</code> and one to <code>dodoes</code>, which is a pre-defined system routine like
<code>dovar</code>. We&#8217;ll discuss those later.</p>
</div>
<div class="paragraph">
<p>In Tali Forth, a number of words such as <code>defer</code> are "hand-compiled", that is,
instead of using forth such as</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: defer create ['] abort , does&gt; @ execute ;</pre>
</div>
</div>
<div class="paragraph">
<p>we write an optimized assembler version ourselves (see the actual <code>defer</code> code).
In these cases, we need to use <code>(does&gt;)</code> and <code>dodoes</code> instead of <code>does&gt;</code> as
well.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sequence_2_executing_the_word_code_constant_code">Sequence 2: Executing the Word <code>constant</code></h4>
<div class="paragraph">
<p>Now when we execute</p>
</div>
<div class="listingblock">
<div class="content">
<pre>42 constant life</pre>
</div>
</div>
<div class="paragraph">
<p>This pushes the <code>rts</code> of the calling routine&#8201;&#8212;&#8201;call it "main"&#8201;&#8212;&#8201;to the
65c02&#8217;s stack (the Return Stack, as Forth calls it), which now looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        (1) rts                 ; to main routine</pre>
</div>
</div>
<div class="paragraph">
<p>Without going into detail, the first two subroutine jumps of <code>constant</code> give us
this word:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        (Header "LIFE")
        jsr DOVAR               ; in CFA, from LIFE's CREATE
        4200                    ; in PFA (little-endian)</pre>
</div>
</div>
<div class="paragraph">
<p>Next, we <code>jsr</code> to <code>(does&gt;)</code>. The address that this pushes on the Return Stack
is the instruction of <code>constant</code> we had labeled <code>a</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        (2) rts to CONSTANT ("a")
        (1) rts to main routine</pre>
</div>
</div>
<div class="paragraph">
<p>Now the tricks start. <code>(does&gt;)</code> takes this address off the stack and uses it to
replace the <code>dovar jsr</code> target in the CFA of our freshly created <code>life</code> word.
We now have this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        (Header "LIFE")
        jsr a                   ; in CFA, modified by (DOES&gt;)
   c:   4200                    ; in PFA (little-endian)</pre>
</div>
</div>
<div class="paragraph">
<p>Note we added a label <code>c</code>. Now, when <code>(does&gt;)</code> reaches its own <code>rts</code>, it finds
the <code>rts</code> to the main routine on its stack. This is a Good Thing&#8482;, because it
aborts the execution of the rest of <code>constant</code>, and we don&#8217;t want to do
<code>dodoes</code> or <code>fetch</code> now. We&#8217;re back at the main routine.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sequence_3_executing_code_life_code">Sequence 3: Executing <code>life</code></h4>
<div class="paragraph">
<p>Now we execute the word <code>life</code> from our "main" program. In a STC Forth
such as Tali Forth, this executes a subroutine jump.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        jsr LIFE</pre>
</div>
</div>
<div class="paragraph">
<p>The first thing this call does is push the return address to the main routine
on the 65c02&#8217;s stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        (1) rts to main</pre>
</div>
</div>
<div class="paragraph">
<p>The CFA of <code>life</code> executes a subroutine jump to label <code>a</code> in <code>constant</code>. This
pushes the <code>rts</code> of <code>life</code> on the 65c02&#8217;s stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        (2) rts to LIFE ("c")
        (1) rts to main</pre>
</div>
</div>
<div class="paragraph">
<p>This <code>jsr</code> to a lands us at the subroutine jump to <code>dodoes</code>, so the return
address to <code>constant</code> gets pushed on the stack as well. We had given this
instruction the label <code>b</code>. After all of this, we have three addresses on the
65c02&#8217;s stack:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        (3) RTS to CONSTANT ("b")
        (2) RTS to LIFE ("c")
        (1) RTS to main</pre>
</div>
</div>
<div class="paragraph">
<p><code>dodoes</code> pops address <code>b</code> off the 65c02&#8217;s stack and puts it in a nice safe place
on Zero Page, which we&#8217;ll call <code>z</code>. More on that in a moment. First, <code>dodoes</code>
pops the <code>rts</code> to <code>life</code>. This is <code>c</code>, the address of the PFA or <code>life</code>, where
we stored the payload of this constant. Basically, <code>dodoes</code> performs a <code>dovar</code>
here, and pushes <code>c</code> on the Data Stack. Now all we have left on the 65c02&#8217;s
stack is the <code>rts</code> to the main routine.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        [1] RTS to main</pre>
</div>
</div>
<div class="paragraph">
<p>This is where <code>z</code> comes in, the location in Zero Page where we stored address
<code>b</code> of <code>constant</code>. Remember, this is where the PFA of <code>constant</code> begins, the
<code>fetch</code> command we had originally codes after <code>does&gt;</code> in the very first
definition. The really clever part: We perform an indirect <code>jmp</code>&#8201;&#8212;&#8201;not a
<code>jsr</code>!&#8201;&#8212;&#8201;to this address.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        jmp (z)</pre>
</div>
</div>
<div class="paragraph">
<p>Now the little payload program of <code>constant</code> is executed, the subroutine jump
to <code>fetch</code>. Since we just put the PFA (<code>c</code>) on the Data Stack, <code>fetch</code> replaces
this by 42, which is what we were aiming for all along.  And since <code>constant</code>
ends with a <code>rts</code>, we pull the last remaining address off the 65c02&#8217;s stack,
which is the return address to the main routine where we started. And that&#8217;s
all.</p>
</div>
<div class="paragraph">
<p>Put together, this is what we have to code:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>does&gt;</code></dt>
<dd>
<p>Compiles a subroutine jump to <code>(does&gt;)</code>, then compiles a subroutine
jump to <code>dodoes</code>.</p>
</dd>
<dt class="hdlist1"><code>(does&gt;)</code></dt>
<dd>
<p>Pops the stack (address of subroutine jump to <code>dodoes</code> in
<code>constant</code>, increase this by one, replace the original <code>dovar</code> jump target in
<code>life</code>.</p>
</dd>
<dt class="hdlist1"><code>dodoes</code></dt>
<dd>
<p>Pop stack (PFA of <code>constant</code>), increase address by one, store on
Zero Page; pop stack (PFA of <code>life</code>), increase by one, store on Data Stack;
<code>jmp</code> to address we stored in Zero Page.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Remember we have to increase the addresses by one because of the way <code>jsr</code>
stores the return address for <code>rts</code> on the stack on the 65c02: It points to the
third byte of the <code>jsr</code> instruction itself, not the actual return address. This
can be annoying, because it requires a sequence like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        inc z
        bne +
        inc z+1
*
        (...)</pre>
</div>
</div>
<div class="paragraph">
<p>Note that with most words in Tali Forth, as any STC Forth, the distinction
between PFA and CFA is meaningless or at least blurred, because we go native
anyway. It is only with words generated by <code>create</code> and <code>does&gt;</code> where this
really makes sense.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_control_flow">Control Flow</h3>
<div class="sect3">
<h4 id="_branches">Branches</h4>
<div class="paragraph">
<p>For <code>if</code> and <code>then</code>, we need to compile something called a "conditional forward
branch", traditionally called <code>0branch</code>. In Tali Forth, this is not visible to
the user as an actual, separate word anymore, but we can explain things better
if we assume it is still around.</p>
</div>
<div class="paragraph">
<p>At run-time, if the value on the Data Stack is false (flag is zero), the branch
is taken ("branch on zero", therefore the name). Except that we don&#8217;t have the
target of that branch yet&#8201;&#8212;&#8201;it will later be added by <code>then</code>. For this to work,
we remember the address after the <code>0branch</code> instruction during the compilation
of <code>if</code>. This is put on the Data Stack, so that <code>then</code> knows where to compile
it&#8217;s address in the second step. Until then, a dummy value is compiled after
<code>0branch</code> to reserve the space we need.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section and the next one are based on a discussion at
<a href="http://forum.6502.org/viewtopic.php?f=9\&amp;t=3176" class="bare">http://forum.6502.org/viewtopic.php?f=9\&amp;t=3176</a> see there for more details.
Another take on this subject that handles things a bit differently is at
<a href="http://blogs.msdn.com/b/ashleyf/archive/2011/02/06/loopty-do-i-loop.aspx" class="bare">http://blogs.msdn.com/b/ashleyf/archive/2011/02/06/loopty-do-i-loop.aspx</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In Forth, this can be realized by</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: if  postpone 0branch here 0 , ; immediate</pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: then  here swap ! ; immediate</pre>
</div>
</div>
<div class="paragraph">
<p>Note <code>then</code> doesn&#8217;t actually compile anything at the location in memory where
it is at. It&#8217;s job is simply to help <code>if</code> out of the mess it has created. If we
have an <code>else</code>, we have to add an unconditional <code>branch</code> and manipulate the
address that <code>if</code> left on the Data Stack. The Forth for this is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: else  postpone branch here 0 , here rot ! ; immediate</pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>then</code> has no idea what has just happened, and just like before
compiles its address where the value on the top of the Data Stack told it to&#8201;&#8212;&#8201;except that this value now comes from <code>else</code>, not <code>if</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_loops">Loops</h4>
<div class="paragraph">
<p>Loops are more complicated, because we have <code>do</code>, <code>?do</code>, <code>loop</code>, <code>+loop</code>,
<code>unloop</code>, and <code>leave</code> to take care of. These can call up to three addresses: One
for the normal looping action (<code>loop</code> and <code>+loop</code>), one to skip over the loop at
the beginning (<code>?do</code>) and one to skip out of the loop (<code>leave</code>).</p>
</div>
<div class="paragraph">
<p>Based on a suggestion by Garth Wilson, we begin each loop in run-time by saving
the address after the whole loop construct to the Return Stack. That way,
<code>leave</code> and <code>?do</code> know where to jump to when called, and we don&#8217;t interfere with
any <code>if</code>-<code>then</code> structures. On top of that address, we place the limit and start
values for the loop.</p>
</div>
<div class="paragraph">
<p>The key to staying sane while designing these constructs is to first make
a list of what we want to happen at compile time and what at run time. Let&#8217;s
start with a simple <code>do</code>-<code>loop</code>.</p>
</div>
<div class="sect4">
<h5 id="_code_do_code_at_compile_time"><code>do</code> at compile-time:</h5>
<div class="ulist">
<ul>
<li>
<p>Remember current address (in other words, <code>here</code>) on the Return Stack (!) so
we can later compile the code for the post-loop address to the Return Stack</p>
</li>
<li>
<p>Compile some dummy values to reserve the space for said code</p>
</li>
<li>
<p>Compile the run-time code; we&#8217;ll call that fragment (<code>do</code>)</p>
</li>
<li>
<p>Push the current address (the new <code>here</code>) to the Data Stack so <code>loop</code> knows
where the loop contents begin</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_code_do_code_at_run_time"><code>do</code> at run-time:</h5>
<div class="ulist">
<ul>
<li>
<p>Take limit and start off Data Stack and push them to the Return Stack</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since <code>loop</code> is just a special case of <code>+loop</code> with an index of one, we can get
away with considering them at the same time.</p>
</div>
</div>
<div class="sect4">
<h5 id="_code_loop_code_at_compile_time"><code>loop</code> at compile time:</h5>
<div class="ulist">
<ul>
<li>
<p>Compile the run-time part <code>(+loop)</code></p>
</li>
<li>
<p>Consume the address that is on top of the Data Stack as the jump target for
normal looping and compile it</p>
</li>
<li>
<p>Compile <code>unloop</code> for when we&#8217;re done with the loop, getting rid of the
limit/start and post-loop addresses on the Return Stack</p>
</li>
<li>
<p>Get the address on the top of the Return Stack which points to
the dummy code compiled by <code>do</code></p>
</li>
<li>
<p>At that address, compile the code that pushes the address after the list
construct to the Return Stack at run-time</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_code_loop_code_at_run_time_which_is_code_loop_code"><code>loop</code> at run-time (which is <code>(+loop)</code>)</h5>
<div class="ulist">
<ul>
<li>
<p>Add loop step to count</p>
</li>
<li>
<p>Loop again if we haven&#8217;t crossed the limit, otherwise continue after loop</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At one glance, we can see that the complicated stuff happens at compile-time.
This is good, because we only have to do that once for each loop.</p>
</div>
<div class="paragraph">
<p>In Tali Forth, these routines are coded in assembler. With this setup, <code>unloop</code>
becomes simple (six <code>pla</code> instructions&#8201;&#8212;&#8201;four for the limit/count of <code>do</code>, two
for the address pushed to the stack just before it) and <code>leave</code> even simpler
(four <code>pla</code> instructions for the address).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_native_compiling_2">Native Compiling</h3>
<div class="paragraph">
<p>In a pure subroutine threaded code, higher-level words are merely a series of
subroutine jumps. For instance, the Forth word <code>[char]</code>, formally defined in
high-level Forth as</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: [char] char postpone literal ; immediate</pre>
</div>
</div>
<div class="paragraph">
<p>in assembler is simply</p>
</div>
<div class="listingblock">
<div class="content">
<pre>                jsr xt_char
                jsr xt_literal</pre>
</div>
</div>
<div class="paragraph">
<p>as an immediate, compile-only word. There are two problems with this method:
First, it is slow, because each <code>jsr</code>-<code>rts</code> pair consumes four bytes and 12
cycles as overhead. Second, for smaller words, the jumps use far more bytes than
the actual code. Take for instance <code>drop</code>, which in its naive form is simply</p>
</div>
<div class="listingblock">
<div class="content">
<pre>                inx
                inx</pre>
</div>
</div>
<div class="paragraph">
<p>for two bytes and four cycles. If we jump to this word as is assumed with pure
subroutine threaded Forth, we add four bytes and 12 cycles&#8201;&#8212;&#8201;double the space
and three times the time required by the actual working code.</p>
</div>
<div class="paragraph">
<p>(In practice, it&#8217;s even worse, because <code>drop</code> checks for underflow. The actual
assembler code is</p>
</div>
<div class="listingblock">
<div class="content">
<pre>                jsr underflow_1

                inx
                inx</pre>
</div>
</div>
<div class="paragraph">
<p>for five bytes and 20 cycles. We&#8217;ll discuss the underflow checks further below.)</p>
</div>
<div class="paragraph">
<p>To get rid of this problem, Tali Forth supports <strong>native compiling</strong> (also known
as inlining). The system variable <code>nc-limit</code> sets the threshold up to which a
word will be included not as a subroutine jump, but in machine language. Let&#8217;s
start with an example where <code>nc-limit</code> is set to zero, that is, all words are
compiled as subroutine jumps. Take a simple word such as</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: aaa 0 drop ;</pre>
</div>
</div>
<div class="paragraph">
<p>when compiled with an <code>nc-limit</code> of 0 and check the actual code with <code>see</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre>nt: 9AE  xt: 9B9
flags (CO AN IM NN UF HC): 0 0 0 1 0 1
size (decimal): 6

09B9  20 1C A7 20 80 8D   .. ..

9B9   A71C jsr
9BC   8D80 jsr</pre>
</div>
</div>
<div class="paragraph">
<p>(The actual addresses might vary). Our word <code>aaa</code> consists of two subroutine
jumps, one to zero and one to <code>drop</code>. Now, if we increase the threshold to 20
and define a new word with the same instructions with</p>
</div>
<div class="listingblock">
<div class="content">
<pre>20 nc-limit !
: bbb 0 drop ;</pre>
</div>
</div>
<div class="paragraph">
<p>we get different code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>see bbb
nt: 9C0  xt: 9CB
flags (CO AN IM NN UF HC): 0 0 0 1 0 1
size (decimal): 11

09CB  CA CA 74 00 74 01 20 3D  D6 E8 E8  ..t.t. = ...

9CB        dex
9CC        dex
9CD      0 stz.zx
9CF      1 stz.zx
9D1   D63D jsr
9D4        inx
9D5        inx</pre>
</div>
</div>
<div class="paragraph">
<p>Even though the definition of <code>bbb</code> is the same as <code>aaa</code>, we have totally
different code: The number 0001 is pushed to the Data Stack (the first six
bytes), then we check for underflow (the next three), and finally we
<code>drop</code> by moving X register, the Data Stack Pointer. Our word is definitely
longer, but have just saved 12 cycles.</p>
</div>
<div class="paragraph">
<p>To experiment with various parameters for native compiling, the Forth word
<code>words&amp;sizes</code> is included in <code>user_words.fs</code> (but commented out by default).
The Forth is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: words&amp;sizes ( -- )
        latestnt
        begin
                dup
        0&lt;&gt; while
                dup name&gt;string type space
                dup wordsize u. cr
                2 + @
        repeat
        drop ;</pre>
</div>
</div>
<div class="paragraph">
<p>An alternative is <code>see</code> which also displays the length of a word. One way or
another, changing <code>nc-limit</code> should show differences in the Forth
words.</p>
</div>
<div class="paragraph">
<p>While a new word may have built-in words natively compiled into it, all new
words are flagged Never-Native by default because a word needs to meet some
special criteria to be safe to native compile.  In particular, the word cannot
have any control structures (if, loop, begin, again, etc) and, if written in
assembly, cannot have any JMP instructions in it (except for error handling,
such as underflow detection).</p>
</div>
<div class="paragraph">
<p>If you are certain your new word meets these criteria, then you can enable
native compilation of this word into other words by invoking the word
<code>allow-native</code> or the word <code>always-native</code> immediately after the definition of
your new word.  The <code>allow-native</code> will use the <code>nc-limit</code> value to determine
when to natively compiled just like it does for the built-in words, and
<code>always-native</code> will always natively compile regardless of the setting of
<code>nc-limit</code>.</p>
</div>
<div class="sect3">
<h4 id="_return_stack_special_cases">Return Stack Special Cases</h4>
<div class="paragraph">
<p>There are a few words that cause problems with subroutine threaded code (STC):
Those that access the Return Stack such as <code>r&gt;</code>, <code>&gt;r</code>, <code>r@</code>, <code>2r&gt;</code>, and <code>2&gt;r</code>.
We first have to remove the return address on the top of the stack, only to
replace it again before we return to the caller. This mechanism would normally
prevent the word from being natively compiled at all, because we&#8217;d try to remove
a return address that doesn&#8217;t exit.</p>
</div>
<div class="paragraph">
<p>This becomes clearer when we examine the code for <code>&gt;r</code> (comments
removed):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xt_r_from:
                pla
                sta tmptos
                ply

                ; --- CUT FOR NATIVE CODING ---

                dex
                dex
                pla
                sta 0,x
                pla
                sta 1,x

                ; --- CUT FOR NATIVE CODING ---

                phy
                lda tmptos
                pha

z_r_from:       rts</pre>
</div>
</div>
<div class="paragraph">
<p>The first three and last three instructions are purely for housekeeping with
subroutine threaded code. To enable this routine to be included as native code,
they are removed when native compiling is enabled by the word <code>compile,</code> This
leaves us with just the six actual instructions in the center of the routine to
be compiled into the new word.</p>
</div>
</div>
<div class="sect3">
<h4 id="_underflow_stripping">Underflow Stripping</h4>
<div class="paragraph">
<p>As described above, every underflow check adds three bytes to the word being
coded. Stripping this check by setting the <code>strip-underflow</code> system variable
(named <code>uf-strip</code> in the source code) to <code>true</code> simply removes these three bytes
from new natively compiled words.</p>
</div>
<div class="paragraph">
<p>It is possible, of course, to have lice and fleas at the same time. For
instance, this is the code for <code>&gt;r</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xt_to_r:
                pla
                sta tmptos
                ply

                ; --- CUT HERE FOR NATIVE CODING ---

                jsr underflow_1

                lda 1,x
                pha
                lda 0,x
                pha

                inx
                inx

                ; --- CUT HERE FOR NATIVE CODING ---

                phy
                lda tmptos
                pha

z_to_r:         rts</pre>
</div>
</div>
<div class="paragraph">
<p>This word has <em>both</em> native compile stripping and underflow detection. However,
both can be removed from newly native code words, leaving only the eight byte
core of the word to be compiled.</p>
</div>
</div>
<div class="sect3">
<h4 id="_enabling_native_compling_on_new_words">Enabling Native Compling on New Words</h4>
<div class="paragraph">
<p>By default, user-defined words are flagged with the Never-Native (NN)
flag.  While the words used in the definition of the new word might
have been natively compiled into the new word, this new word will
always be compiled with a JSR when used in future new words.  To
override this behavior and allow a user-defined word to be natively
compiled, the user can use the <code>always-native</code> word just after the
definition has been completed (with a semicolon).  An example of doing
this might be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: double dup + ; always-native</pre>
</div>
</div>
<div class="paragraph">
<p>Please note adding the always-native flag to a word overrides the
never-native flag and it also causes the word to be natively compiled
regardless of the setting of <code>nc_limit</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not apply always-native to a word that has any kind of
control structures in it, such as <code>if</code>, <code>case</code> or any kind of loop.
If these words ever get native compiled, the JMP instructions used in
the control structures are copied verbatim, causing them to jump back
into the original words.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
When adding your own words in assembly, if a word has a <code>jmp</code>
instruction in it, it should have the NN (Never Native) flag set in the
headers.asm file and should never have the AN (Always Native) flag set.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_code_cmove_code_code_cmove_code_and_code_move_code"><code>cmove</code>, <code>cmove&gt;</code> and <code>move</code></h3>
<div class="paragraph">
<p>The three moving words <code>cmove</code>, <code>cmove&gt;</code> and <code>move</code> show subtle differences
that can trip up new users and are reflected by different code under the hood.
<code>cmove</code> and <code>cmove&gt;</code> are the traditional Forth words that work on characters
(which in the case of Tali Forth are bytes), whereas <code>move</code> is a more modern
word that works on address units (which in our case is also bytes).</p>
</div>
<div class="paragraph">
<p>If the source and destination regions show no overlap, all three words work the
same. However, if there is overlap, <code>cmove</code> and <code>cmove&gt;</code> demonstrate a behavior
called "propagation" or "clobbering" : Some of the characters are overwritten.
<code>move</code> does not show this behavior. This example shows the difference:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>create testbuf  char a c,  char b c,  char c c,  char d c,  ( ok )
testbuf 4 type  ( abcd ok )
testbuf dup char+ 3  cmove  ( ok )
testbuf 4 type ( aaaa ok )</pre>
</div>
</div>
<div class="paragraph">
<p>Note the propagation in the result. <code>move</code>, however, doesn&#8217;t propagate.
The last two lines would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>testbuf dup char+ 3  move  ( ok )
testbuf 4 type  ( aabc ok )</pre>
</div>
</div>
<div class="paragraph">
<p>In practice, <code>move</code> is usually what you want to use.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_developing">Developing</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
After spending an entire weekend wrestling with blocks files, stacks, and
the like, I was horrified and convinced that I had made a mistake. Who
in their right mind would want to program in this godforsaken language! <a href="#DH">[DH]</a>
</blockquote>
<div class="attribution">
&#8212; Doug Hoffman<br>
<cite>Some notes on Forth from a novice user</cite>
</div>
</div>
<div class="sect2">
<h3 id="_adding_new_words">Adding New Words</h3>
<div class="paragraph">
<p>The simplest way to add new words to Tali Forth is to include them in the file
<code>forth_code/user_words.fs</code>. This is the suggested place to put them for personal
use.</p>
</div>
<div class="paragraph">
<p>To add words to the permanent set, it is best to start a pull request on the
GitHub page of Tali Forth. How to setup and use <code>git</code> and GitHub is beyond the
scope of this document&#8201;&#8212;&#8201;we&#8217;ll just point out that they are not as complicated as
they look, and they make experimenting a lot easier.</p>
</div>
<div class="paragraph">
<p>During development, Tali Forth tends to follow a sequence of steps for new words:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If it is an ANS Forth word, first review the standard online. In some cases,
there is a reference implementation that can be used.</p>
</li>
<li>
<p>Otherwise, check other sources for a high-level realization of the word, for
instance Jonesforth or Gforth. A direct copy is usually not possible (or legally
allowed, given different licenses), but studying the code provides hints for
a Tali Forth version.</p>
</li>
<li>
<p>Write the word in Forth in the interpreter. After it has been tested
interactively, add a high-level version to the file <code>forth_code/forth_words.fs</code>.</p>
</li>
<li>
<p>Add automatic tests for the new word to the test suite. Ideally, there will
be test code included in the ANS Forth specification. If not, document what
the test does.</p>
</li>
<li>
<p>In a further step, if appropriate, convert the word to
assembler. This requires adding an entry to <code>headers.asm</code> and the
code itself to <code>native_words.asm</code>.  In this first step, it will
usually be a simple 1:1 sequence of <code>jsr</code> subroutine jumps to the
existing native Forth words.  Some special consideration is needed
for immediate words, postponed words and the word <code>does&gt;</code> (see the
section on Converting Forth to Assembly for help with these
situations).</p>
</li>
<li>
<p>If appropriate, rewrite all or some of the subroutine jumps in direct
assembler. Because we have the automatic tests in place, we can be confident
that the assembly version is correct as well.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, if you are contributing code, feel free to happily ignore this sequence
and just submit whatever you have.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deeper_changes">Deeper Changes</h3>
<div class="paragraph">
<p>Tali Forth was not only placed in the public domain to honor the tradition of
giving the code away freely. It is also to let people play around with it and
adapt it to their own machines. This is also the reason it is (perversely)
over-commented.</p>
</div>
<div class="paragraph">
<p>To work on the internals of Tali Forth, you will need the Ophis assembler.</p>
</div>
<div class="sect3">
<h4 id="_the_ophis_assembler">The Ophis Assembler</h4>
<div class="paragraph">
<p>Michael Martin&#8217;s Ophis Cross-Assembler can be downloaded from
<a href="http://michaelcmartin.github.io/Ophis/" class="bare">http://michaelcmartin.github.io/Ophis/</a>. It uses a slightly different format than
other assemblers, but is in Python and therefore will run on pretty much any
operating system. To install Ophis on Windows, use the link provided above. For
Linux:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>git clone https://github.com/michaelcmartin/Ophis
cd Ophis/src
sudo python setup.py install</pre>
</div>
</div>
<div class="paragraph">
<p>Switch to the folder where the Tali code lives, and run the Makefile with a
simple <code>make</code> command. This also updates the file listings in the <code>docs</code> folder.</p>
</div>
<div class="paragraph">
<p>Ophis has some quirks. For instance, you cannot use math symbols in label names,
because it will try to perform those operations. Use underscores instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="_general_notes">General Notes</h4>
<div class="ulist">
<ul>
<li>
<p>The X register is used as the Data Stack Pointer (DSP) and should only be used
if there is no other alternative.</p>
</li>
<li>
<p>The Y register, however, is free to be changed by subroutines. This also means
it should not be expected to survive subroutines unchanged.</p>
</li>
<li>
<p>Natively coded words generally should have exactly one point of entry&#8201;&#8212;&#8201;the
<code>xt_word</code> link&#8201;&#8212;&#8201;and exactly one point of exit at <code>z_word</code>. In may cases,
this requires a branch to an internal label <code>_done</code> right before <code>z_word</code>.</p>
</li>
<li>
<p>Because of the way native compiling works, the trick of combining
<code>jsr</code>-<code>rts</code> pairs to a single <code>jmp</code> instruction (usually) doesn&#8217;t work.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_coding_style">Coding Style</h4>
<div class="paragraph">
<p>Until there is a tool for Ophis assembly code that formats the source file the
way gofmt does for Go (golang), the following format is suggested.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tabs are <strong>eight characters long</strong> and converted to spaces.</p>
</li>
<li>
<p>Opcodes are indented by <strong>two tabs</strong>.</p>
</li>
<li>
<p>Function-like routines are followed by a one-tab indented "function doc string"
based on the Python 3 format: Three quotation marks at the start, three at the
end in their own line, unless it is a one-liner. This should make it easier to
automatically extract the docs for them at some point.</p>
</li>
<li>
<p>The native words have a special comment format with lines that start with <code>##</code>
that allows the automatic generation of word lists by a tool in the tools
folder, see there for details.</p>
</li>
<li>
<p>Assembler mnemonics are lower case. I get enough uppercase insanity writing German,
thank you very much.</p>
</li>
<li>
<p>Hex numbers are, however, upper case, such as <code>$FFFE</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The Ophis assembler interprets numbers with a leading zero as octal.
This can be an annoying source of errors.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Numbers in mnemonics are a stripped-down as possible to reduce
visual clutter: use <code>lda 0,x</code> instead of <code>lda $00,x</code>.</p>
</li>
<li>
<p>Comments are included like popcorn to help readers who are new both to Forth
and 6502 assembler.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_converting_forth_to_assembly">Converting Forth to Assembly</h3>
<div class="paragraph">
<p>When converting a Forth word to assembly, you will need to take the Forth
definition and process it word by word, in order, into assembly.  All of the
words used in the definition need to already be in assembly.</p>
</div>
<div class="paragraph">
<p>The processing is different for regular, immediate, and postponed words, with
special handling required for the word <code>does&gt;</code>.  These are all covered below,
with examples.  Take each word in the definition, determine which type of word
it is, and then follow the steps outlined below for that word type.</p>
</div>
<div class="paragraph">
<p>Once the word has been converted, a dictionary header needs to be added for it
in headers.asm.  This process is covered in detail at the end of this section.</p>
</div>
<div class="sect3">
<h4 id="_processing_regular_non_immediate_words">Processing Regular (Non-Immediate) Words</h4>
<div class="paragraph">
<p>If the definition word you are processing is not immediate (you can check this
with <code>see</code>, eg. <code>see dup</code> and make sure the IM flag is 0) then it just
translates into a JSR to the xt (execution token) of that word.  The xt is just
a label that begins with <code>xt_</code> followed by the name (spelled out, in the case of
numbers and symbols) of the word.</p>
</div>
<div class="paragraph">
<p>As an example, let&#8217;s turn the following definition into assembly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: getstate state @ ;</pre>
</div>
</div>
<div class="paragraph">
<p>Translates into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>; ## GETSTATE ( -- n ) "Get the current state"
; ## "getstate" coded Custom
.scope
xt_getstate:
                jsr xt_state
                jsr xt_fetch ; @ is pronounced "fetch" in Forth.
z_getstate:
                rts
.scend</pre>
</div>
</div>
<div class="paragraph">
<p>The above code would be added to native_words.asm, probably right after
get-order.  native_words.asm is roughly in alphabetical order with a few odd
words that need to be close to each other.</p>
</div>
<div class="paragraph">
<p>The header above the code is in a special format used to track where words come
from and their current status.  It is parsed by a tool that helps to track
information about the words, so the format (including the ##s) is important.
The first line has the name (which is uppercase, but needs to match whatever
comes after the xt_ and z_ in the labels below it), the input and output stack
parameters in standard Forth format, and a string that has a short description
of what the word does.  The second line has a string showing the name as it
would be typed in Forth (useful for words with symbols in them), the current
testing status (coded, tested, auto), and where the word comes from (ANS,
Gforth, etc.)  See the top of native_words.asm for more information on the
status field, but "coded" is likely to be the right choice until you&#8217;ve
thoroughly tested your new word.</p>
</div>
<div class="paragraph">
<p>The <code>.scope</code> and <code>.scend</code> are special directives to the Ophis assembler to
create a scope for local labels.  Local labels begin with an underscore "_" and
are only visible within the same scope.  This allows multiple words to all have
a <code>_done:</code> label, for example, and each word will only branch to its own local
version of <code>_done:</code> found within its scope.  Any branching within the word
(eg. for ifs and loops) should be done with local labels.  Labels without an
underscore at the beginning are globally available.</p>
</div>
<div class="paragraph">
<p>The labels xt_xxxx and z_xxxx need to be the entry and exit point, respectively,
of your word.  The xxxx portion should be your word spelled out (eg. numbers and
symbols spelled out with underscores between them).  Although allowed in the
Forth word, the dash "-" symbol is not allowed in the label (the assembler will
try to do subtraction), so it is replaced with an underscore anywhere it is
used.  The one and only RTS should be right after the z_xxxx label.  If you need
to return early in your word, put a <code>_done:</code> label just before the z_xxxx label
and branch to that.</p>
</div>
<div class="paragraph">
<p>You can see that the body is just a sequence of JSRs calling each existing word
in turn.  If you aren&#8217;t sure of the xt_xxxx name of a forth word, you can search
native_words.asm for the Forth word (in lowercase) in double quotes and you will
find it in the header for that word.  <code>xt_fetch</code>, above, could be found by
searching for "@" (including the quotes) if you didn&#8217;t know its name.</p>
</div>
</div>
<div class="sect3">
<h4 id="_processing_immediate_words">Processing Immediate Words</h4>
<div class="paragraph">
<p>To determine if a word is immediate, use the word <code>see</code> on it (eg. <code>see [char]</code>
for the example below).  Processing an immediate word takes a little more
detective work.  You&#8217;ll need to determine what these words do to the word being
compiled and then do it yourself in assembly, so that only what is actually
compiled into the word (in forth) shows up in your assembly.  Some immediate
words, such as <code>.(</code> don&#8217;t have any affect on the word being compiled and will
not have any assembly generated.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with the simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: star [char] * emit ;</pre>
</div>
</div>
<div class="paragraph">
<p>The fact that [char] is a square-bracketed word is a strong hint that it&#8217;s an
immediate word, but you can verify this by looking at the IM flag using <code>see
[char]</code>.  This word takes the next character (after a single space) and compiles
instructions to put it on the stack.  It also uses up the * in the input.  It
will need to be replaced with the final result, which is code to put a * on the
stack.  Checking emit shows that it&#8217;s a normal (non-immediate) word and will be
translated into assembly as a JSR.</p>
</div>
<div class="paragraph">
<p>When we go to add our word to native_words.asm, we discover that the name
xt_star is already in use (for the multiplication word <code>*</code>), so this will show how
to deal with that complication as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>; ## STAR_WORD ( -- ) "Print a * on the screen"
; ## "star" coded Custom
.scope
xt_star_word:
                ; Put a * character on the stack.
                dex             ; Make room on the data stack.
                dex
                lda #42         ; * is ASCII character 42.
                sta 0,x         ; Store in low byte of stack cell.
                stz 1,x         ; high byte is zeroed for characters.
                jsr xt_emit     ; Print the character to the screen.
z_star_word:
                rts
.scend</pre>
</div>
</div>
<div class="paragraph">
<p>We chose the labels xt_star_word and z_star_word for this word, but it will be
named "star" in the dictionary and Tali won&#8217;t confuse it with <code>*</code> for
multiplication.  The <code>[char] *</code> portion of the definition has the behavior of
compiling the instructions to put the character "*" on the stack.  We translate
that into the assembly that does that directly.  The word <code>emit</code> is a normal
word, and is just translated into a JSR.</p>
</div>
</div>
<div class="sect3">
<h4 id="_processing_postponed_words">Processing Postponed Words</h4>
<div class="paragraph">
<p>Postponed words in a definition are very easy to spot because they will have the
word <code>POSTPONE</code> in front of them.  You will still need to determine if the word
being postponed is immediate or not, as that will affect how you translate it
into assembly.</p>
</div>
<div class="paragraph">
<p>If the word being postponed is an immediate word, then it is very simple and
translates to just a JSR to the word being postponed.  In this case, the word
POSTPONE is being used to instruct Forth to compile the next word rather than
running it (immediately) when it is seen in the forth definition.  Because your
assembly is the "compiled" version, you just have to include a call to the word
being postponed.</p>
</div>
<div class="paragraph">
<p>If the word being postponed is a regular word, then you need to include assembly
to cause that word to be compiled when your word is run.  There is a helper
function <code>cmpl_subroutine</code> that takes the high byte of the address in Y and the
low byte in A to help you out with this.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll take a look at the Forth word <code>IS</code> (used with deferred words) because it
has a mix of regular, postponed immediate, and postponed regular words without
being too long.  The definition in Forth looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: is state @ if postpone ['] postpone defer! else ' defer! then ; immediate</pre>
</div>
</div>
<div class="paragraph">
<p>This has an <code>IF</code> in it, which we will need to translate into branches and will
be a good demonstration of using local labels.  This word has stateful behavior
(eg. it acts differently in INTERPRET mode than it does in COMPILE mode).  While
we could translate the "state @" portion at the beginning into JSRs to xt_state
and xt_fetch, it will be much faster to look in the state variable directly in
assembly.  You can find all of the names of internal Tali variables in
definitions.asm.</p>
</div>
<div class="paragraph">
<p>The assembly version of this (which you can find in native_words.asm as this is
the actual assembly definition of this word) is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>; ## IS ( xt "name" -- ) "Set named word to execute xt"
; ## "is"  auto  ANS core ext
        ; """http://forth-standard.org/standard/core/IS"""
.scope
xt_is:
                ; This is a state aware word with different behavior
                ; when used while compiling vs interpreting.
                ; Check STATE
                lda state
                ora state+1
                beq _interpreting
_compiling:
                ; Run ['] to compile the xt of the next word
                ; as a literal.
                jsr xt_bracket_tick

                ; Postpone DEFER! by compiling a JSR to it.
                ldy #&gt;xt_defer_store
                lda #&lt;xt_defer_store
                jsr cmpl_subroutine
                bra _done
_interpreting:
                jsr xt_tick
                jsr xt_defer_store
_done:
z_is:           rts
.scend</pre>
</div>
</div>
<div class="paragraph">
<p>In the header, you can see this word is part of the ANS standard in the extended
core word set.  The "auto" means that there are automated tests (in the tests
subdirectory) that automatically test this word.  There is also a link in the
comments (not technically part of the header) to the ANS standard for this word.</p>
</div>
<div class="paragraph">
<p>The <code>STATE @ IF</code> portion of the definition is replaced by checking the state
directly.  The state variable is 0 for interpreting and -1 ($FFFF) for
compiling.  This assembly looks directly in the state variable (it&#8217;s a 16-bit
variable, so both halves are used to check for 0).  In order to keep the
assembly in the same order as the Forth code, we branch on zero (the <code>if</code> would
have been compiled into the runtime code for this branch) to the <code>else</code> section
of the code.</p>
</div>
<div class="paragraph">
<p>The true section of the <code>if</code> has two postponed words.  Conveniently (for
demonstration purposes), the first one is an immediate word and the second is
not.  You can see that the first postponed word is translated into a JSR and the
second is translated into a call to cmpl_subroutine with Y and A filled in with
the address of the word being postponed.  Because the true section should not
run the code for the <code>else</code> section, we use a BRA to a _done label.</p>
</div>
<div class="paragraph">
<p>The <code>else</code> section of the <code>if</code> just has two regular words, so they are just
translated into JSRs.</p>
</div>
<div class="paragraph">
<p>The <code>immediate</code> on the end is handled in the header in headers.asm by adding IM
to the status flags.  See the top of headers.asm for a description of all of the
header fields.</p>
</div>
</div>
<div class="sect3">
<h4 id="_processing_does">Processing DOES&gt;</h4>
<div class="paragraph">
<p>The word <code>does&gt;</code> is an immediate word.  It is commonly used, along with <code>create</code>
(which is not immediate and can be processed normally), in defining words.
Defining words in Forth are words that can be used to declare new words.
Because it is likely to be seen in Forth code, its particular assembly behavior
is covered here.</p>
</div>
<div class="paragraph">
<p>To see how <code>does&gt;</code> is translated, we will consider the word <code>2CONSTANT</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>: 2constant ( d -- ) create swap , , does&gt; dup @ swap cell+ @ ;</pre>
</div>
</div>
<div class="paragraph">
<p>This word is from the ANS double set of words and it creates a new named
constant that puts its value on the stack when it is run.  It&#8217;s commonly used
like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>12345678. 2constant bignum
bignum d.</pre>
</div>
</div>
<div class="paragraph">
<p>The . at the end of the number makes it a double-cell (32-bit on Tali) number.</p>
</div>
<div class="paragraph">
<p>The assembly code for <code>2CONSTANT</code> (taken from native_words.asm) looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>; ## TWO_CONSTANT (C: d "name" -- ) ( -- d) "Create a constant for a double word"
; ## "2constant"  auto  ANS double
        ; """https://forth-standard.org/standard/double/TwoCONSTANT
        ; Based on the Forth code
        ; : 2CONSTANT ( D -- )  CREATE SWAP , , DOES&gt; DUP @ SWAP CELL+ @ ;
        ; """
.scope
xt_two_constant:
                jsr underflow_2

                jsr xt_create
                jsr xt_swap
                jsr xt_comma
                jsr xt_comma

                jsr does_runtime    ; does&gt; turns into these two routines.
                jsr dodoes

                jsr xt_dup
                jsr xt_fetch
                jsr xt_swap
                jsr xt_cell_plus
                jsr xt_fetch

z_two_constant: rts
.scend</pre>
</div>
</div>
<div class="paragraph">
<p>This word takes an argument, so underflow checking is added right at the top
(and the UF flag is added in headers.asm).  Underflow checking is optional, but
recommended for words that take arguments on the stack.  To add underflow
checking to your word, just call the appropriate underflow checking helper
(underflow_1 to underflow_4) based on how many cells you are expecting (minimum)
on the stack.  If there aren&#8217;t that many cells on the stack when the word is
run, an error message will be printed and the rest of the word will not be run.</p>
</div>
<div class="paragraph">
<p>This word takes a double-cell value on the stack, so underflow_2 was used.  The
underflow check must be the first line in your word.</p>
</div>
<div class="paragraph">
<p>All of the other words other than <code>does&gt;</code> in this definition are regular words,
so they just turn into JSRs.  The word <code>does&gt;</code> turns into a <code>jsr does_runtime</code>
followed by a <code>jsr dodoes</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_the_header_in_headers_asm">Adding the Header in headers.asm</h4>
<div class="paragraph">
<p>Once your word has been entered into native_words.asm with the appropriate
comment block over it and the xt_xxxx and z_xxxx labels for the entry and exit
points, it is time to add the dictionary header for your word to link it into
one of the existing wordlists.  The words here are not in alphabetical order and
are loosely grouped by function.  If you aren&#8217;t sure where to put your word, then
put it near the top of the file just under the header for <code>cold</code>.</p>
</div>
<div class="paragraph">
<p>Each header is simply a declaration of bytes and words that provides some basic
information that Tali needs to use the word, as well as the addresses of the
beginning and ending (not including the rts at the end) of your word.  That&#8217;s
why you need the xt_xxxx and z_xxxx labels in your word (where xxxx is the
spelled-out version of your word&#8217;s name).</p>
</div>
<div class="paragraph">
<p>Before we dicuss adding a word, let&#8217;s go over the form a dictionary header.  The
fields we will be filling in are described right at the top of headers.asm for
reference. We&#8217;ll look at an easy to locate word, <code>cold</code>, which is used to
perform a cold reset of Tali. It&#8217;s right near the top of the list.  We&#8217;ll also
show the word <code>ed</code>, which is currently below <code>cold</code>, because you will need to
modify it (or whatever word is currently just below <code>cold</code>) when you put your
word under <code>cold</code>.  The headers for these two words currently look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nt_cold:
        .byte 4, 0
        .word nt_bye, xt_cold, z_cold
        .byte "cold"

nt_ed:                  ; ed6502
        .byte 2, NN
        .word nt_cold, xt_ed, z_ed
        .byte "ed"</pre>
</div>
</div>
<div class="paragraph">
<p>The first component of a dictionary header is the label, which comes in the form
nt_xxxx where xxxx is the spelled out version of your word&#8217;s name.  The xxxx
should match whatever you used in your xt_xxxx and z_xxxx labels.</p>
</div>
<div class="paragraph">
<p>The next two fields are byte fields, so we create them with the Ophis assembler
<code>.byte</code> directive.  The first field is the length of the name, in characters, as
it will be typed in Tali.  The second field is the status of the word, where
each bit has a special meaning.  If there is nothing special about your word,
you will just put 0 here.  If your word needs some of the status flags, you add
them together (with +) here to form the status byte.  The table below gives the
constants you will use and a brief description of when to use them.</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
CO
</td>
<td class="hdlist2">
<p>Compile Only.  Add this if your word should only be allowed when compiling
other words.  Tali will print an error message if the user tries to run this
word in interpreted mode.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
IM
</td>
<td class="hdlist2">
<p>Immediate Word.  Add this when a word should always be run rather than
compiled (even when in compiling mode).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
NN
</td>
<td class="hdlist2">
<p>Never Native Compile (must always be called by JSR when compiled).  Add
this when your word contains a JMP instruction, or if it plays with the return
address it is called from.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
AN
</td>
<td class="hdlist2">
<p>Always Native Compile (will be native compiled when compiled).
The opcodes for this word will be copied (native compiling)
into a new word when this word is used in the definition.  For short simple words that
are just a sequence of JSRs, you can safely set this bit.  This bit should not
be set if the assembly has a JMP instruction in it (see NN above).
Note: If neither NN or AN is set, then the word might be native compiled based
on its size and the value in the Forth variable <code>nc-limit</code>.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
UF
</td>
<td class="hdlist2">
<p>Contains underflow check.  If you added a JSR to one of the underflow
checking helper functions, you should set this bit.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
HC
</td>
<td class="hdlist2">
<p>Has CFA (words created by CREATE and DOES&gt; only).  You will probably never
need this bit for words that you write in assembly.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you created a short word made out of just JSRs with underflow checking at the top, and
you wanted it to be an immediate word, you might put <code>IM+UF</code> for this field.</p>
</div>
<div class="paragraph">
<p>The next line contains three addresses, so the Ophis <code>.word</code> directive is used
here.  The first address is the nt_xxxx of the next word in the word list.  The
words are actually listed from bottom to top in this file, so this will be the
nt_xxxx label of the word just above this one in the file.  The second address
is the xt (execution token), or entry point, of your new word.  This will be
your xt_xxxx label for your word.  The third address is the end of your routine,
just before the RTS instruction.  You will use your z_xxxx label here.  The
xt_xxxx and z_xxxx are used as the bounds of your word if it ends up being
natively compiled.</p>
</div>
<div class="paragraph">
<p>In the sample headers above, you can see that <code>ed</code> links to <code>cold</code> as the next
word, and <code>cold</code> links to <code>bye</code> (not shown) as the next word.  When you go to
add your own word, you will need to adjust these linkages.</p>
</div>
<div class="paragraph">
<p>The last line is the actual name of the word, as it will be typed in forth, in
lowercase.  It uses the Ophis <code>.byte</code> directive and Ophis allows literal
strings, so you can just put the name of your word in double-quotes.  If your
word has a double-quote in it, look up <code>nt_s_quote</code> in the headers to see how
this is handled.</p>
</div>
<div class="paragraph">
<p>Although Tali is not case-sensitive, all words in the dictionary headers must be
in lowercase or Tali will not be able to find them.  The length of this string
also needs to match the length given as the first byte, or Tali will not be able
to find this word.</p>
</div>
<div class="paragraph">
<p>As an example, we&#8217;ll add the words <code>star</code> and <code>is</code> from the previous examples.
Technically, <code>is</code> is already in the dictionary, but this example will show
you how to create the header for a regular word (<code>star</code>) and for one that
requires one of the status flags (<code>is</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nt_cold:
        .byte 4, 0
        .word nt_bye, xt_cold, z_cold
        .byte "cold"

nt_star:
        .byte 4, 0
        .word nt_cold, xt_star_word, z_star_word
        .byte "star"

nt_is:
        .byte 2, IM
        .word nt_star, xt_is, z_is
        .byte "is"

nt_ed:                  ; ed6502
        .byte 2, NN
        .word nt_is, xt_ed, z_ed
        .byte "ed"</pre>
</div>
</div>
<div class="paragraph">
<p>The first thing to note is the updated linked list of words.  In order to put
the new words between <code>ed</code> and <code>cold</code>, we make <code>ed</code> link to <code>is</code>, which then
links to <code>star</code>, and that links back to <code>cold</code>.  Because this file links the
headers from the bottom to the top of the file, this actually places the new
words near the end of the dictionary.  If you use the <code>words</code> command, you will
find the new words near the end of the list.</p>
</div>
<div class="paragraph">
<p>The second thing to note is the status byte of each word.  If the word doesn&#8217;t
need any special status, then just use 0.  Neither of our added words contain
the JMP instruction (branches are OK, but JMP is not), so neither is required to
carry the NN (Never Native) flag.  The word <code>is</code>, in it&#8217;s original Forth form,
was marked as an immediate word, and we do that by putting the IM flag on it
here in the dictionary header.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_code_cheat_sheets">Code Cheat Sheets</h3>
<div class="quoteblock">
<blockquote>
Programming computers can be crazy-making. <a href="#LB2">[LB2]</a>
</blockquote>
<div class="attribution">
&#8212; Leo Brodie<br>
<cite>Thinking Forth</cite>
</div>
</div>
<div class="sect3">
<h4 id="_the_stack_drawing">The Stack Drawing</h4>
<div class="paragraph">
<p>This is your friend and should probably go on your wall or something.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="pics/stack_diagram.png" alt="stack diagram">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_coding_idioms">Coding Idioms</h4>
<div class="quoteblock">
<blockquote>
The first modern FORTH was coded in FORTRAN. Shortly thereafter it was recoded
in assembler. Much later it was coded in FORTH. <a href="#CHM2">[CHM2]</a>
</blockquote>
<div class="attribution">
&#8212; Charles Moore<br>
<cite>The Evolution of FORTH</cite>
</div>
</div>
<div class="paragraph">
<p>While coding a Forth, there are certain assembler fragments that get repeated
over and over again. These could be included as macros, but that can make the
code harder to read for somebody only familiar with basic assembly.</p>
</div>
<div class="paragraph">
<p>Some of these fragments could be written in other variants, such as the "push
value" version, which could increment the DSP twice before storing a value. We
try to keep these in the same sequence (a "dialect" or "code mannerism" if you
will) so we have the option of adding code analysis tools later.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>drop</code> cell of top of the Data Stack</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>                inx
                inx</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>push</code> a value to the Data Stack. Remember the Data Stack Pointer (DSP, the
X register of the 65c02) points to the LSB of the TOS value.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>                dex
                dex
                lda &lt;LSB&gt;      ; or pla, jsr key_a, etc.
                sta 0,x
                lda &lt;MSB&gt;      ; or pla, jsr key_a, etc.
                sta 1,x</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pop</code> a value off the Data Stack</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>                lda 0,x
                sta &lt;LSB&gt;      ; or pha, jsr emit_a, etc
                lda 1,x
                sta &lt;MSB&gt;      ; or pha, jsr emit_a, etc
                inx
                inx</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_vim_shortcuts">vim Shortcuts</h4>
<div class="paragraph">
<p>One option for these is to add abbreviations to your favorite editor, which
should of course be vim, because vim is cool. There are examples farther down.
They all assume that auto-indent is on and we are two tabs into the code, and
use <code>#</code> at the end of the abbreviation to keep them separate from the normal
words. My <code>~/.vimrc</code> file contains the following lines for work on <code>.asm</code> files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ab drop# inx&lt;tab&gt;&lt;tab&gt;; drop&lt;cr&gt;inx&lt;cr&gt;&lt;left&gt;
ab push# dex&lt;tab&gt;&lt;tab&gt;; push&lt;cr&gt;dex&lt;cr&gt;lda $&lt;LSB&gt;&lt;cr&gt;sta $00,x&lt;cr&gt;lda $&lt;MSB&gt;&lt;cr&gt;sta $01,x&lt;cr&gt;&lt;up&gt;&lt;up&gt;&lt;u&gt;
ab pop# lda $00,x&lt;tab&gt;&lt;tab&gt;; pop&lt;cr&gt;sta $&lt;LSB&gt;&lt;cr&gt;lda $01,x&lt;cr&gt;sta $&lt;MSB&gt;&lt;cr&gt;inx&lt;cr&gt;inx&lt;cr&gt;&lt;up&gt;&lt;up&gt;&lt;up&gt;&gt;</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_future_and_long_term_plans">Future and Long-Term plans</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This section is missing. See the GitHub page for further details.
</td>
</tr>
</table>
</div>
</div>
</div>
<h1 id="_tutorials" class="sect0">Tutorials</h1>
<div class="sect1">
<h2 id="_working_with_blocks">Working with Blocks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Blocks are a simple system for dealing with non-volatile storage.  Originally,
the storage medium would have been a floppy disk drive, but hobbyists are more
likely to attach I2C or SPI flash memory to their system.  These storage devices
often have more than 64K (the full address space of the 65C02) of storage, so
the block words help to deal with the larger address space and the fact that
there is a limited amount of RAM in the system.</p>
</div>
<div class="paragraph">
<p>The block words do not use a file system and expect to access the storage memory
directly.  The storage space is divided into 1K chunks, or "blocks", and each is
given a number.  On Tali, this allows for 64K blocks, or up to 64MB of storage.
The user can request that a block is brought into RAM, operate on the data, and
then request that the modified version be saved back to storage.</p>
</div>
<div class="paragraph">
<p>What the blocks hold is up to the user.  They can hold text, Forth code, or
binary data.  Support for text and Forth code is provided by Tali, and the user
can easily provide support for storing binary data in their programs, as
demonstrated in this chapter.</p>
</div>
<div class="sect2">
<h3 id="_first_steps_with_blocks">First steps with blocks</h3>
<div class="paragraph">
<p>In order to facilitate playing with blocks, Tali comes with a special word
<code>block-ramdrive-init</code> that takes the number of blocks you want to use and
allocates a RAM drive to simulate a mass-storage device.  It also sets up the
read and write vectors to routines that will move the data in and out of the
allocated RAM.</p>
</div>
<div class="paragraph">
<p>If you have an actual storage device, such as a flash memory, you will need to
write routines for transferring 1K from storage to RAM and from RAM to storage.
The addresses (xt) of these routines need to be placed in the existing variables
<code>BLOCK-READ-VECTOR</code> and <code>BLOCK-WRITE-VECTOR</code>, respectively.</p>
</div>
<div class="paragraph">
<p>To get started on this tutorial, we will use the ramdrive with 4 blocks
allocated.  If you forget this step, you will see an error message about
BLOCK-READ-VECTOR and BLOCK-WRITE-VECTOR when you try to use any of the block
words.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>4 block-ramdrive-init</pre>
</div>
</div>
<div class="paragraph">
<p>This command takes a moment as all of the block memory is initialized to the
value BLANK (a space) on the assumption you will be placing text there.  When
complete, you will have 4 blocks (numbered 0-3) available to play with.</p>
</div>
<div class="paragraph">
<p>When using blocks for text or Forth code, the 1K block is further divided into
16 lines of 64 characters each.  Newlines are typically not used in blocks at
all, and the unused space is filled with spaces to get to the next line.  Blocks
that have this type of text data in them are also called a "screen".</p>
</div>
<div class="paragraph">
<p>To see the contents of a block in screen format, you can use the built-in <code>list</code>
command.  It takes the block number (called a screen number when storing text)
and displays the contents of that block.  Typing the command <code>0 list</code> will list
the contents of block 0.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>0 list
Screen #   0
 0
 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
 ok</pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, this screen is currently blank.  It&#8217;s actually 16 lines each
containing 64 spaces.</p>
</div>
<div class="paragraph">
<p>Block 0 is special in that it is the only block you cannot load Forth code from.
Because of this, block 0 is commonly used to hold a text description of what is
in the other blocks.</p>
</div>
</div>
<div class="sect2">
<h3 id="_editing_a_screen">Editing a screen</h3>
<div class="paragraph">
<p>In order to edit a block, we will need to bring in the screen editor.  It
lives in the EDITOR-WORDLIST, which is not used when Tali starts.  To add the
editor words, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>forth-wordlist editor-wordlist 2 set-order
( or the shorter version... )
editor-wordlist &gt;order</pre>
</div>
</div>
<div class="paragraph">
<p>This tells Tali to use both the editor words and the forth words.</p>
</div>
<div class="paragraph">
<p>You can only edit one screen at a time.  To select a screen, simply <code>list</code> it.
All further operations will edit that screen until a new screen is listed.  The
block number of the screen being edited is held in the <code>SCR</code> variable, and the
<code>list</code> word simply saves the block number there before displaying it on the
screen; many of the other editing words look in <code>SCR</code> to see which block is
being edited.</p>
</div>
<div class="paragraph">
<p>The following words can be used to edit a screen:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
list
</td>
<td class="hdlist2">
<p><code>( scr#&#8201;&#8212;&#8201;)</code> List the block in screen (16 lines of 64 chars) format.  This word also
select the given block for futher editing if desired.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
l
</td>
<td class="hdlist2">
<p><code>(&#8201;&#8212;&#8201;)</code> List the current screen (previously listead with <code>list</code>)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
el
</td>
<td class="hdlist2">
<p><code>( line#&#8201;&#8212;&#8201;)</code> Erase a line on the previously listed screen.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
o
</td>
<td class="hdlist2">
<p><code>( line#&#8201;&#8212;&#8201;)</code> Overwrite an entire line on the previously listed screen.
Enter the replacement text at the * prompt.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
enter-screen
</td>
<td class="hdlist2">
<p><code>( scr#&#8201;&#8212;&#8201;)</code> Prompt for all of the lines on the given screen number</p>
</td>
</tr>
<tr>
<td class="hdlist1">
erase-screen
</td>
<td class="hdlist2">
<p><code>( scr#&#8201;&#8212;&#8201;)</code> Erase the given screen by filling with BLANK (spaces)</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Because block 0 has already been listed above, we will simply add a message on
line 2.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>2 o
 2 * Load screen 2 to get a smiley!</pre>
</div>
</div>
<div class="paragraph">
<p>Now if we list screen 0, we should see our message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>0 list
Screen #   0
 0
 1
 2 Load screen 2 to get a smiley!
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
  ok</pre>
</div>
</div>
<div class="paragraph">
<p>Now we will enter screen 2 using <code>enter-screen</code>.  It will prompt line by line
for the text.  Pressing ENTER without typing any text will leave that line
blank.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>2 enter-screen
 0 * ( Make a smiley word and then run it!    SCC 2018-12 )
 1 * : smiley ." :)" ;
 2 *
 3 *
 4 *
 5 * smiley
 6 *
 7 *
 8 *
 9 *
10 *
11 *
12 *
13 *
14 *
15 *   ok</pre>
</div>
</div>
<div class="paragraph">
<p>It is customary for the very first line to be a comment (Tali only supports
parenthesis comments in blocks) with a description, the programmer&#8217;s initials,
and the date.  On line 1 we have entered the word definition, and on line 5 we
are running the word.</p>
</div>
<div class="paragraph">
<p>To get Tali to run this code, we use the word <code>load</code> on the block number.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>2 load :) ok</pre>
</div>
</div>
<div class="paragraph">
<p>If your forth code doesn&#8217;t fit on one screen, you can spread it across
contiguous screens and load all of them with the <code>thru</code> command.  If you had
filled screens 1-3 with forth code and wanted to load all of it, you would run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1 3 thru</pre>
</div>
</div>
<div class="paragraph">
<p>For reasons explained in the next chapter, the modified screen data is only
saved back to the mass storage (in this case, our ramdrive) when the screen
number is changed and accessed (typically with <code>list</code>).  To force Tali to save
any changes to the mass storage, you can use the <code>flush</code> command.  It takes no
arguments and simply saves any changes back to the mass storage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>flush</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_blocks_2">Working with blocks</h3>
<div class="paragraph">
<p>Blocks can also be used by applications to store data.  The block words bring
the blocks from mass storage into a 1K buffer where the data can be read or
written.  If changes are made to the buffer, the <code>update</code> word needs to be run
to indicate that there are updates to the data and that it needs to be saved
back to mass storage before another block can be brought in to the buffer.</p>
</div>
<div class="paragraph">
<p>Because the ANS spec does not specify how many buffers there are, portable Forth
code needs to assume that there is only 1, and that the loading of any block
might replace the buffered version of a previouly loaded block.  This is a very
good assumption for Tali, as it currently only has 1 block buffer.</p>
</div>
<div class="paragraph">
<p>The following words will be used to deal with blocks:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
block
</td>
<td class="hdlist2">
<p><code>( block#&#8201;&#8212;&#8201;addr )</code> Load the given block into a buffer.  If the buffer
has been updated, it will save the contents out to block storage before loading
the new block.  Returns the address of the buffer.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
buffer
</td>
<td class="hdlist2">
<p><code>( block#&#8201;&#8212;&#8201;addr )</code> Identical to block, except that it doesn&#8217;t
actually load the block from storage.  The contents in the buffer are undefined,
but will be saved back to the given block number if updated.  Returns the
address of the buffer.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
update
</td>
<td class="hdlist2">
<p><code>(&#8201;&#8212;&#8201;)</code> Mark the most recent buffer as updated (dirty) so it will be
saved back to storage at a later time.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
flush
</td>
<td class="hdlist2">
<p><code>(&#8201;&#8212;&#8201;)</code> Save any updated buffers to storage and mark all buffers empty.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
save-buffers
</td>
<td class="hdlist2">
<p><code>(&#8201;&#8212;&#8201;)</code> Save any updated buffers to storage.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
empty-buffers
</td>
<td class="hdlist2">
<p><code>(&#8201;&#8212;&#8201;)</code> Mark all buffers as empty, even if they have been
updated and not saved.  Can be used to abandon edits.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
load
</td>
<td class="hdlist2">
<p><code>( blk#&#8201;&#8212;&#8201;)</code> Interpret the contents of the given block.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following variables are used with blocks:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
BLK
</td>
<td class="hdlist2">
<p>The block number currently being interpreted by a <code>load</code> or <code>thru</code>
command. BLK is 0 when interpreting from the keyboard or from a string.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
SCR
</td>
<td class="hdlist2">
<p>The screen number currently being edited.  Set by <code>list</code>, but you can set
it yourself if you want.</p>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_a_simple_block_example">A simple block example</h4>
<div class="openblock float-group">
<div class="content">
<div class="imageblock" style="float: left">
<div class="content">
<img src="pics/blocks-block.png" alt="blocks block">
</div>
</div>
<div class="paragraph">
<p>To load a block, just give the block number to the <code>block</code> word like so:</p>
</div>
<div class="paragraph">
<p><code>1 block</code></p>
</div>
<div class="paragraph">
<p>This will load the block into the buffer and return the address of the buffer on
the stack.  The buffer will be marked as "in-use" with block 1 and also marked
as "clean".  The address on the stack can be used to access the contents of the
buffer.  As long as the buffer has not been marked as "dirty" with the word
<code>update</code>, you can call <code>block</code> again and it will simply replace the buffer with
the new block data.</p>
</div>
<div class="paragraph">
<p>Note: On larger forths with multiple buffers, using block again may bring the
requested block into a different buffer.  Tali only has a single buffer, so the
buffer contents will be replaced every time.</p>
</div>
</div>
</div>
<div class="openblock float-group">
<div class="content">
<div class="imageblock" style="float: left">
<div class="content">
<img src="pics/blocks-update.png" alt="blocks update">
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s modify the data in block 1.  The editor words handle the blocks behind the
scenes, so we will use <code>move</code> to copy some strings into the buffer.</p>
</div>
<div class="paragraph">
<p><code>( Assuming "1 block" was recently run )</code><br>
<code>( and buffer address is still there )</code><br>
<code>128 +         ( Move to line 2)</code><br>
<code>s" Hello!"</code><br>
<code>rot swap move ( Copy Hello! into line )</code><br>
<code>update        ( Tell Tali it&#8217;s modified )</code><br></p>
</div>
<div class="paragraph">
<p>These commands put the string "Hello!" onto line 2, which can be seen by running
<code>1 list</code> afterwards.  The modification, however, hasn&#8217;t been transferred to
storage yet.  If power were lost or the processor reset at this point, the data
would be lost.</p>
</div>
</div>
</div>
<div class="openblock float-group">
<div class="content">
<div class="imageblock" style="float: left">
<div class="content">
<img src="pics/blocks-newblock.png" alt="blocks newblock">
</div>
</div>
<div class="paragraph">
<p>We also want to make a change to block 3, so we will bring that block in next.</p>
</div>
<div class="paragraph">
<p><code>3 block</code></p>
</div>
<div class="paragraph">
<p>The block-handling built-in to Forth will see that the buffer is in use and is
no longer a clean copy because it has been updated.  This will cause Tali to
write block 1 back to mass storage before bringing in block 3.  Once block 3 is
in the buffer, it will be marked as "in-use" with block 3 and "clean".</p>
</div>
</div>
</div>
<div class="openblock float-group">
<div class="content">
<div class="imageblock" style="float: left">
<div class="content">
<img src="pics/blocks-update3.png" alt="blocks update3">
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s modify the data in block 3 now.</p>
</div>
<div class="paragraph">
<p><code>( Assuming "3 block" was recently run )</code><br>
<code>( and buffer address is still there )</code><br>
<code>256 +         ( Move to line 4)</code><br>
<code>s" Hi there!"</code><br>
<code>rot swap move ( Copy string into line )</code><br>
<code>update        ( Tell Tali it&#8217;s modified )</code><br></p>
</div>
<div class="paragraph">
<p>After this code is run, the buffer will be modified, marked as updated/dirty,
but once again it won&#8217;t actually be saved back to mass storage right at this
point.</p>
</div>
</div>
</div>
<div class="openblock float-group">
<div class="content">
<div class="imageblock" style="float: left">
<div class="content">
<img src="pics/blocks-flush.png" alt="blocks flush">
</div>
</div>
<div class="paragraph">
<p>To force the updated version of block 3 to be written back to mass storage, we
can use the command:</p>
</div>
<div class="paragraph">
<p><code>flush</code></p>
</div>
<div class="paragraph">
<p>If the buffer is in use and dirty, it will be written back to mass storage.
Then the buffer will be marked empty.  Flush should be called before
shutting down (when using blocks) and before swapping storage media.</p>
</div>
<div class="paragraph">
<p>If you want to write the changes but keep the block in the buffer, you can use
the command <code>save-buffers</code> instead of flush.  That would be useful in a
situation where you want to save the block changes right now, but also want to
keep making changes in the buffer.</p>
</div>
<div class="paragraph">
<p>If you want to abandon the changes in the buffer, you can use the command
<code>empty-buffers</code>.  This will not save even a dirty buffer, and marks the buffer
as empty.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_storing_binary_data_in_blocks">Storing Binary Data in Blocks</h3>
<div class="paragraph">
<p>While Tali comes built-in with support for text and Forth code in blocks,
users may also want to use blocks to hold binary data.  A user might want to do
this because the block memory space is much larger that the normal 65C02 memory
space, so a much larger dataset can be stored here than the 65C02 would be able
to support in RAM.  It may also be desirable for the data to be saved even in the
absense of power, and when block storage is implemented on a non-volatile meory,
such as EEPROM or FLASH, this is possible.</p>
</div>
<div class="paragraph">
<p>Because the format of the binary data is up to the user, Forth doesn&#8217;t directly
support the initializing, entering, retrieval, or display of binary data.
Instead, the user is expected to use the provided block words to create the
functionality needed for the application.</p>
</div>
<div class="paragraph">
<p>Unless all of the blocks in the system are used with binary data, there will
often be a mix of text and binary data blocks.  Because using some of the words
designed for text blocks, such as <code>list</code>, on a binary block could emit
characters that can mess up terminals, it is recommended to "reserve" binary
blocks.  This is done by simply adding a note in block 0 with the block numbers
being used to hold binary data, so that users of the system will know to avoid
performing text operations on those blocks.  Block 0 is also a good place to
inform the user if the routines for accessing the binary data are also stored
(as Forth code) in block storage.</p>
</div>
<div class="paragraph">
<p>In this example, we will create some words to make non-volatile arrays stored on
a flash device.  While this example can be run with the block ramdrive, using 7
blocks, it won&#8217;t be non-volatile in that case.</p>
</div>
<div class="paragraph">
<p>To get started, we will add a note to block 0 indicating the blocks we are going
to use.  The following shows an example Forth session adding this note.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>0 list
Screen #   0
 0 ( Welcome to this EEPROM! )
 1
 2 ( There are 128 blocks on this EEPROM )
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
 ok
editor-wordlist &gt;order  ok
4 o
 4 * ( Blocks 3-6 contain binary data )  ok
5 o
 5 * ( Blocks 1-2 contain the routines to access this data )  ok
l
Screen #   0
 0 ( Welcome to this EEPROM! )
 1
 2 ( There are 128 blocks on this EEPROM )
 3
 4 ( Blocks 3-6 contain binary data )
 5 ( Blocks 1-2 contain the routines to access this data )
 6
 7
 8
 9
10
11
12
13
14
15
 ok</pre>
</div>
</div>
<div class="paragraph">
<p>In this session, screen 0 is listed to locate a couple of empty lines for the
message.  Then the editor-wordlist is added to the search order to get the word
<code>o</code>, which is used to overwrite lines 4 and 5 on the current screen.  Finally,
<code>l</code> (also from the editor-wordlist) is used to list the current screen again to
see the changes.</p>
</div>
<div class="paragraph">
<p>Now that the blocks have been reserved, we will put our code in blocks 1 and 2.
It is recommended to put the access words for the binary data into the same
block storage device so that the data can be recovered on a different system if
needed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1 enter-screen
 0 * ( Block Binary Data Words  1/2                 SCC 2018-12 )
 1 * ( Make a defining word to create block arrays. )
 2 * : block-array: ( base_block# "name" -- ) ( index -- addr )
 3 *   create ,     ( save the base block# )
 4 *   does&gt; @ swap ( base_block# index )
 5 *     cells      ( Turn index into byte index )
 6 *     1024 /MOD  ( base_block# offset_into_block block# )
 7 *     rot +      ( offset_into_block real_block# )
 8 *     block      ( offset_into_block buffer_address )
 9 *     + ;
10 * ( Create the array starting at block 3           )
11 * ( With 4 blocks, max index is 2047 - not checked )
12 * 3 block-array: myarray
13 * ( Some helper words for accessing elements )
14 * : myarray@ ( index -- n ) myarray @ ;
15 * : myarray! ( n index -- ) myarray ! update ;  ok
2 enter-screen
 0 * ( Block Binary Data Words cont. 2/2            SCC 2018-12 )
 1 * ( Note: For both words below, end-index is one past the )
 2 * ( last index you want to use.                           )
 3 *
 4 * ( A helper word to initialize values in block arrays to 0 )
 5 * : array-zero ( end_index start_index -- )
 6 *     ?do 0 i myarray! loop ;
 7 *
 8 * ( A helper word to view a block array )
 9 * : array-view ( end_index start_index -- )
10 *     ( Print 10 values per line with 6 digit columns. )
11 *     ?do i 10 mod 0= if cr then i myarray @ 6 .r loop ;
12 *
13 *
14 *
15 *   ok
1 2 thru  ok</pre>
</div>
</div>
<div class="paragraph">
<p><code>enter-screen</code> is used to enter screens 1 and 2 with the code for initializing
(<code>array-zero</code>), accessing (<code>myarray</code>, <code>myarray@</code>, and <code>myarray!</code>), and viewing
(<code>array-view</code>) the binary data.  Once the Forth code has been placed into blocks
1 and 2, a <code>thru</code> command is used to load the code.</p>
</div>
<div class="paragraph">
<p>The word <code>block-array:</code> is a defining word.  You place the starting block number
(in our case, 3) on the stack before using the <code>block-array:</code> and give a new
name after it.  Any time that new name (<code>myarray</code>, created on line 12 of screen
1 in this case) is used, it expects an index (into an array of cells) on the
stack.  It will load the correct block into a buffer and compute address in that
buffer for the index given.  Because cells are 2 bytes on Tali, the total number
of cells is 4096/2=2048.  The indices start at 0, so the index of the last valid
cell is 2047.  Please note that the code given above does not range check the
index, so it is up to the user to not exceed this value or to add range
checking.</p>
</div>
<div class="paragraph">
<p>The blocks 3-6 being used to store the array may be uninitialized or may have
been initialized for text.  We&#8217;ll use the helper words to initialize all of the
elements in the array, and then place some data into the array.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>2048 0 array-zero  ok
50 0 array-view
     0     0     0     0     0     0     0     0     0     0
     0     0     0     0     0     0     0     0     0     0
     0     0     0     0     0     0     0     0     0     0
     0     0     0     0     0     0     0     0     0     0
     0     0     0     0     0     0     0     0     0     0 ok
12345 4 myarray!  ok
6789 10 myarray!  ok
4 myarray@ . 12345  ok
50 0 array-view
     0     0     0     0 12345     0     0     0     0     0
  6789     0     0     0     0     0     0     0     0     0
     0     0     0     0     0     0     0     0     0     0
     0     0     0     0     0     0     0     0     0     0
     0     0     0     0     0     0     0     0     0     0 ok
flush  ok</pre>
</div>
</div>
<div class="paragraph">
<p>In the above session, all the values in the array are zeroed.  Next, the first
50 values (indices 0-49) are viewed.  Some numbers are stored at indices 4 and
10.  The value at index 4 is fetched and printed, and the first 50 values
are displayed again.  Finally, all buffers are flushed to make sure any changes
are permanent.</p>
</div>
<div class="paragraph">
<p>If the system is powered down and back up at a later time, the data can be
accessed by first loading the helper words in blocks 1-2.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1 2 thru  ok
50 0 array-view
     0     0     0     0 12345     0     0     0     0     0
  6789     0     0     0     0     0     0     0     0     0
     0     0     0     0     0     0     0     0     0     0
     0     0     0     0     0     0     0     0     0     0
     0     0     0     0     0     0     0     0     0     0 ok</pre>
</div>
</div>
<div class="paragraph">
<p>The methods shown in this example require the user to run <code>flush</code> or
<code>save-buffers</code> before powering down the system. If the user wants the new values
written to block storage immediately after being modified, the word <code>myarray!</code>
could be modified to run <code>save-buffers</code> after storing the new value.  As a side
effect, however, an entire 1K block would be overwritten every time a single
value was changed, making the routine much slower.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_code_ed_code_line_based_editor_a_id_ed_tutorial_a">The <code>ed</code> Line-Based Editor<a id="ed-tutorial"></a></h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
While TECO was known for its complex syntax, ed must have been
the most user-hostile editor ever created.<a href="#PHS">[PHS]</a>
</blockquote>
<div class="attribution">
&#8212; Peter H. Saulus<br>
<cite>The Daemon, the Gnu and the Penguin</cite>
</div>
</div>
<div class="paragraph">
<p>Tali Forth 2 comes with two editors, a traditional block-based editor of the
type common with Forth, and the line-based editor <code>ed</code>, formally known as
<code>ed6502</code>. This second editor is included because I like line-based editors.
More to the point, the saved text uses less space than the block editor, where
every block, regardless of how much text is in it, uses 1024 bytes. In contrast,
<code>ed</code> uses one byte per character plus one end-of-line character per line.</p>
</div>
<div class="paragraph">
<p>The original <code>ed</code> was created by Ken Thompson and Dennis Ritchie along with the
Unix operating system, sometime about 1971. It is terse, robust, and has a
reputation for being completely unhelpful. Any error is just signaled with a
question mark (<code>?</code>). There isn&#8217;t even a prompt unless it is explicitly turned
on.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Newer versions of <code>ed</code> allow an option to display an explanation of the
last error, but Tali doesn&#8217;t have space for that. Error messages are for wimps.
And who really needs a prompt anyway?
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Commands in <code>ed</code> are single-letter commands like <code>a</code> or <code>p</code>. They can be
prefixed with a combination of letters and special characters to designate the
line numbers the command is supposed to work on. For example, <code>1,4d</code> deletes
lines one to four.</p>
</div>
<div class="sect2">
<h3 id="_first_steps_with_code_ed_code">First steps with <code>ed</code></h3>
<div class="paragraph">
<p>Like its big brother <code>vi</code> (or its newer incarnation <code>vim</code>), <code>ed</code> has various
modes, except that <code>ed</code> is so small it only has two. We start out in the
<em>command mode</em> in which we accept, well, commands. Using <code>a</code> or <code>i</code> switches to
<em>input mode</em> where all of the characters are added to the buffer.</p>
</div>
<div class="paragraph">
<p>The first important thing is about how to get out of command mode: You type <code>.</code>
(the period or dot) at the beginning of the line as the only character to return
to command mode. A typical <code>ed</code> session will look something like
this:<sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnote_4" title="View footnote.">4</a>]</sup></p>
</div>
<div class="listingblock">
<div class="content">
<pre>        ed      <i class="conum" data-value="1"></i><b>(1)</b>
        a       <i class="conum" data-value="2"></i><b>(2)</b>
        After time adrift among open stars
        Along tides of light
        And through shoals of dust
        I will return to where I began.
        .       <i class="conum" data-value="3"></i><b>(3)</b>
                <i class="conum" data-value="4"></i><b>(4)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Start the editor from Tali Forth. It doesn&#8217;t take anything on the stack.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Switch to insert mode and type the text.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The dot alone on the line signals the end of the text. We return to command
mode.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The cursor moves down to the next line, without printing any confirmation.
This is where you continue typing.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you first use <code>ed</code>, you&#8217;ll spend lots of time printing what you&#8217;ve written
and trying to figure out what the line numbers are. The commands for this are
<code>p</code> (print without line numbers) and <code>n</code> (print with line numbers). The first
special character prefix we&#8217;ll use for this is <code>%</code> (the percent symbol,
alternatively a comma) works as well. This makes the command that follows it
apply to the whole text.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        %p      <i class="conum" data-value="1"></i><b>(1)</b>
        After time adrift among open stars
        Along tides of light
        And through shoals of dust
        I will return to where I began.
                <i class="conum" data-value="2"></i><b>(2)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This could also be <code>,p</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Note again we return to an empty line.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>%n</code> (or <code>,n</code>) command is usually more helpful because it gives you line
numbers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        ,n      <i class="conum" data-value="1"></i><b>(1)</b>
        1       After time adrift among open stars
        2       Along tides of light
        3       And through shoals of dust
        4       I will return to where I began.</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This could also be <code>%n</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Line numbers are indented automatically by one tab. Note we start counting with
1, not 0, because this is an editor for real humans, not computer science types.</p>
</div>
<div class="paragraph">
<p>Just entering the command directly without a line number will print the
<em>current line</em>, which <code>ed</code> adjusts depending on what you are doing. After <code>a</code> it
is the last line.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To find out which is the current line, type the <code>=</code> (equal sign) command.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This session could continue as such:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        n
        4       I will return to where I began.</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>d</code> (delete) command removes a line. Let&#8217;s explicitly remove the second
line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        2d</pre>
</div>
</div>
<div class="paragraph">
<p>Again, <code>ed</code> provides absolutely no feedback on what just happened. We need to
call <code>%n</code> (or <code>,n</code>) again if we are unsure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        %n
        1       After time adrift among open stars
        2       And through shoals of dust
        3       I will return to where I began.</pre>
</div>
</div>
<div class="paragraph">
<p>Note that lines three and four have moved up&#8201;&#8212;&#8201;they are now lines two and
three.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To avoid confusion, when you have to delete a large number of lines, start
at the bottom and move upwards towards the beginning of the text.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can also use comma-separated numbers to indicate a range of lines (say,
<code>1,2d</code>). As you probably will have guessed, or the <code>,</code> (or <code>%</code>) prefix can be
used to delete the complete text. Be careful&#8201;&#8212;&#8201;in the real version of <code>ed</code>, you
can undo changes with the <code>u</code> command.  Tali doesn&#8217;t support this option. If you
delete something, it&#8217;s gone.</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s say we want to put back the second line. We can do this again with
<code>a</code>, to add text <em>after</em> the first line. Note there is currently also no way to
paste the line we have just deleted. If we can&#8217;t remember it, we&#8217;re in trouble.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        1a      <i class="conum" data-value="1"></i><b>(1)</b>
        I, uh, did something
        .       <i class="conum" data-value="2"></i><b>(2)</b>
                <i class="conum" data-value="3"></i><b>(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add text <em>after</em> the first line.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The dot takes us out again.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Still no feedback.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Displaying our whole text with <code>%n</code> again, we get:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        %n
        1       After time adrift among open stars
        2       I, uh, did something
        3       And through shoals of dust
        4       I will return to where I began.</pre>
</div>
</div>
<div class="paragraph">
<p>Lines three and four are numbered again as they were.</p>
</div>
<div class="paragraph">
<p>Instead of using <code>1a</code>, we could have used <code>2i</code> to insert the new line <em>before</em>
line number two. Most long-term users of <code>ed</code> (like, all three of them) develop
a preference for <code>a</code> or <code>i</code>. This is easy because <code>ed</code> accepts <code>0a</code> as a way to
add new lines <em>before</em> the first line. In most other circumstances, line <code>0</code> is
illegal. There is also the <code>$</code> prefix for the last line.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The combination <code>$=</code> will print the number of the last line. Just <code>=</code> will
print the current line.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_saving_your_text">Saving Your Text</h3>
<div class="paragraph">
<p>The only way to currently save text with <code>ed</code> on Tali is to write the buffer to
a location in memory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        7000w   <i class="conum" data-value="1"></i><b>(1)</b>
        128     <i class="conum" data-value="2"></i><b>(2)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The address in memory comes immediately before the <code>w</code> command with no
space.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>ed</code> returns the number of characters written, including the end-of-line
characters. Yes, this is actually feedback of sorts. But don&#8217;t get cocky!</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>ed</code> currently only works with decimal numbers.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>w</code> command was originally created for files. Tali doesn&#8217;t have files, just
addresses. This means that you can write anything anywhere, at the risk of
completely destroying your system. Really, really don&#8217;t write anything to 0000,
which will overwrite the zero page of the 65c02.</p>
</div>
</div>
<div class="sect2">
<h3 id="_getting_out_of_code_ed_code">Getting Out of <code>ed</code></h3>
<div class="paragraph">
<p>We can leave <code>ed</code> at any time with <code>Q</code> - note this is the capital letter "q".
Any unsaved (unwritten, rather) text will be lost. The lowercase <code>q</code> will refuse
to quit if there is still unwritten text. When it doubt, use <code>q</code>.</p>
</div>
<div class="paragraph">
<p>To access your text from the Forth command line, you can use standard Forth
words like <code>type</code>. Since <code>ed</code> leaves <code>( addr u )</code> on the stack when it quits,
you can just use it directly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        cr type                 <i class="conum" data-value="1"></i><b>(1)</b>
        After time adrift among open stars
        I, uh, did something
        And through the shoals of dust
        I will return to where I began.
         ok                     <i class="conum" data-value="2"></i><b>(2)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Place the <code>cr</code> word before the <code>type</code> word to prevent the first line of the
text being placed right after the Forth command.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We&#8217;re back to the helpful Forth interpreter.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also use <code>dump</code> to show how compact <code>ed</code> stores the text:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>dump
1B58  41 66 74 65 72 20 74 69  6D 65 20 61 64 72 69 66  After ti me adrif
1B68  74 20 61 6D 6F 6E 67 20  6F 70 65 6E 20 73 74 61  t among  open sta
1B78  72 73 0A 41 6E 64 20 74  68 65 6E 20 49 2C 20 75  rs.And t hen I, u <i class="conum" data-value="1"></i><b>(1)</b>
1B88  68 2C 20 64 69 64 20 73  6F 6D 65 74 68 69 6E 67  h, did s omething
1B98  0A 41 6E 64 20 74 68 72  6F 75 67 68 20 74 68 65  .And thr ough the
1BA8  20 73 68 6F 61 6C 73 20  6F 66 20 64 75 73 74 0A   shoals  of dust.
1BB8  49 20 77 69 6C 6C 20 72  65 74 75 72 6E 20 74 6F  I will r eturn to
1BC8  20 77 68 65 72 65 20 49  20 62 65 67 61 6E 2E 0A   where I  began..
1BD8   ok</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The dot in the text part of the hexdump at address $157A is not the period at
the end of the line, but the way <code>dump</code> displays the non-printable $0A
character. This control character marks the end of the line.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note this text uses 128 bytes, in the block editor it would use one block of
1024 bytes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_programming_with_code_ed_code">Programming with <code>ed</code></h3>
<div class="paragraph">
<p>You can use <code>ed</code> to write and save programs. Fire it up as usual:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	ed
	a
	: myloop ( -- )         <i class="conum" data-value="1"></i><b>(1)</b>
	    101 1 do i . loop   <i class="conum" data-value="2"></i><b>(2)</b>
	;
	myloop
	.
	7000w
	48
	q</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Type normally as you would with any other editor.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Any indentation has to be provided by hand. There is no auto-indent.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Running <code>evaluate</code> will now print the numbers from 1 to 100.</p>
</div>
</div>
<div class="sect2">
<h3 id="_further_information">Further Information</h3>
<div class="paragraph">
<p>This tutorial will be expanded as new commands become available. In the meantime,
there are other sources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Ed_(text_editor" class="bare">https://en.wikipedia.org/wiki/Ed_(text_editor</a>) Background and history</p>
</li>
<li>
<p><a href="https://www.gnu.org/software/ed/ed.html" class="bare">https://www.gnu.org/software/ed/ed.html</a> The official GNU ed page</p>
</li>
<li>
<p><a href="https://www.gnu.org/software/ed/manual/ed_manual.html" class="bare">https://www.gnu.org/software/ed/manual/ed_manual.html</a> The official GNU ed manual</p>
</li>
<li>
<p><a href="https://sanctum.geek.nz/arabesque/actually-using-ed/" class="bare">https://sanctum.geek.nz/arabesque/actually-using-ed/</a> Small tutorial of Unix ed</p>
</li>
<li>
<p><a href="http://www.psue.uni-hannover.de/wise2017_2018/material/ed.pdf" class="bare">http://www.psue.uni-hannover.de/wise2017_2018/material/ed.pdf</a> A tutorial by B. W. Kernighan (yes, <em>that</em> Kernighan).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wordlists_and_the_search_order">Wordlists and the Search Order</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A wordlist is, quite simply, a list of words that the user can run directly or
can compile into other word definitions.  Wordlists are commonly used to separate
words into different categories, often by function or application.  One of the
wordlists, called the "current" wordlist, is the list that new words will be
added to when they are created. Out of the box, Tali comes with four wordlists:
FORTH, EDITOR, ASSEMBLER, and ROOT.</p>
</div>
<div class="paragraph">
<p>Each wordlist has a unique wordlist identifier, or wid. To get the wid of the
built-in wordlists, you can use the words <code>forth-wordlist</code>, <code>editor-wordlist</code>,
<code>assembler-wordlist</code>, or <code>root-wordlist</code>.  The wid is just a simple number that
is used to reference its particular wordlist, and each of these words just
places their unique number on the stack.</p>
</div>
<div class="paragraph">
<p>When Tali performs a cold start, the search order is set to just the FORTH
wordlist and the current wordlist is also set to the FORTH wordlist.  Any new
words created by the the user at this stage will be added to the beginning of
the FORTH wordlist.</p>
</div>
<div class="paragraph">
<p>The user is also allowed to create their own wordlist with the command
<code>wordlist</code>.  This word leaves the next available wid on the stack, but it is up
to the user to remember this wid and to provide a name for this new wordlist.
This is often done by turning the new wid into a constant, as shown in the
example below.</p>
</div>
<div class="paragraph">
<p>It is often desirable to use multiple wordlists at the same time.  The "search
order" is used to determine which wordlists are in use at any given time, as well
as determining the order they are searched in.  When a word is used, each
wordlist in the search order is searched for that word.  In the case where a
word appears in multiple wordlists, the first wordlist in the search order that
contains a word of that name will be the version of the word that is used.</p>
</div>
<div class="paragraph">
<p>The data structures for the wordlists and the search order are not directly
accessable to the user, but rather are manipulated with the following set of
words:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
order
</td>
<td class="hdlist2">
<p>(&#8201;&#8212;&#8201;) Display the current search order and current wordlist.  The search order
is printed with the first wordlist on the left and the last wordlist on the
right.  After the search order, the current (compilation) wordlist is printed.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
get-order
</td>
<td class="hdlist2">
<p>(&#8201;&#8212;&#8201;widn &#8230;&#8203; wid1 n ) Get the current search order.  This has the
number of wordlists in the search order on the top of the stack, with the
wids for the wordlists, in order, under that.  Wid1 is the wordlist that will be
searched first and widn is the wordlist that will be searched last.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
set-order
</td>
<td class="hdlist2">
<p>( widn &#8230;&#8203; wid1 n&#8201;&#8212;&#8201;) Set the current search order.  This takes the
wids and the number of wordlists in the search order on the stack.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
&gt;order
</td>
<td class="hdlist2">
<p>( wid&#8201;&#8212;&#8201;) Add the given wordlist to the beginning of the search order.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
get-current
</td>
<td class="hdlist2">
<p>(&#8201;&#8212;&#8201;wid ) Get the wid for the current wordlist.  This is the
wordlist that new words will be compiled to.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
set-current
</td>
<td class="hdlist2">
<p>( wid&#8201;&#8212;&#8201;) Set the current wordlist.  New words created after this
point will go into the wordlist indicated here.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
wordlist
</td>
<td class="hdlist2">
<p>(&#8201;&#8212;&#8201;wid ) Create a new wordlist and return the wid for this new
wordlist.  Up to eight user-defined wordlists may be created this way.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
search-wordlist
</td>
<td class="hdlist2">
<p>( addr u wid&#8201;&#8212;&#8201;0 | xt 1 | xt -1) Search for a word in a specific wordlist.
The return results are identical to those returned by <code>find</code>.</p>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_using_the_built_in_wordlists">Using the built-in wordlists</h3>
<div class="paragraph">
<p>To see the search order and the current wordlist, you can use the command
<code>order</code>.  This will print the names for the built-in wordlists and the wid
number for all other wordlists.  The search order is printed with the first
wordlist on the left and the last wordlist on the right, and the current
(compilation) wordlist is given at the far right.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>order
Forth   Forth  ok</pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that the FORTH wordlist is the only wordlist in the search
order, and it&#8217;s also set as the current wordlist (where new words will go).
Typically, you will want to leave the FORTH wordlist in your search order.  This
contains all of the normal Forth words, as well as all of the words used to
modify the search order.  Most of the time you will simply want to add a
wordlist to the search order and the word <code>&gt;order</code> is very handy for doing
this.  To add the block editor words, you might say:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>editor-wordlist &gt;order</pre>
</div>
</div>
<div class="paragraph">
<p>If you are working with assembly code in blocks, you may want both the block
editor words and the assembler words available at the same time.  In that event,
you would say:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>editor-wordlist &gt;order assembler-wordlist &gt;order
( or you could say... )
forth-wordlist editor-wordlist assembler-wordlist 3 set-order</pre>
</div>
</div>
<div class="paragraph">
<p>Both of these lines have the same effect.  They put the ASSEMBLER wordlist
first, the EDITOR wordlist next, and the FORTH wordlist last.</p>
</div>
<div class="paragraph">
<p>To check the results from above, you might use the <code>order</code> command again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>order
Assembler Editor Forth   Forth  ok</pre>
</div>
</div>
<div class="paragraph">
<p>Here you can see that the ASSEMBLER wordlist will be searched first, with the
EDITOR wordlist searched next, and the FORTH wordlist searched last.  You can
also see that the FORTH wordlist is still the current (compilation) wordlist.</p>
</div>
<div class="paragraph">
<p>The wordlist that new words go into is controlled separately with
<code>set-current</code>.  It is possible, and sometimes even desirable, to set the
compilation wordlist to one that is not in the search order.  To add some words
to the EDITOR wordlist, for example, one might say:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>editor-wordlist set-current</pre>
</div>
</div>
<div class="paragraph">
<p>Checking the results with <code>order</code> shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>order
Assembler Editor Forth   Editor  ok</pre>
</div>
</div>
<div class="paragraph">
<p>Any new words created after this point will be added to the EDITOR wordlist.  To
switch back to using the default FORTH wordlist for new words, you would say:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>forth-wordlist set-current</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_making_new_wordlists">Making New Wordlists</h3>
<div class="paragraph">
<p>Using the <code>wordlist</code> command, a new empty wordlist can be created.  This command
leaves the wid on the stack, and it&#8217;s the only time you will be given this wid,
so it&#8217;s a good idea to give it a name for later use.  An example of that might
look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>\ Create a new wordlist for lighting up LEDs.
wordlist constant led-wordlist

\ Add the new wordlist to the search order.
led-wordlist &gt;order

\ Set the new wordlist as the current wordlist.
led-wordlist set-current

\ Put a word in the new wordlist.
: led-on ( commands to turn LED on ) ;</pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the new led-wordlist was added to the search order.  The
FORTH wordlist is still in the search order, so the user is allowed to use any
existing Forth words as well as any of the new words placed into the
led-wordlist, such as the <code>led-on</code> word above.  If the above code is run from a
cold start, which starts with just the FORTH wordlist in the search order and as
the current wordlist, the results of running <code>order</code> afterwards will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>order
5 Forth   5  ok</pre>
</div>
</div>
<div class="paragraph">
<p>Because Tali&#8217;s <code>order</code> command doesn&#8217;t know the name given to the new wordlist,
it simply prints the wid number.  In this case, the led-wordlist has the wid 5.
You can also see that the new wordlist is the current wordlist, so all new words
(such as <code>led-on</code> above) will be placed in that wordlist.</p>
</div>
<div class="paragraph">
<p>Wordlists can be used to hide a group of words when they are not needed (the
EDITOR and ASSEMBLER wordlists do this).  This has the benefits of keeping the
list of words given by the <code>words</code> command down to a more reasonable level as
well as making lookups of words faster.  If the ASSEMBLER wordlist is not in the
search order, for example, Tali will not spend any time searching though that
list for a word being interpreted or compiled.</p>
</div>
<div class="paragraph">
<p>If a large number of helper words are needed to create an application, it might
make sense to place all of the helper words in their own wordlist so that they
can be hidden at a later point in time by removing that wordlist from the search
order.  Any words that were created using those helper words can still be run, as
long as they are in a wordlist that is still in the search order.</p>
</div>
<div class="paragraph">
<p>In some applications, it might make sense to use the search order to hide all of
the FORTH words.  This may be useful if your program is going to use the Forth
interpreter to process the input for your program.  You can create your own
wordlist, put all of the commands the user should be able to run into it, and
then set that as the only wordlist in the search order.  Please note that if you
don&#8217;t provide a way to restore the FORTH wordlist back into the search order,
you will need to reset the system to get back into Forth.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>\ Create a wordlist for the application.
wordlist constant myapp-wordlist
myapp-wordlist set-current

\ Add some words for the user to run.
\ ...

\ Add a way to get back to Forth.
: exit forth-wordlist 1 set-order forth-wordlist set-current ;

\ Switch over to only the application commands.
myapp-wordlist 1 set-order</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_older_vocabulatory_words">Older Vocabulatory Words</h3>
<div class="paragraph">
<p>The ANS search-order set of words includes some older words that were originally
used with "vocabularies", which the wordlists replace.  Some of these words
appear to have odd behavior at first glance, however they allow some older
programs to run by manipulating the wordlists to provide the expected behavior.
Tali supports the following words with a few caveats:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ALSO</dt>
<dd>
<p>(&#8201;&#8212;&#8201;) Duplicate the first wordlist at the beginning of the search order.</p>
</dd>
<dt class="hdlist1">DEFINITIONS</dt>
<dd>
<p>(&#8201;&#8212;&#8201;) Set the current wordlist to be whatever wordlist is first
in the search order.</p>
</dd>
<dt class="hdlist1">FORTH</dt>
<dd>
<p>(&#8201;&#8212;&#8201;) Replace the first wordlist in the search order with the FORTH
wordlist.  This word is commonly used immediately after <code>only</code>.</p>
</dd>
<dt class="hdlist1">ONLY</dt>
<dd>
<p>(&#8201;&#8212;&#8201;) Set the search order to the minimum wordlist, which is the ROOT
wordlist on Tali.  This word is commonly followed by the word <code>forth</code>, which
replaced the ROOT wordlist with the FORTH wordlist.</p>
</dd>
<dt class="hdlist1">PREVIOUS</dt>
<dd>
<p>(&#8201;&#8212;&#8201;) Remove the first wordlist from the search order.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The older vocabulary words were commonly used like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>\ Use the FORTH and ASSEMBLER vocabularies.
\ Put new words in the ASSEMBLER vocabulary.
ONLY FORTH ALSO ASSEMBLER DEFINITIONS

\ Do some assembly stuff here.

\ Remove the ASSEMBLER and load the EDITOR vocabulary.
PREVIOUS ALSO EDITOR

\ Do some editing here.  If any new words are created,
\ they still go into the ASSEMBLER vocabulary.

\ Go back to just FORTH and put new words there.
PREVIOUS DEFINITIONS</pre>
</div>
</div>
<div class="paragraph">
<p>Tali currently performs the desired "vocabulary" operations by manipulating the
wordlists and search order.  This works correctly for <code>ONLY FORTH</code> (which almost
always appears with those two words used together and in that order),
<code>DEFINITIONS</code>, and <code>PREVIOUS</code>.  The <code>ALSO ASSEMBLER</code> and <code>ALSO EDITOR</code> portions
will not work correctly as Tali does not have a word <code>ASSEMBLER</code> or a word
<code>EDITOR</code>.  If code contains these types of vocabulary words, you will need to
replace them with something like <code>assembler-wordlist &gt;order</code>.  If you are trying
to run older code that needs an editor or assembler, you will likely need to
rewrite that code anyway in order to use Tali&#8217;s editor commands and assembler
syntax.</p>
</div>
<div class="paragraph">
<p>The only words from this list that are recommended for use are <code>ONLY FORTH</code> as a
shortcut for <code>forth-wordlist 1 set-order</code>, <code>DEFINITIONS</code> as a shortcut after
you&#8217;ve just used <code>&gt;order</code> to add a wordlist to the search order and you want to
set the current (compilations) wordlist to be that same wordlist, and finally
<code>PREVIOUS</code>, which removes the first wordlist from the search order.  Take care
with <code>PREVIOUS</code> as it will happily leave you with no wordlists in the search
order if you run it too many times.</p>
</div>
</div>
</div>
</div>
<h1 id="_appendix" class="sect0">Appendix</h1>
<div class="sect1">
<h2 id="_glossary">Glossary</h2>
<div class="sectionbody">
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>!</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n addr&#8201;&#8212;&#8201;) "Store TOS in memory"
<a href="https://forth-standard.org/standard/core/Store" class="bare">https://forth-standard.org/standard/core/Store</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>#</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( ud&#8201;&#8212;&#8201;ud ) "Add character to pictured output string"
<a href="https://forth-standard.org/standard/core/num" class="bare">https://forth-standard.org/standard/core/num</a>
Add one char to the beginning of the pictured output string.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>#&gt;</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( d&#8201;&#8212;&#8201;addr u ) "Finish pictured number conversion"
<a href="https://forth-standard.org/standard/core/num-end" class="bare">https://forth-standard.org/standard/core/num-end</a>
Finish conversion of pictured number string, putting address and
length on the Data Stack.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>#s</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( d&#8201;&#8212;&#8201;addr u ) "Completely convert pictured output"
<a href="https://forth-standard.org/standard/core/numS" class="bare">https://forth-standard.org/standard/core/numS</a>
Completely convert number for pictured numerical output.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>'</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( "name"&#8201;&#8212;&#8201;xt ) "Return a word&#8217;s execution token (xt)"
<a href="https://forth-standard.org/standard/core/Tick" class="bare">https://forth-standard.org/standard/core/Tick</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>(</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Discard input up to close paren ( comment )"
<a href="http://forth-standard.org/standard/core/p" class="bare">http://forth-standard.org/standard/core/p</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>*</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n n&#8201;&#8212;&#8201;n ) "16*16 -&#8594; 16 "
<a href="https://forth-standard.org/standard/core/Times" class="bare">https://forth-standard.org/standard/core/Times</a>
Multiply two signed 16 bit numbers, returning a 16 bit result.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>*/</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n1 n2 n3&#8201;&#8212;&#8201;n4 ) "n1 * n2 / n3 -&#8594;  n"
<a href="https://forth-standard.org/standard/core/TimesDiv" class="bare">https://forth-standard.org/standard/core/TimesDiv</a>
Multiply n1 by n2 and divide by n3, returning the result
without a remainder. This is */MOD without the mod.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>*/mod</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n1 n2 n3&#8201;&#8212;&#8201;n4 n5 ) "n1 * n2 / n3 -&#8594; n-mod n"
<a href="https://forth-standard.org/standard/core/TimesDivMOD" class="bare">https://forth-standard.org/standard/core/TimesDivMOD</a>
Multiply n1 by n2 producing the intermediate double-cell result d.
Divide d by n3 producing the single-cell remainder n4 and the
single-cell quotient n5.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>+</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n n&#8201;&#8212;&#8201;n ) "Add TOS and NOS"
<a href="https://forth-standard.org/standard/core/Plus" class="bare">https://forth-standard.org/standard/core/Plus</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>+!</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n addr&#8201;&#8212;&#8201;) "Add number to value at given address"
<a href="https://forth-standard.org/standard/core/PlusStore" class="bare">https://forth-standard.org/standard/core/PlusStore</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>+loop</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Finish loop construct"
<a href="https://forth-standard.org/standard/core/PlusLOOP" class="bare">https://forth-standard.org/standard/core/PlusLOOP</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>,</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n&#8201;&#8212;&#8201;) "Allot and store one cell in memory"
<a href="https://forth-standard.org/standard/core/Comma" class="bare">https://forth-standard.org/standard/core/Comma</a>
Store TOS at current place in memory.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>-</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n n&#8201;&#8212;&#8201;n ) "Subtract TOS from NOS"
<a href="https://forth-standard.org/standard/core/Minus" class="bare">https://forth-standard.org/standard/core/Minus</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>-leading</code>
</td>
<td class="hdlist2">
<p><em>Tali String</em> ( addr1 u1&#8201;&#8212;&#8201;addr2 u2 ) "Remove leading spaces"
Remove leading whitespace. This is the reverse of -TRAILING</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>-rot</code>
</td>
<td class="hdlist2">
<p><em>Gforth</em> ( a b c&#8201;&#8212;&#8201;c a b ) "Rotate upwards"
<a href="http://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Data-stack.html" class="bare">http://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Data-stack.html</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>-trailing</code>
</td>
<td class="hdlist2">
<p><em>ANS string</em> ( addr u1&#8201;&#8212;&#8201;addr u2 ) "Remove trailing spaces"
<a href="https://forth-standard.org/standard/string/MinusTRAILING" class="bare">https://forth-standard.org/standard/string/MinusTRAILING</a>
Remove trailing spaces</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>.</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( u&#8201;&#8212;&#8201;) "Print TOS"
<a href="https://forth-standard.org/standard/core/d" class="bare">https://forth-standard.org/standard/core/d</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>."</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( "string"&#8201;&#8212;&#8201;) "Print string from compiled word"
<a href="https://forth-standard.org/standard/core/Dotq" class="bare">https://forth-standard.org/standard/core/Dotq</a>
Compile string that is printed during run time. ANS Forth wants
this to be compile-only, even though everybody and their friend
uses it for everything. We follow the book here, and recommend
<code>.(</code> for general printing.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>.(</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Print input up to close paren .( comment )"
<a href="http://forth-standard.org/standard/core/Dotp" class="bare">http://forth-standard.org/standard/core/Dotp</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>.r</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( n u&#8201;&#8212;&#8201;) "Print NOS as unsigned number with TOS with"
<a href="https://forth-standard.org/standard/core/DotR" class="bare">https://forth-standard.org/standard/core/DotR</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>.s</code>
</td>
<td class="hdlist2">
<p><em>ANS tools</em> (&#8201;&#8212;&#8201;) "Print content of Data Stack"
<a href="https://forth-standard.org/standard/tools/DotS" class="bare">https://forth-standard.org/standard/tools/DotS</a>
Print content of Data Stack non-distructively. We follow the format
of Gforth and print the number of elements first in brackets,
followed by the Data Stack content (if any).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>/</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n1 n2&#8201;&#8212;&#8201;n ) "Divide NOS by TOS"
<a href="https://forth-standard.org/standard/core/Div" class="bare">https://forth-standard.org/standard/core/Div</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>/mod</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n1 n2&#8201;&#8212;&#8201;n3 n4 ) "Divide NOS by TOS with a remainder"
<a href="https://forth-standard.org/standard/core/DivMOD" class="bare">https://forth-standard.org/standard/core/DivMOD</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>/string</code>
</td>
<td class="hdlist2">
<p><em>ANS string</em> ( addr u n&#8201;&#8212;&#8201;addr u ) "Shorten string by n"
<a href="https://forth-standard.org/standard/string/DivSTRING" class="bare">https://forth-standard.org/standard/string/DivSTRING</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>0</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;0 ) "Push 0 to Data Stack"
The disassembler assumes that this routine does not use Y. Note
that CASE and FORTH-WORDLIST use the same routine, as the WD for Forth
is 0.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>0&lt;</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n&#8201;&#8212;&#8201;f ) "Return a TRUE flag if TOS negative"
<a href="https://forth-standard.org/standard/core/Zeroless" class="bare">https://forth-standard.org/standard/core/Zeroless</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>0&lt;&gt;</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( m&#8201;&#8212;&#8201;f ) "Return TRUE flag if not zero"
<a href="https://forth-standard.org/standard/core/Zerone" class="bare">https://forth-standard.org/standard/core/Zerone</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>0=</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n&#8201;&#8212;&#8201;f ) "Check if TOS is zero"
<a href="https://forth-standard.org/standard/core/ZeroEqual" class="bare">https://forth-standard.org/standard/core/ZeroEqual</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>0&gt;</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( n&#8201;&#8212;&#8201;f ) "Return a TRUE flag if TOS is positive"
<a href="https://forth-standard.org/standard/core/Zeromore" class="bare">https://forth-standard.org/standard/core/Zeromore</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>1</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;n ) "Push the number 1 to the Data Stack"
This is also the code for EDITOR-WORDLIST</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>1+</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( u&#8201;&#8212;&#8201;u+1 ) "Increase TOS by one"
<a href="https://forth-standard.org/standard/core/OnePlus" class="bare">https://forth-standard.org/standard/core/OnePlus</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>1-</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( u&#8201;&#8212;&#8201;u-1 ) "Decrease TOS by one"
<a href="https://forth-standard.org/standard/core/OneMinus" class="bare">https://forth-standard.org/standard/core/OneMinus</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>2</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;u ) "Push the number 2 to stack"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>2!</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n1 n2 addr&#8201;&#8212;&#8201;) "Store two numbers at given address"
<a href="https://forth-standard.org/standard/core/TwoStore" class="bare">https://forth-standard.org/standard/core/TwoStore</a>
Stores so n2 goes to addr and n1 to the next consecutive cell.
Is equivalent to  <code>SWAP OVER ! CELL+ !</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>2*</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n&#8201;&#8212;&#8201;n ) "Multiply TOS by two"
<a href="https://forth-standard.org/standard/core/TwoTimes" class="bare">https://forth-standard.org/standard/core/TwoTimes</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>2/</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n&#8201;&#8212;&#8201;n ) "Divide TOS by two"
<a href="https://forth-standard.org/standard/core/TwoDiv" class="bare">https://forth-standard.org/standard/core/TwoDiv</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>2&gt;r</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( n1 n2&#8201;&#8212;&#8201;)(R:&#8201;&#8212;&#8201;n1 n2 "Push top two entries to Return Stack"
<a href="https://forth-standard.org/standard/core/TwotoR" class="bare">https://forth-standard.org/standard/core/TwotoR</a>
Push top two entries to Return Stack.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>2@</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( addr&#8201;&#8212;&#8201;n1 n2 ) "Fetch the cell pair n1 n2 stored at addr"
<a href="https://forth-standard.org/standard/core/TwoFetch" class="bare">https://forth-standard.org/standard/core/TwoFetch</a>
Note n2 stored at addr and n1 in the next cell&#8201;&#8212;&#8201;in our case,
the next two bytes. This is equvalent to  <code>DUP CELL+ @ SWAP @</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>2constant</code>
</td>
<td class="hdlist2">
<p><em>ANS double</em> (C: d "name"&#8201;&#8212;&#8201;) (&#8201;&#8212;&#8201;d) "Create a constant for a double word"
<a href="https://forth-standard.org/standard/double/TwoCONSTANT" class="bare">https://forth-standard.org/standard/double/TwoCONSTANT</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>2drop</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n n&#8201;&#8212;&#8201;) "Drop TOS and NOS"
<a href="https://forth-standard.org/standard/core/TwoDROP" class="bare">https://forth-standard.org/standard/core/TwoDROP</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>2dup</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( a b&#8201;&#8212;&#8201;a b a b ) "Duplicate first two stack elements"
<a href="https://forth-standard.org/standard/core/TwoDUP" class="bare">https://forth-standard.org/standard/core/TwoDUP</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>2literal</code>
</td>
<td class="hdlist2">
<p><em>ANS double</em> (C: d&#8201;&#8212;&#8201;) (&#8201;&#8212;&#8201;d) "Compile a literal double word"
<a href="https://forth-standard.org/standard/double/TwoLITERAL" class="bare">https://forth-standard.org/standard/double/TwoLITERAL</a>
Based on the Forth code
: 2LITERAL ( D&#8201;&#8212;&#8201;) SWAP POSTPONE LITERAL POSTPONE LITERAL ; IMMEDIATE</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>2over</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( d1 d2&#8201;&#8212;&#8201;d1 d2 d1 ) "Copy double word NOS to TOS"
<a href="https://forth-standard.org/standard/core/TwoOVER" class="bare">https://forth-standard.org/standard/core/TwoOVER</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>2r&gt;</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> (&#8201;&#8212;&#8201;n1 n2 ) (R: n1 n2&#8201;&#8212;&#8201;) "Pull two cells from Return Stack"
<a href="https://forth-standard.org/standard/core/TwoRfrom" class="bare">https://forth-standard.org/standard/core/TwoRfrom</a>
Pull top two entries from Return Stack.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>2r@</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> (&#8201;&#8212;&#8201;n n ) "Copy top two entries from Return Stack"
<a href="https://forth-standard.org/standard/core/TwoRFetch" class="bare">https://forth-standard.org/standard/core/TwoRFetch</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>2swap</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n1 n2 n3 n4&#8201;&#8212;&#8201;n3 n4 n1 n1 ) "Exchange two double words"
<a href="https://forth-standard.org/standard/core/TwoSWAP" class="bare">https://forth-standard.org/standard/core/TwoSWAP</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>2variable</code>
</td>
<td class="hdlist2">
<p><em>ANS double</em> ( "name"&#8201;&#8212;&#8201;) "Create a variable for a double word"
<a href="https://forth-standard.org/standard/double/TwoVARIABLE" class="bare">https://forth-standard.org/standard/double/TwoVARIABLE</a>
The variable is not initialized to zero.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( "name"&#8201;&#8212;&#8201;) "Start compilation of a new word"
<a href="https://forth-standard.org/standard/core/Colon" class="bare">https://forth-standard.org/standard/core/Colon</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>:NONAME</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Start compilation of a new word""
<a href="https://forth-standard.org/standard/core/ColonNONAME" class="bare">https://forth-standard.org/standard/core/ColonNONAME</a>
Compile a word with no nt.  ";" will put its xt on the stack.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>;</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "End compilation of new word"
<a href="https://forth-standard.org/standard/core/Semi" class="bare">https://forth-standard.org/standard/core/Semi</a>
End the compilation of a new word into the Dictionary.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>&lt;</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n m&#8201;&#8212;&#8201;f ) "Return true if NOS &lt; TOS"
<a href="https://forth-standard.org/standard/core/less" class="bare">https://forth-standard.org/standard/core/less</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>&lt;#</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Start number conversion"
<a href="https://forth-standard.org/standard/core/num-start" class="bare">https://forth-standard.org/standard/core/num-start</a>
Start the process to create pictured numeric output.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>&lt;&gt;</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( n m&#8201;&#8212;&#8201;f ) "Return a true flag if TOS != NOS"
<a href="https://forth-standard.org/standard/core/ne" class="bare">https://forth-standard.org/standard/core/ne</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>=</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n n&#8201;&#8212;&#8201;f ) "See if TOS and NOS are equal"
<a href="https://forth-standard.org/standard/core/Equal" class="bare">https://forth-standard.org/standard/core/Equal</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>&gt;</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n n&#8201;&#8212;&#8201;f ) "See if NOS is greater than TOS"
<a href="https://forth-standard.org/standard/core/more" class="bare">https://forth-standard.org/standard/core/more</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>&gt;body</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( xt&#8201;&#8212;&#8201;addr ) "Return a word&#8217;s Code Field Area (CFA)"
<a href="https://forth-standard.org/standard/core/toBODY" class="bare">https://forth-standard.org/standard/core/toBODY</a>
Given a word&#8217;s execution token (xt), return the address of the
start of that word&#8217;s parameter field (PFA). This is defined as the
address that HERE would return right after CREATE.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>&gt;in</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;addr ) "Return address of the input pointer"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>&gt;number</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( ud addr u&#8201;&#8212;&#8201;ud addr u ) "Convert a number"
<a href="https://forth-standard.org/standard/core/toNUMBER" class="bare">https://forth-standard.org/standard/core/toNUMBER</a>
Convert a string to a double number. Logic here is based on the
routine by Phil Burk of the same name in pForth, see
<a href="https://github.com/philburk/pforth/blob/master/fth/numberio.fth" class="bare">https://github.com/philburk/pforth/blob/master/fth/numberio.fth</a>
for the original Forth code. We arrive here from NUMBER which has
made sure that we don&#8217;t have to deal with a sign and we don&#8217;t have
to deal with a dot as a last character that signalizes double -
this should be a pure number string.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>&gt;order</code>
</td>
<td class="hdlist2">
<p><em>Gforth search</em> ( wid&#8201;&#8212;&#8201;) "Add wordlist at beginning of search order"
<a href="https://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Word-Lists.html" class="bare">https://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Word-Lists.html</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>&gt;r</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n&#8201;&#8212;&#8201;)(R:&#8201;&#8212;&#8201;n) "Push TOS to the Return Stack"
<a href="https://forth-standard.org/standard/core/toR" class="bare">https://forth-standard.org/standard/core/toR</a>
This word is handled differently for native and for
subroutine coding, see <code>COMPILE,</code>. This is a complile-only
word.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>?</code>
</td>
<td class="hdlist2">
<p><em>ANS tools</em> ( addr&#8201;&#8212;&#8201;) "Print content of a variable"
<a href="https://forth-standard.org/standard/tools/q" class="bare">https://forth-standard.org/standard/tools/q</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>?do</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( limit start&#8201;&#8212;&#8201;)(R:&#8201;&#8212;&#8201;limit start) "Conditional loop start"
<a href="https://forth-standard.org/standard/core/qDO" class="bare">https://forth-standard.org/standard/core/qDO</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>?dup</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n&#8201;&#8212;&#8201;0 | n n ) "Duplicate TOS non-zero"
<a href="https://forth-standard.org/standard/core/qDUP" class="bare">https://forth-standard.org/standard/core/qDUP</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>@</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( addr&#8201;&#8212;&#8201;n ) "Push cell content from memory to stack"
<a href="https://forth-standard.org/standard/core/Fetch" class="bare">https://forth-standard.org/standard/core/Fetch</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>[</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Enter interpretation state"
<a href="https://forth-standard.org/standard/core/Bracket" class="bare">https://forth-standard.org/standard/core/Bracket</a>
This is an immediate and compile-only word</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>[']</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Store xt of following word during compilation"
<a href="https://forth-standard.org/standard/core/BracketTick" class="bare">https://forth-standard.org/standard/core/BracketTick</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>[char]</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( "c"&#8201;&#8212;&#8201;) "Compile character"
<a href="https://forth-standard.org/standard/core/BracketCHAR" class="bare">https://forth-standard.org/standard/core/BracketCHAR</a>
Compile the ASCII value of a character as a literal. This is an
immediate, compile-only word.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>\</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> (&#8201;&#8212;&#8201;) "Ignore rest of line"
<a href="https://forth-standard.org/standard/core/bs" class="bare">https://forth-standard.org/standard/core/bs</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>]</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Enter the compile state"
<a href="https://forth-standard.org/standard/right-bracket" class="bare">https://forth-standard.org/standard/right-bracket</a>
This is an immediate word.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>abort</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Reset the Data Stack and restart the CLI"
<a href="https://forth-standard.org/standard/core/ABORT" class="bare">https://forth-standard.org/standard/core/ABORT</a>
Clear Data Stack and continue into QUIT. We can jump here via
subroutine if we want to because we are going to reset the 65c02&#8217;s
stack pointer (the Return Stack) anyway during QUIT. Note we don&#8217;t
actually delete the stuff on the Data Stack.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>abort"</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( "string"&#8201;&#8212;&#8201;) "If flag TOS is true, ABORT with message"
<a href="https://forth-standard.org/standard/core/ABORTq" class="bare">https://forth-standard.org/standard/core/ABORTq</a>
Abort and print a string.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>abs</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n&#8201;&#8212;&#8201;u ) "Return absolute value of a number"
<a href="https://forth-standard.org/standard/core/ABS" class="bare">https://forth-standard.org/standard/core/ABS</a>
Return the absolute value of a number.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>accept</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( addr n&#8201;&#8212;&#8201;n ) "Receive a string of characters from the keyboard"
<a href="https://forth-standard.org/standard/core/ACCEPT" class="bare">https://forth-standard.org/standard/core/ACCEPT</a>
Receive a string of at most n1 characters, placing them at
addr. Return the actual number of characters as n2. Characters
are echoed as they are received. ACCEPT is called by REFILL in
modern Forths.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>action-of</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( "name"&#8201;&#8212;&#8201;xt ) "Get named deferred word&#8217;s xt"
<a href="http://forth-standard.org/standard/core/ACTION-OF" class="bare">http://forth-standard.org/standard/core/ACTION-OF</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>again</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( addr&#8201;&#8212;&#8201;) "Code backwards branch to address left by BEGIN"
<a href="https://forth-standard.org/standard/core/AGAIN" class="bare">https://forth-standard.org/standard/core/AGAIN</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>align</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Make sure CP is aligned on word size"
<a href="https://forth-standard.org/standard/core/ALIGN" class="bare">https://forth-standard.org/standard/core/ALIGN</a>
On a 8-bit machine, this does nothing. ALIGNED uses this
routine as well, and also does nothing</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>aligned</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( addr&#8201;&#8212;&#8201;addr ) "Return the first aligned address"
<a href="https://forth-standard.org/standard/core/ALIGNED" class="bare">https://forth-standard.org/standard/core/ALIGNED</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>allot</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n&#8201;&#8212;&#8201;) "Reserve or release memory"
<a href="https://forth-standard.org/standard/core/ALLOT" class="bare">https://forth-standard.org/standard/core/ALLOT</a>
Reserve a certain number of bytes (not cells) or release them.
If n = 0, do nothing. If n is negative, release n bytes, but only
to the beginning of the Dictionary. If n is positive (the most
common case), reserve n bytes, but not past the end of the
Dictionary. See <a href="http://forth-standard.org/standard/core/ALLOT" class="bare">http://forth-standard.org/standard/core/ALLOT</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>allow-native</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;) "Flag last word to allow native compiling"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>also</code>
</td>
<td class="hdlist2">
<p><em>ANS search ext</em> (&#8201;&#8212;&#8201;) "Make room in the search order for another wordlist"
<a href="http://forth-standard.org/standard/search/ALSO" class="bare">http://forth-standard.org/standard/search/ALSO</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>always-native</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;) "Flag last word as always natively compiled"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>and</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n n&#8201;&#8212;&#8201;n ) "Logically AND TOS and NOS"
<a href="https://forth-standard.org/standard/core/AND" class="bare">https://forth-standard.org/standard/core/AND</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>assembler-wordlist</code>
</td>
<td class="hdlist2">
<p><em>Tali Assembler</em> (&#8201;&#8212;&#8201;u ) "WID for the Assembler wordlist"
 Commonly used like <code>assembler-wordlist &gt;order</code> to add the
assembler words to the search order so they can be used.
See the tutorial on Wordlists and the Search Order for
more information.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>at-xy</code>
</td>
<td class="hdlist2">
<p><em>ANS facility</em> ( n m&#8201;&#8212;&#8201;) "Move cursor to position given"
<a href="https://forth-standard.org/standard/facility/AT-XY" class="bare">https://forth-standard.org/standard/facility/AT-XY</a>
On an ANSI compatible terminal, place cursor at row n colum m.
ANSI code is ESC[&lt;n&gt;;&lt;m&gt;H</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>base</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;addr ) "Push address of radix base to stack"
<a href="https://forth-standard.org/standard/core/BASE" class="bare">https://forth-standard.org/standard/core/BASE</a>
The ANS Forth standard sees the base up to 36, so we can cheat and
ingore the MSB</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>begin</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;addr ) "Mark entry point for loop"
<a href="https://forth-standard.org/standard/core/BEGIN" class="bare">https://forth-standard.org/standard/core/BEGIN</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>bell</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;) "Emit ASCII BELL"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>bl</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;c ) "Push ASCII value of SPACE to stack"
<a href="https://forth-standard.org/standard/core/BL" class="bare">https://forth-standard.org/standard/core/BL</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>blank</code>
</td>
<td class="hdlist2">
<p><em>ANS string</em> ( addr u&#8201;&#8212;&#8201;) "Fill memory region with spaces"
<a href="https://forth-standard.org/standard/string/BLANK" class="bare">https://forth-standard.org/standard/string/BLANK</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>blkbuffer</code>
</td>
<td class="hdlist2">
<p><em>Tali block</em> (&#8201;&#8212;&#8201;addr ) "Push address of block buffer"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>block</code>
</td>
<td class="hdlist2">
<p><em>ANS block</em> ( u&#8201;&#8212;&#8201;a-addr ) "Fetch a block into a buffer"
<a href="https://forth-standard.org/standard/block/BLK" class="bare">https://forth-standard.org/standard/block/BLK</a>
<a href="https://forth-standard.org/standard/block/BLOCK" class="bare">https://forth-standard.org/standard/block/BLOCK</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>block-ramdrive-init</code>
</td>
<td class="hdlist2">
<p><em>Tali block</em> ( u&#8201;&#8212;&#8201;) "Create a ramdrive for blocks"
Create a RAM drive, with the given number of
blocks, in the dictionary along with setting up the block words to
use it.  The read/write routines do not provide bounds checking.
Expected use: <code>4 block-ramdrive-init</code> ( to create blocks 0-3 )</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>block-read</code>
</td>
<td class="hdlist2">
<p><em>Tali block</em> ( addr u&#8201;&#8212;&#8201;) "Read a block from storage (deferred word)"
BLOCK-READ is a vectored word that the user needs to override
with their own version to read a block from storage.
The stack parameters are ( buffer_address block#&#8201;&#8212;&#8201;).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>block-read-vector</code>
</td>
<td class="hdlist2">
<p><em>Tali block</em> (&#8201;&#8212;&#8201;addr ) "Address of the block-read vector"
BLOCK-READ is a vectored word that the user needs to override
with their own version to read a block from storage.
This word gives the address of the vector so it can be replaced.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>block-write</code>
</td>
<td class="hdlist2">
<p><em>Tali block</em> ( addr u&#8201;&#8212;&#8201;) "Write a block to storage (deferred word)"
BLOCK-WRITE is a vectored word that the user needs to override
with their own version to write a block to storage.
The stack parameters are ( buffer_address block#&#8201;&#8212;&#8201;).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>block-write-vector</code>
</td>
<td class="hdlist2">
<p><em>Tali block</em> (&#8201;&#8212;&#8201;addr ) "Address of the block-write vector"
BLOCK-WRITE is a vectored word that the user needs to override
with their own version to write a block to storage.
This word gives the address of the vector so it can be replaced.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>bounds</code>
</td>
<td class="hdlist2">
<p><em>Gforth</em> ( addr u&#8201;&#8212;&#8201;addr+u addr ) "Prepare address for looping"
<a href="http://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Memory-Blocks.html" class="bare">http://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Memory-Blocks.html</a>
Given a string, return the correct Data Stack parameters for
a DO/LOOP loop over its characters. This is realized as
OVER + SWAP in Forth, but we do it a lot faster in assembler</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>buffblocknum</code>
</td>
<td class="hdlist2">
<p><em>Tali block</em> (&#8201;&#8212;&#8201;addr ) "Push address of variable holding block in buffer"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>buffer</code>
</td>
<td class="hdlist2">
<p><em>ANS block</em> ( u&#8201;&#8212;&#8201;a-addr ) "Get a buffer for a block"
<a href="https://forth-standard.org/standard/block/BUFFER" class="bare">https://forth-standard.org/standard/block/BUFFER</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>buffer:</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( u "&lt;name&gt;"&#8201;&#8212;&#8201;;&#8201;&#8212;&#8201;addr ) "Create an uninitialized buffer"
<a href="https://forth-standard.org/standard/core/BUFFERColon" class="bare">https://forth-standard.org/standard/core/BUFFERColon</a>
Create a buffer of size u that puts its address on the stack
when its name is used.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>buffstatus</code>
</td>
<td class="hdlist2">
<p><em>Tali block</em> (&#8201;&#8212;&#8201;addr ) "Push address of variable holding buffer status"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>bye</code>
</td>
<td class="hdlist2">
<p><em>ANS tools ext</em> (&#8201;&#8212;&#8201;) "Break"
<a href="https://forth-standard.org/standard/tools/BYE" class="bare">https://forth-standard.org/standard/tools/BYE</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>c!</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( c addr&#8201;&#8212;&#8201;) "Store character at address given"
<a href="https://forth-standard.org/standard/core/CStore" class="bare">https://forth-standard.org/standard/core/CStore</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>c,</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( c&#8201;&#8212;&#8201;) "Store one byte/char in the Dictionary"
<a href="https://forth-standard.org/standard/core/CComma" class="bare">https://forth-standard.org/standard/core/CComma</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>c@</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( addr&#8201;&#8212;&#8201;c ) "Get a character/byte from given address"
<a href="https://forth-standard.org/standard/core/CFetch" class="bare">https://forth-standard.org/standard/core/CFetch</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>case</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> (C:&#8201;&#8212;&#8201;0) (&#8201;&#8212;&#8201;) "Conditional flow control"
<a href="http://forth-standard.org/standard/core/CASE" class="bare">http://forth-standard.org/standard/core/CASE</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>cell+</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( u&#8201;&#8212;&#8201;u ) "Add cell size in bytes"
<a href="https://forth-standard.org/standard/core/CELLPlus" class="bare">https://forth-standard.org/standard/core/CELLPlus</a>
Add the number of bytes ("address units") that one cell needs.
Since this is an 8 bit machine with 16 bit cells, we add two bytes.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>cells</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( u&#8201;&#8212;&#8201;u ) "Convert cells to size in bytes"
<a href="https://forth-standard.org/standard/core/CELLS" class="bare">https://forth-standard.org/standard/core/CELLS</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>char</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( "c"&#8201;&#8212;&#8201;u ) "Convert character to ASCII value"
<a href="https://forth-standard.org/standard/core/CHAR" class="bare">https://forth-standard.org/standard/core/CHAR</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>char+</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( addr&#8201;&#8212;&#8201;addr+1 ) "Add the size of a character unit to address"
<a href="https://forth-standard.org/standard/core/CHARPlus" class="bare">https://forth-standard.org/standard/core/CHARPlus</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>chars</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n&#8201;&#8212;&#8201;n ) "Number of bytes that n chars need"
<a href="https://forth-standard.org/standard/core/CHARS" class="bare">https://forth-standard.org/standard/core/CHARS</a>
Return how many address units n chars are. Since this is an 8 bit
machine, this does absolutely nothing and is included for
compatibility with other Forth versions</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>cleave</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> ( addr u&#8201;&#8212;&#8201;addr2 u2 addr1 u1 ) "Split off word from string"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>cmove</code>
</td>
<td class="hdlist2">
<p><em>ANS string</em> ( addr1 addr2 u&#8201;&#8212;&#8201;) "Copy bytes going from low to high"
<a href="https://forth-standard.org/standard/string/CMOVE" class="bare">https://forth-standard.org/standard/string/CMOVE</a>
Copy u bytes from addr1 to addr2, going low to high (addr2 is
larger than addr1). Based on code in Leventhal, Lance A.
6502 Assembly Language Routines", p. 201, where it is called
move left".</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>cmove&gt;</code>
</td>
<td class="hdlist2">
<p><em>ANS string</em> ( add1 add2 u&#8201;&#8212;&#8201;) "Copy bytes from high to low"
<a href="https://forth-standard.org/standard/string/CMOVEtop" class="bare">https://forth-standard.org/standard/string/CMOVEtop</a>
Based on code in Leventhal, Lance A. "6502 Assembly Language
Routines", p. 201, where it is called "move right".</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>cold</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;) "Reset the Forth system"
Reset the Forth system. Does not restart the kernel,
use the 65c02 reset for that. Flows into ABORT.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>compare</code>
</td>
<td class="hdlist2">
<p><em>ANS string</em> ( addr1 u1 addr2 u2&#8201;&#8212;&#8201;-1 | 0 | 1) "Compare two strings"
<a href="https://forth-standard.org/standard/string/COMPARE" class="bare">https://forth-standard.org/standard/string/COMPARE</a>
Compare string1 (denoted by addr1 u1) to string2 (denoted by
addr2 u2).  Return -1 if string1 &lt; string2, 0 if string1 = string2
and 1 if string1 &gt; string2 (ASCIIbetical comparison).  A string
that entirely matches the beginning of the other string, but is
shorter, is considered less than the longer string.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>compile,</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( xt&#8201;&#8212;&#8201;) "Compile xt"
<a href="https://forth-standard.org/standard/core/COMPILEComma" class="bare">https://forth-standard.org/standard/core/COMPILEComma</a>
Compile the given xt in the current word definition. It is an
error if we are not in the compile state. Because we are using
subroutine threading, we can&#8217;t use , (COMMA) to compile new words
the traditional way. By default, native compiled is allowed, unless
there is a NN (Never Native) flag associated. If not, we use the
value NC_LIMIT (from definitions.tasm) to decide if the code
is too large to be natively coded: If the size is larger than
NC_LIMIT, we silently use subroutine coding. If the AN (Always
Native) flag is set, the word is always natively compiled.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>compile-only</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;) "Mark most recent word as COMPILE-ONLY"
Set the Compile Only flag (CO) of the most recently defined
word.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>constant</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n "name"&#8201;&#8212;&#8201;) "Define a constant"
<a href="https://forth-standard.org/standard/core/CONSTANT" class="bare">https://forth-standard.org/standard/core/CONSTANT</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>count</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( c-addr&#8201;&#8212;&#8201;addr u ) "Convert character string to normal format"
<a href="https://forth-standard.org/standard/core/COUNT" class="bare">https://forth-standard.org/standard/core/COUNT</a>
Convert old-style character string to address-length pair. Note
that the length of the string c-addr is stored in character length
(8 bit), not cell length (16 bit). This is rarely used these days,
though COUNT can also be used to step through a string character by
character.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>cr</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Print a line feed"
<a href="https://forth-standard.org/standard/core/CR" class="bare">https://forth-standard.org/standard/core/CR</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>create</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( "name"&#8201;&#8212;&#8201;) "Create Dictionary entry for 'name'"
<a href="https://forth-standard.org/standard/core/CREATE" class="bare">https://forth-standard.org/standard/core/CREATE</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>d+</code>
</td>
<td class="hdlist2">
<p><em>ANS double</em> ( d d&#8201;&#8212;&#8201;d ) "Add two double-celled numbers"
<a href="https://forth-standard.org/standard/double/DPlus" class="bare">https://forth-standard.org/standard/double/DPlus</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>d-</code>
</td>
<td class="hdlist2">
<p><em>ANS double</em> ( d d&#8201;&#8212;&#8201;d ) "Subtract two double-celled numbers"
<a href="https://forth-standard.org/standard/double/DMinus" class="bare">https://forth-standard.org/standard/double/DMinus</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>d.</code>
</td>
<td class="hdlist2">
<p><em>ANS double</em> ( d&#8201;&#8212;&#8201;) "Print double"
<a href="http://forth-standard.org/standard/double/Dd" class="bare">http://forth-standard.org/standard/double/Dd</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>d.r</code>
</td>
<td class="hdlist2">
<p><em>ANS double</em> ( d u&#8201;&#8212;&#8201;) "Print double right-justified u wide"
<a href="http://forth-standard.org/standard/double/DDotR" class="bare">http://forth-standard.org/standard/double/DDotR</a>
Based on the Forth code
: D.R &gt;R TUCK DABS &lt;# #S ROT SIGN #&gt; R&gt; OVER - SPACES TYPE</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>d&gt;s</code>
</td>
<td class="hdlist2">
<p><em>ANS double</em> ( d&#8201;&#8212;&#8201;n ) "Convert a double number to single"
<a href="https://forth-standard.org/standard/double/DtoS" class="bare">https://forth-standard.org/standard/double/DtoS</a>
Though this is basically just DROP, we keep it
separate so we can test for underflow</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>dabs</code>
</td>
<td class="hdlist2">
<p><em>ANS double</em> ( d&#8201;&#8212;&#8201;d ) "Return the absolute value of a double"
<a href="https://forth-standard.org/standard/double/DABS" class="bare">https://forth-standard.org/standard/double/DABS</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>decimal</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Change radix base to decimal"
<a href="https://forth-standard.org/standard/core/DECIMAL" class="bare">https://forth-standard.org/standard/core/DECIMAL</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>defer</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( "name"&#8201;&#8212;&#8201;) "Create a placeholder for words by name"
<a href="https://forth-standard.org/standard/core/DEFER" class="bare">https://forth-standard.org/standard/core/DEFER</a>
Reserve an name that can be linked to various xt by IS.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>defer!</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( xt2 x1&#8201;&#8212;&#8201;) "Set xt1 to execute xt2"
<a href="http://forth-standard.org/standard/core/DEFERStore" class="bare">http://forth-standard.org/standard/core/DEFERStore</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>defer@</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( xt1&#8201;&#8212;&#8201;xt2 ) "Get the current XT for a deferred word"
<a href="http://forth-standard.org/standard/core/DEFERFetch" class="bare">http://forth-standard.org/standard/core/DEFERFetch</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>definitions</code>
</td>
<td class="hdlist2">
<p><em>ANS search</em> (&#8201;&#8212;&#8201;) "Make first wordlist in search order the current wordlist"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>depth</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;u ) "Get number of cells (not bytes) used by stack"
<a href="https://forth-standard.org/standard/core/DEPTH" class="bare">https://forth-standard.org/standard/core/DEPTH</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>digit?</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> ( char&#8201;&#8212;&#8201;u f | char f ) "Convert ASCII char to number"
Inspired by the pForth instruction DIGIT, see
<a href="https://github.com/philburk/pforth/blob/master/fth/numberio.fth" class="bare">https://github.com/philburk/pforth/blob/master/fth/numberio.fth</a>
Rewritten from DIGIT&gt;NUMBER in Tali Forth. Note in contrast to
pForth, we get the base (radix) ourselves instead of having the
user provide it. There is no standard name for this routine, which
itself is not ANS; we use DIGIT? following pForth and Gforth.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>disasm</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> ( addr u&#8201;&#8212;&#8201;) "Disassemble a block of memory"
Convert a segment of memory to assembler output. This
word is vectored so people can add their own disassembler.
Natively, this produces Simpler Assembly Notation (SAN)
code, see the section on The Disassembler in the manual and
the file disassembler.asm for more details.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>dnegate</code>
</td>
<td class="hdlist2">
<p><em>ANS double</em> ( d&#8201;&#8212;&#8201;d ) "Negate double cell number"
<a href="https://forth-standard.org/standard/double/DNEGATE" class="bare">https://forth-standard.org/standard/double/DNEGATE</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>do</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( limit start&#8201;&#8212;&#8201;)(R:&#8201;&#8212;&#8201;limit start)  "Start a loop"
<a href="https://forth-standard.org/standard/core/DO" class="bare">https://forth-standard.org/standard/core/DO</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>does&gt;</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Add payload when defining new words"
<a href="https://forth-standard.org/standard/core/DOES" class="bare">https://forth-standard.org/standard/core/DOES</a>
Create the payload for defining new defining words. See
<a href="http://www.bradrodriguez.com/papers/moving3.htm" class="bare">http://www.bradrodriguez.com/papers/moving3.htm</a> and
the Developer Guide in the manual for a discussion of
DOES&gt;'s internal workings. This uses tmp1 and tmp2.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>drop</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( u&#8201;&#8212;&#8201;) "Pop top entry on Data Stack"
<a href="https://forth-standard.org/standard/core/DROP" class="bare">https://forth-standard.org/standard/core/DROP</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>dump</code>
</td>
<td class="hdlist2">
<p><em>ANS tools</em> ( addr u&#8201;&#8212;&#8201;) "Display a memory region"
<a href="https://forth-standard.org/standard/tools/DUMP" class="bare">https://forth-standard.org/standard/tools/DUMP</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>dup</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( u&#8201;&#8212;&#8201;u u ) "Duplicate TOS"
<a href="https://forth-standard.org/standard/core/DUP" class="bare">https://forth-standard.org/standard/core/DUP</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ed</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;u ) "Line-based editor"
Start the line-based editor ed6502. See separate file
ed.asm or the manual for details.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>editor-wordlist</code>
</td>
<td class="hdlist2">
<p><em>Tali Editor</em> (&#8201;&#8212;&#8201;u ) "WID for the Editor wordlist"
 Commonly used like <code>editor-wordlist &gt;order</code> to add the editor
words to the search order so they can be used.  This will need
to be done before any of the words marked "Tali Editor" can be
used.  See the tutorial on Wordlists and the Search Order for
more information.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>el</code>
</td>
<td class="hdlist2">
<p><em>Tali Editor</em> ( line#&#8201;&#8212;&#8201;) "Erase the given line number"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>else</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (C: orig&#8201;&#8212;&#8201;orig) (&#8201;&#8212;&#8201;) "Conditional flow control"
<a href="http://forth-standard.org/standard/core/ELSE" class="bare">http://forth-standard.org/standard/core/ELSE</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>emit</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( char&#8201;&#8212;&#8201;) "Print character to current output"
<a href="https://forth-standard.org/standard/core/EMIT" class="bare">https://forth-standard.org/standard/core/EMIT</a>
Run-time default for EMIT. The user can revector this by changing
the value of the OUTPUT variable. We ignore the MSB completely, and
do not check to see if we have been given a valid ASCII character.
Don&#8217;t make this native compile.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>empty-buffers</code>
</td>
<td class="hdlist2">
<p><em>ANS block ext</em> (&#8201;&#8212;&#8201;) "Empty all buffers without saving"
<a href="https://forth-standard.org/standard/block/EMPTY-BUFFERS" class="bare">https://forth-standard.org/standard/block/EMPTY-BUFFERS</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>endcase</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> (C: case-sys&#8201;&#8212;&#8201;) ( x&#8201;&#8212;&#8201;) "Conditional flow control"
<a href="http://forth-standard.org/standard/core/ENDCASE" class="bare">http://forth-standard.org/standard/core/ENDCASE</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>endof</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> (C: case-sys1 of-sys1-- case-sys2) (&#8201;&#8212;&#8201;) "Conditional flow control"
<a href="http://forth-standard.org/standard/core/ENDOF" class="bare">http://forth-standard.org/standard/core/ENDOF</a>
This is a dummy entry, the code is shared with ELSE</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>enter-screen</code>
</td>
<td class="hdlist2">
<p><em>Tali Editor</em> ( scr#&#8201;&#8212;&#8201;) "Enter all lines for given screen"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>environment?</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( addr u&#8201;&#8212;&#8201;0 | i*x true )  "Return system information"
<a href="https://forth-standard.org/standard/core/ENVIRONMENTq" class="bare">https://forth-standard.org/standard/core/ENVIRONMENTq</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>erase</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( addr u&#8201;&#8212;&#8201;) "Fill memory region with zeros"
<a href="https://forth-standard.org/standard/core/ERASE" class="bare">https://forth-standard.org/standard/core/ERASE</a>
Note that ERASE works with "address" units
(bytes), not cells.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>erase-screen</code>
</td>
<td class="hdlist2">
<p><em>Tali Editor</em> ( scr#&#8201;&#8212;&#8201;) "Erase all lines for given screen"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>evaluate</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( addr u&#8201;&#8212;&#8201;) "Execute a string"
<a href="https://forth-standard.org/standard/core/EVALUATE" class="bare">https://forth-standard.org/standard/core/EVALUATE</a>
Set SOURCE-ID to -1, make addr u the input source, set &gt;IN to zero.
After processing the line, revert to old input source. We use this
to compile high-level Forth words and user-defined words during
start up and cold boot. In contrast to ACCEPT, we need to, uh,
accept more than 255 characters here, even though it&#8217;s a pain in
the 8-bit.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>execute</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( xt&#8201;&#8212;&#8201;) "Jump to word based on execution token"
<a href="https://forth-standard.org/standard/core/EXECUTE" class="bare">https://forth-standard.org/standard/core/EXECUTE</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>execute-parsing</code>
</td>
<td class="hdlist2">
<p><em>Gforth</em> ( addr u xt&#8201;&#8212;&#8201;) "Pass a string to a parsing word"
<a href="https://www.complang.tuwien.ac.at/forth/gforth/Docs-html/The-Input-Stream.html" class="bare">https://www.complang.tuwien.ac.at/forth/gforth/Docs-html/The-Input-Stream.html</a>
Execute the parsing word defined by the execution token (xt) on the
string as if it were passed on the command line. See the file
tests/tali.fs for examples.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>exit</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Return control to the calling word immediately"
<a href="https://forth-standard.org/standard/core/EXIT" class="bare">https://forth-standard.org/standard/core/EXIT</a>
If we&#8217;re in a loop, we need to UNLOOP first and get everything
we we might have put on the Return Stack off as well. This should
be natively compiled.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>false</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> (&#8201;&#8212;&#8201;f ) "Push flag FALSE to Data Stack"
<a href="https://forth-standard.org/standard/core/FALSE" class="bare">https://forth-standard.org/standard/core/FALSE</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>fill</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( addr u char&#8201;&#8212;&#8201;) "Fill a memory region with a character"
<a href="https://forth-standard.org/standard/core/FILL" class="bare">https://forth-standard.org/standard/core/FILL</a>
Fill u bytes of memory with char starting at addr. Note that
this works on bytes, not on cells. On an 8-bit machine such as the
65c02, this is a serious pain in the rear. It is not defined what
happens when we reach the end of the address space</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>find</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( caddr&#8201;&#8212;&#8201;addr 0 | xt 1 | xt -1 ) "Find word in Dictionary"
<a href="https://forth-standard.org/standard/core/FIND" class="bare">https://forth-standard.org/standard/core/FIND</a>
Included for backwards compatibility only, because it still
can be found in so may examples. It should, however, be replaced
by FIND-NAME. Counted string either returns address with a FALSE
flag if not found in the Dictionary, or the xt with a flag to
indicate if this is immediate or not. FIND is a wrapper around
FIND-NAME, we get this all over with as quickly as possible. See
<a href="https://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Word-Lists.html" class="bare">https://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Word-Lists.html</a>
<a href="https://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Name-token.html" class="bare">https://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Name-token.html</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>find-name</code>
</td>
<td class="hdlist2">
<p><em>Gforth</em> ( addr u&#8201;&#8212;&#8201;nt|0 ) "Get the name token of input word"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>flush</code>
</td>
<td class="hdlist2">
<p><em>ANS block</em> (&#8201;&#8212;&#8201;) "Save dirty buffers and empty buffers"
<a href="https://forth-standard.org/standard/block/FLUSH" class="bare">https://forth-standard.org/standard/block/FLUSH</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>fm/mod</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( d n1 &#8201;&#8212;&#8201;rem n2 ) "Floored signed division"
<a href="https://forth-standard.org/standard/core/FMDivMOD" class="bare">https://forth-standard.org/standard/core/FMDivMOD</a>
Note that by default, Tali Forth uses SM/REM for most things.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>forth</code>
</td>
<td class="hdlist2">
<p><em>ANS search ext</em> (&#8201;&#8212;&#8201;) "Replace first WID in search order with Forth-Wordlist"
<a href="https://forth-standard.org/standard/search/FORTH" class="bare">https://forth-standard.org/standard/search/FORTH</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>forth-wordlist</code>
</td>
<td class="hdlist2">
<p><em>ANS search</em> (&#8201;&#8212;&#8201;u ) "WID for the Forth Wordlist"
<a href="https://forth-standard.org/standard/search/FORTH-WORDLIST" class="bare">https://forth-standard.org/standard/search/FORTH-WORDLIST</a>
This is a dummy entry, the actual code is shared with ZERO.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>get-current</code>
</td>
<td class="hdlist2">
<p><em>ANS search</em> (&#8201;&#8212;&#8201;wid ) "Get the id of the compilation wordlist"
<a href="https://forth-standard.org/standard/search/GET-CURRENT" class="bare">https://forth-standard.org/standard/search/GET-CURRENT</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>get-order</code>
</td>
<td class="hdlist2">
<p><em>ANS search</em> (&#8201;&#8212;&#8201;wid_n .. wid_1 n) "Get the current search order"
<a href="https://forth-standard.org/standard/search/GET-ORDER" class="bare">https://forth-standard.org/standard/search/GET-ORDER</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>here</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;addr ) "Put Compiler Pointer on Data Stack"
<a href="https://forth-standard.org/standard/core/HERE" class="bare">https://forth-standard.org/standard/core/HERE</a>
This code is also used by the assembler directive ARROW
("&#8594;") though as immediate</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>hex</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> (&#8201;&#8212;&#8201;) "Change base radix to hexadecimal"
<a href="https://forth-standard.org/standard/core/HEX" class="bare">https://forth-standard.org/standard/core/HEX</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>hexstore</code>
</td>
<td class="hdlist2">
<p><em>Tali</em> ( addr1 u1 addr2&#8201;&#8212;&#8201;u2 ) "Store a list of numbers"
Given a string addr1 u1 with numbers in the current base seperated
by spaces, store the numbers at the address addr2, returning the
number of elements. Non-number elements are skipped, an zero-length
string produces a zero output.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>hold</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( char&#8201;&#8212;&#8201;) "Insert character at current output"
<a href="https://forth-standard.org/standard/core/HOLD" class="bare">https://forth-standard.org/standard/core/HOLD</a>
Insert a character at the current position of a pictured numeric
output string on
<a href="https://github.com/philburk/pforth/blob/master/fth/numberio.fth" class="bare">https://github.com/philburk/pforth/blob/master/fth/numberio.fth</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>i</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;n )(R: n&#8201;&#8212;&#8201;n)  "Copy loop counter to stack"
<a href="https://forth-standard.org/standard/core/I" class="bare">https://forth-standard.org/standard/core/I</a>
Note that this is not the same as R@ because we use a fudge
factor for loop control; see the Control Flow section of the
manual for details.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>if</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (C:&#8201;&#8212;&#8201;orig) (flag&#8201;&#8212;&#8201;) "Conditional flow control"
<a href="http://forth-standard.org/standard/core/IF" class="bare">http://forth-standard.org/standard/core/IF</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>immediate</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Mark most recent word as IMMEDIATE"
<a href="https://forth-standard.org/standard/core/IMMEDIATE" class="bare">https://forth-standard.org/standard/core/IMMEDIATE</a>
Make sure the most recently defined word is immediate. Will only
affect the last word in the dictionary. Note that if the word is
defined in ROM, this will have no affect, but will not produce an
error message.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>input</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;addr ) "Return address of input vector"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>input&gt;r</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;) ( R:&#8201;&#8212;&#8201;n n n n ) "Save input state to the Return Stack"
Save the current input state as defined by insrc, cib, ciblen, and
toin to the Return Stack. Used by EVALUTE.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>int&gt;name</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> ( xt&#8201;&#8212;&#8201;nt ) "Get name token from execution token"
www.complang.tuwien.ac.at/forth/gforth/Docs-html/Name-token.html
This is called &gt;NAME in Gforth, but we change it to
INT&gt;NAME to match NAME&gt;INT</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>invert</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n&#8201;&#8212;&#8201;n ) "Complement of TOS"
<a href="https://forth-standard.org/standard/core/INVERT" class="bare">https://forth-standard.org/standard/core/INVERT</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>is</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( xt "name"&#8201;&#8212;&#8201;) "Set named word to execute xt"
<a href="http://forth-standard.org/standard/core/IS" class="bare">http://forth-standard.org/standard/core/IS</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>j</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;n ) (R: n&#8201;&#8212;&#8201;n ) "Copy second loop counter to stack"
<a href="https://forth-standard.org/standard/core/J" class="bare">https://forth-standard.org/standard/core/J</a>
Copy second loop counter from Return Stack to stack. Note we use
a fudge factor for loop control; see the Control Flow section of
the manual for more details.
At this point, we have the "I" counter/limit and the LEAVE address
on the stack above this (three entries), whereas the ideal Forth
implementation would just have two.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>key</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;char ) "Get one character from the input"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>l</code>
</td>
<td class="hdlist2">
<p><em>Tali Editor</em> (&#8201;&#8212;&#8201;) "List the current screen"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>latestnt</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;nt ) "Push most recent nt to the stack"
www.complang.tuwien.ac.at/forth/gforth/Docs-html/Name-token.html
The Gforth version of this word is called LATEST</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>latestxt</code>
</td>
<td class="hdlist2">
<p><em>Gforth</em> (&#8201;&#8212;&#8201;xt ) "Push most recent xt to the stack"
<a href="http://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Anonymous-Definitions.html" class="bare">http://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Anonymous-Definitions.html</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>leave</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Leave DO/LOOP construct"
<a href="https://forth-standard.org/standard/core/LEAVE" class="bare">https://forth-standard.org/standard/core/LEAVE</a>
Note that this does not work with anything but a DO/LOOP in
contrast to other versions such as discussed at
<a href="http://blogs.msdn.com/b/ashleyf/archive/2011/02/06/loopty-do-i-loop.aspx" class="bare">http://blogs.msdn.com/b/ashleyf/archive/2011/02/06/loopty-do-i-loop.aspx</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>line</code>
</td>
<td class="hdlist2">
<p><em>Tali Editor</em> ( line#&#8201;&#8212;&#8201;c-addr ) "Turn a line number into address in current screen"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>list</code>
</td>
<td class="hdlist2">
<p><em>ANS block ext</em> ( scr#&#8201;&#8212;&#8201;) "List the given screen"
<a href="https://forth-standard.org/standard/block/LIST" class="bare">https://forth-standard.org/standard/block/LIST</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>literal</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n&#8201;&#8212;&#8201;) "Store TOS to be push on stack during runtime"
<a href="https://forth-standard.org/standard/core/LITERAL" class="bare">https://forth-standard.org/standard/core/LITERAL</a>
Compile-only word to store TOS so that it is pushed on stack
during runtime. This is a immediate, compile-only word. At runtime,
it works by calling literal_runtime by compling JSR LITERAL_RT.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>load</code>
</td>
<td class="hdlist2">
<p><em>ANS block</em> ( scr#&#8201;&#8212;&#8201;) "Load the Forth code in a screen/block"
<a href="https://forth-standard.org/standard/block/LOAD" class="bare">https://forth-standard.org/standard/block/LOAD</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>loop</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Finish loop construct"
<a href="https://forth-standard.org/standard/core/LOOP" class="bare">https://forth-standard.org/standard/core/LOOP</a>
Compile-time part of LOOP. This does nothing more but push 1 on
the stack and then call +LOOP.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>lshift</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( x u&#8201;&#8212;&#8201;u ) "Shift TOS left"
<a href="https://forth-standard.org/standard/core/LSHIFT" class="bare">https://forth-standard.org/standard/core/LSHIFT</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>m*</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n n&#8201;&#8212;&#8201;d ) "16 * 16 -&#8594; 32"
<a href="https://forth-standard.org/standard/core/MTimes" class="bare">https://forth-standard.org/standard/core/MTimes</a>
Multiply two 16 bit numbers, producing a 32 bit result. All
values are signed. Adapted from FIG Forth for Tali Forth.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>marker</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( "name"&#8201;&#8212;&#8201;) "Create a deletion boundry"
<a href="https://forth-standard.org/standard/core/MARKER" class="bare">https://forth-standard.org/standard/core/MARKER</a>
This word replaces FORGET in earlier Forths. Old entries are not
actually deleted, but merely overwritten by restoring CP and DP.
Run the named word at a later time to restore all of the wordlists
to their state when the word was created with marker.  Any words
created after the marker (including the marker) will be forgotten.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>max</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n n&#8201;&#8212;&#8201;n ) "Keep larger of two numbers"
<a href="https://forth-standard.org/standard/core/MAX" class="bare">https://forth-standard.org/standard/core/MAX</a>
Compare TOS and NOS and keep which one is larger. Adapted from
Lance A. Leventhal "6502 Assembly Language Subroutines". Negative
Flag indicates which number is larger. See also
<a href="http://6502.org/tutorials/compare_instructions.html" class="bare">http://6502.org/tutorials/compare_instructions.html</a> and
<a href="http://www.righto.com/2012/12/the-6502-overflow-flag-explained.html" class="bare">http://www.righto.com/2012/12/the-6502-overflow-flag-explained.html</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>min</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n n&#8201;&#8212;&#8201;n ) "Keep smaller of two numbers"
<a href="https://forth-standard.org/standard/core/MIN" class="bare">https://forth-standard.org/standard/core/MIN</a>
Adapted from Lance A. Leventhal "6502 Assembly Language
Subroutines." Negative Flag indicateds which number is larger. See
<a href="http://www.righto.com/2012/12/the-6502-overflow-flag-explained.html" class="bare">http://www.righto.com/2012/12/the-6502-overflow-flag-explained.html</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>mod</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n1 n2&#8201;&#8212;&#8201;n ) "Divide NOS by TOS and return the remainder"
<a href="https://forth-standard.org/standard/core/MOD" class="bare">https://forth-standard.org/standard/core/MOD</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>move</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( addr1 addr2 u&#8201;&#8212;&#8201;) "Copy bytes"
<a href="https://forth-standard.org/standard/core/MOVE" class="bare">https://forth-standard.org/standard/core/MOVE</a>
Copy u "address units" from addr1 to addr2. Since our address
units are bytes, this is just a front-end for CMOVE and CMOVE&gt;. This
is actually the only one of these three words that is in the CORE
set.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>name&gt;int</code>
</td>
<td class="hdlist2">
<p><em>Gforth</em> ( nt&#8201;&#8212;&#8201;xt ) "Convert Name Token to Execute Token"
See
<a href="https://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Name-token.html" class="bare">https://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Name-token.html</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>name&gt;string</code>
</td>
<td class="hdlist2">
<p><em>Gforth</em> ( nt&#8201;&#8212;&#8201;addr u ) "Given a name token, return string of word"
<a href="http://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Name-token.html" class="bare">http://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Name-token.html</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>nc-limit</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;addr ) "Return address where NC-LIMIT value is kept"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>negate</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n&#8201;&#8212;&#8201;n ) "Two&#8217;s complement"
<a href="https://forth-standard.org/standard/core/NEGATE" class="bare">https://forth-standard.org/standard/core/NEGATE</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>never-native</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;) "Flag last word as never natively compiled"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>nip</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( b a&#8201;&#8212;&#8201;a ) "Delete NOS"
<a href="https://forth-standard.org/standard/core/NIP" class="bare">https://forth-standard.org/standard/core/NIP</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>number</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> ( addr u&#8201;&#8212;&#8201;u | d ) "Convert a number string"
Convert a number string to a double or single cell number. This
is a wrapper for &gt;NUMBER and follows the convention set out in the
Forth Programmer&#8217;s Handbook" (Conklin &amp; Rather) 3rd edition p. 87.
Based in part on the "Starting Forth" code
<a href="https://www.forth.com/starting-forth/10-input-output-operators/" class="bare">https://www.forth.com/starting-forth/10-input-output-operators/</a>
Gforth uses S&gt;NUMBER? and S&gt;UNUMBER? which return numbers and a flag
<a href="https://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Number-Conversion.html" class="bare">https://www.complang.tuwien.ac.at/forth/gforth/Docs-html/Number-Conversion.html</a>
Another difference to Gforth is that we follow ANS Forth that the
dot to signal a double cell number is required to be the last
character of the string.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>o</code>
</td>
<td class="hdlist2">
<p><em>Tali Editor</em> ( line#&#8201;&#8212;&#8201;) "Overwrite the given line"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>of</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> (C:&#8201;&#8212;&#8201;of-sys) (x1 x2&#8201;&#8212;&#8201;|x1) "Conditional flow control"
<a href="http://forth-standard.org/standard/core/OF" class="bare">http://forth-standard.org/standard/core/OF</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>only</code>
</td>
<td class="hdlist2">
<p><em>ANS search ext</em> (&#8201;&#8212;&#8201;) "Set earch order to minimum wordlist"
<a href="https://forth-standard.org/standard/search/ONLY" class="bare">https://forth-standard.org/standard/search/ONLY</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>or</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( m n&#8201;&#8212;&#8201;n ) "Logically OR TOS and NOS"
<a href="https://forth-standard.org/standard/core/OR" class="bare">https://forth-standard.org/standard/core/OR</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>order</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Print current word order list and current WID"
<a href="https://forth-standard.org/standard/search/ORDER" class="bare">https://forth-standard.org/standard/search/ORDER</a>
Note the search order is displayed from first search to last
searched and is therefore exactly the reverse of the order in which
Forth stacks are displayed.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>output</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;addr ) "Return the address of the EMIT vector address"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>over</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( b a&#8201;&#8212;&#8201;b a b ) "Copy NOS to TOS"
<a href="https://forth-standard.org/standard/core/OVER" class="bare">https://forth-standard.org/standard/core/OVER</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>pad</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> (&#8201;&#8212;&#8201;addr ) "Return address of user scratchpad"
<a href="https://forth-standard.org/standard/core/PAD" class="bare">https://forth-standard.org/standard/core/PAD</a>
Return address to a temporary area in free memory for user. Must
be at least 84 bytes in size (says ANS). It is located relative to
the compile area pointer (CP) and therefore varies in position.
This area is reserved for the user and not used by the system</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>page</code>
</td>
<td class="hdlist2">
<p><em>ANS facility</em> (&#8201;&#8212;&#8201;) "Clear the screen"
<a href="https://forth-standard.org/standard/facility/PAGE" class="bare">https://forth-standard.org/standard/facility/PAGE</a>
Clears a page if supported by ANS terminal codes. This is
Clear Screen ("ESC[2J") plus moving the cursor to the top
left of the screen</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>parse</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( "name" c&#8201;&#8212;&#8201;addr u ) "Parse input with delimiter character"
<a href="https://forth-standard.org/standard/core/PARSE" class="bare">https://forth-standard.org/standard/core/PARSE</a>
Find word in input string delimited by character given. Do not
skip leading delimiters&#8201;&#8212;&#8201;this is the main difference to PARSE-NAME.
PARSE and PARSE-NAME replace WORD in modern systems. ANS discussion
<a href="http://www.forth200x.org/documents/html3/rationale.html#rat:core:PARSE" class="bare">http://www.forth200x.org/documents/html3/rationale.html#rat:core:PARSE</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>parse-name</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( "name"&#8201;&#8212;&#8201;addr u ) "Parse the input"
<a href="https://forth-standard.org/standard/core/PARSE-NAME" class="bare">https://forth-standard.org/standard/core/PARSE-NAME</a>
Find next word in input string, skipping leading whitespace. This is
a special form of PARSE and drops through to that word. See PARSE
for more detail. We use this word internally for the interpreter
because it is a lot easier to use. Reference implementations at
<a href="http://forth-standard.org/standard/core/PARSE-NAME" class="bare">http://forth-standard.org/standard/core/PARSE-NAME</a> and
<a href="http://www.forth200x.org/reference-implementations/parse-name.fs" class="bare">http://www.forth200x.org/reference-implementations/parse-name.fs</a>
Roughly, the word is comparable to BL WORD COUNT.&#8201;&#8212;&#8201;Note that
though the ANS standard talks about skipping "spaces", whitespace
is actually perfectly legal (see for example
<a href="http://forth-standard.org/standard/usage#subsubsection.3.4.1.1" class="bare">http://forth-standard.org/standard/usage#subsubsection.3.4.1.1</a>).
Otherwise, PARSE-NAME chokes on tabs.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>pick</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( n n u&#8201;&#8212;&#8201;n n n ) "Move element u of the stack to TOS"
<a href="https://forth-standard.org/standard/core/PICK" class="bare">https://forth-standard.org/standard/core/PICK</a>
Take the u-th element out of the stack and put it on TOS,
overwriting the original TOS. 0 PICK is equivalent to DUP, 1 PICK to
OVER. Note that using PICK is considered poor coding form. Also note
that FIG Forth has a different behavior for PICK than ANS Forth.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>postpone</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Change IMMEDIATE status (it&#8217;s complicated)"
<a href="https://forth-standard.org/standard/core/POSTPONE" class="bare">https://forth-standard.org/standard/core/POSTPONE</a>
Add the compilation behavior of a word to a new word at
compile time. If the word that follows it is immediate, include
it so that it will be compiled when the word being defined is
itself used for a new word. Tricky, but very useful.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>previous</code>
</td>
<td class="hdlist2">
<p><em>ANS search ext</em> (&#8201;&#8212;&#8201;) "Remove the first wordlist in the search order"
<a href="http://forth-standard.org/standard/search/PREVIOUS" class="bare">http://forth-standard.org/standard/search/PREVIOUS</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>quit</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Reset the input and get new input"
<a href="https://forth-standard.org/standard/core/QUIT" class="bare">https://forth-standard.org/standard/core/QUIT</a>
Rest the input and start command loop</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>r&gt;</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;n )(R: n --) "Move top of Return Stack to TOS"
<a href="https://forth-standard.org/standard/core/Rfrom" class="bare">https://forth-standard.org/standard/core/Rfrom</a>
Move Top of Return Stack to Top of Data Stack.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>r&gt;input</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;) ( R: n n n n&#8201;&#8212;&#8201;) "Restore input state from Return Stack"
Restore the current input state as defined by insrc, cib, ciblen,
and toin from the Return Stack.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>r@</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;n ) "Get copy of top of Return Stack"
<a href="https://forth-standard.org/standard/core/RFetch" class="bare">https://forth-standard.org/standard/core/RFetch</a>
This word is Compile Only in Tali Forth, though Gforth has it
work normally as well</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>recurse</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Copy recursive call to word being defined"
<a href="https://forth-standard.org/standard/core/RECURSE" class="bare">https://forth-standard.org/standard/core/RECURSE</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>refill</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> (&#8201;&#8212;&#8201;f ) "Refill the input buffer"
<a href="https://forth-standard.org/standard/core/REFILL" class="bare">https://forth-standard.org/standard/core/REFILL</a>
Attempt to fill the input buffer from the input source, returning
a true flag if successful. When the input source is the user input
device, attempt to receive input into the terminal input buffer. If
successful, make the result the input buffer, set &gt;IN to zero, and
return true. Receipt of a line containing no characters is considered
successful. If there is no input available from the current input
source, return false. When the input source is a string from EVALUATE,
return false and perform no other action." See
<a href="https://www.complang.tuwien.ac.at/forth/gforth/Docs-html/The-Input-Stream.html" class="bare">https://www.complang.tuwien.ac.at/forth/gforth/Docs-html/The-Input-Stream.html</a>
and Conklin &amp; Rather p. 156. Note we don&#8217;t have to care about blocks
because REFILL is never used on blocks - Tali is able to evaluate the
entire block as a 1024 byte string.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>repeat</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (C: orig dest&#8201;&#8212;&#8201;) (&#8201;&#8212;&#8201;) "Loop flow control"
<a href="http://forth-standard.org/standard/core/REPEAT" class="bare">http://forth-standard.org/standard/core/REPEAT</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>root-wordlist</code>
</td>
<td class="hdlist2">
<p><em>Tali Editor</em> (&#8201;&#8212;&#8201;u ) "WID for the Root (minimal) wordlist"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>rot</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( a b c&#8201;&#8212;&#8201;b c a ) "Rotate first three stack entries downwards"
<a href="https://forth-standard.org/standard/core/ROT" class="bare">https://forth-standard.org/standard/core/ROT</a>
Remember "R for 'Revolution'" - the bottom entry comes out
on top!</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>rshift</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( x u&#8201;&#8212;&#8201;x ) "Shift TOS to the right"
<a href="https://forth-standard.org/standard/core/RSHIFT" class="bare">https://forth-standard.org/standard/core/RSHIFT</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>s"</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( "string"&#8201;&#8212;&#8201;)(&#8201;&#8212;&#8201;addr u ) "Store string in memory"
<a href="https://forth-standard.org/standard/core/Sq" class="bare">https://forth-standard.org/standard/core/Sq</a>
Store address and length of string given, returning ( addr u ).
ANS core claims this is compile-only, but the file set expands it
to be interpreted, so it is a state-sensitive word, which in theory
are evil. We follow general usage.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>s&gt;d</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( u&#8201;&#8212;&#8201;d ) "Convert single cell number to double cell"
<a href="https://forth-standard.org/standard/core/StoD" class="bare">https://forth-standard.org/standard/core/StoD</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>s\"</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( "string"&#8201;&#8212;&#8201;)(&#8201;&#8212;&#8201;addr u ) "Store string in memory"
<a href="https://forth-standard.org/standard/core/Seq" class="bare">https://forth-standard.org/standard/core/Seq</a>
Store address and length of string given, returning ( addr u ).
ANS core claims this is compile-only, but the file set expands it
to be interpreted, so it is a state-sensitive word, which in theory
are evil. We follow general usage. This is just like S" except
that it allows for some special escaped characters.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>save-buffers</code>
</td>
<td class="hdlist2">
<p><em>ANS block</em> (&#8201;&#8212;&#8201;) "Save all dirty buffers to storage"
<a href="https://forth-standard.org/standard/block/SAVE-BUFFERS" class="bare">https://forth-standard.org/standard/block/SAVE-BUFFERS</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>scr</code>
</td>
<td class="hdlist2">
<p><em>ANS block ext</em> (&#8201;&#8212;&#8201;addr ) "Push address of variable holding last screen listed"
<a href="https://forth-standard.org/standard/block/SCR" class="bare">https://forth-standard.org/standard/block/SCR</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>search</code>
</td>
<td class="hdlist2">
<p><em>ANS string</em> ( addr1 u1 addr2 u2&#8201;&#8212;&#8201;addr3 u3 flag) "Search for a substring"
<a href="https://forth-standard.org/standard/string/SEARCH" class="bare">https://forth-standard.org/standard/string/SEARCH</a>
Search for string2 (denoted by addr2 u2) in string1 (denoted by
addr1 u1). If a match is found the flag will be true and
addr3 will have the address of the start of the match and u3 will have
the number of characters remaining from the match point to the end
of the original string1. If a match is not found, the flag will be
false and addr3 and u3 will be the original string1&#8217;s addr1 and u1.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>search-wordlist</code>
</td>
<td class="hdlist2">
<p><em>ANS search</em> ( caddr u wid&#8201;&#8212;&#8201;0 | xt 1 | xt -1) "Search for a word in a wordlist"
<a href="https://forth-standard.org/standard/search/SEARCH_WORDLIST" class="bare">https://forth-standard.org/standard/search/SEARCH_WORDLIST</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>see</code>
</td>
<td class="hdlist2">
<p><em>ANS tools</em> ( "name"&#8201;&#8212;&#8201;) "Print information about a Forth word"
<a href="https://forth-standard.org/standard/tools/SEE" class="bare">https://forth-standard.org/standard/tools/SEE</a>
SEE takes the name of a word and prints its name token (nt),
execution token (xt), size in bytes, flags used, and then dumps the
code and disassembles it.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>set-current</code>
</td>
<td class="hdlist2">
<p><em>ANS search</em> ( wid&#8201;&#8212;&#8201;) "Set the compilation wordlist"
<a href="https://forth-standard.org/standard/search/SET-CURRENT" class="bare">https://forth-standard.org/standard/search/SET-CURRENT</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>set-order</code>
</td>
<td class="hdlist2">
<p><em>ANS search</em> ( wid_n .. wid_1 n&#8201;&#8212;&#8201;) "Set the current search order"
<a href="https://forth-standard.org/standard/search/SET-ORDER" class="bare">https://forth-standard.org/standard/search/SET-ORDER</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>sign</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n&#8201;&#8212;&#8201;) "Add minus to pictured output"
<a href="https://forth-standard.org/standard/core/SIGN" class="bare">https://forth-standard.org/standard/core/SIGN</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>sliteral</code>
</td>
<td class="hdlist2">
<p><em>ANS string</em> ( addr u&#8201;&#8212;&#8201;)(&#8201;&#8212;&#8201;addr u ) "Compile a string for runtime"
<a href="https://forth-standard.org/standard/string/SLITERAL" class="bare">https://forth-standard.org/standard/string/SLITERAL</a>
Add the runtime for an existing string.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>sm/rem</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( d n1&#8201;&#8212;&#8201;n2 n3 ) "Symmetic signed division"
<a href="https://forth-standard.org/standard/core/SMDivREM" class="bare">https://forth-standard.org/standard/core/SMDivREM</a>
Symmetic signed division. Compare FM/MOD. Based on F-PC 3.6
by Ulrich Hoffmann. See <a href="http://www.xlerb.de/uho/ansi.seq" class="bare">http://www.xlerb.de/uho/ansi.seq</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>source</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;addr u ) "Return location and size of input buffer""
<a href="https://forth-standard.org/standard/core/SOURCE" class="bare">https://forth-standard.org/standard/core/SOURCE</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>source-id</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> (&#8201;&#8212;&#8201;n ) "Return source identifier"
<a href="https://forth-standard.org/standard/core/SOURCE-ID" class="bare">https://forth-standard.org/standard/core/SOURCE-ID</a> Identify the
input source unless it is a block (s. Conklin &amp; Rather p. 156). This
will give the input source: 0 is keyboard, -1 ($FFFF) is character
string, and a text file gives the fileid.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>space</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;) "Print a single space"
<a href="https://forth-standard.org/standard/core/SPACE" class="bare">https://forth-standard.org/standard/core/SPACE</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>spaces</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( u&#8201;&#8212;&#8201;) "Print a number of spaces"
<a href="https://forth-standard.org/standard/core/SPACES" class="bare">https://forth-standard.org/standard/core/SPACES</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>state</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;addr ) "Return the address of compilation state flag"
<a href="https://forth-standard.org/standard/core/STATE" class="bare">https://forth-standard.org/standard/core/STATE</a>
STATE is true when in compilation state, false otherwise. Note
we do not return the state itself, but only the address where
it lives. The state should not be changed directly by the user; see
<a href="http://forth.sourceforge.net/standard/dpans/dpans6.htm#6.1.2250" class="bare">http://forth.sourceforge.net/standard/dpans/dpans6.htm#6.1.2250</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>strip-underflow</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;addr ) "Return address where underflow status is kept"
<code>STRIP-UNDERFLOW</code> is a flag variable that determines if underflow
checking should be removed during the compilation of new words.
Default is false.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>swap</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( b a&#8201;&#8212;&#8201;a b ) "Exchange TOS and NOS"
<a href="https://forth-standard.org/standard/core/SWAP" class="bare">https://forth-standard.org/standard/core/SWAP</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>then</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (C: orig&#8201;&#8212;&#8201;) (&#8201;&#8212;&#8201;) "Conditional flow control"
<a href="http://forth-standard.org/standard/core/THEN" class="bare">http://forth-standard.org/standard/core/THEN</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>thru</code>
</td>
<td class="hdlist2">
<p><em>ANS block ext</em> ( scr# scr#&#8201;&#8212;&#8201;) "Load screens in the given range"
<a href="https://forth-standard.org/standard/block/THRU" class="bare">https://forth-standard.org/standard/block/THRU</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>to</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( n "name"&#8201;&#8212;&#8201;) or ( "name") "Change a value"
<a href="https://forth-standard.org/standard/core/TO" class="bare">https://forth-standard.org/standard/core/TO</a>
Gives a new value to a, uh, VALUE.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>true</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> (&#8201;&#8212;&#8201;f ) "Push TRUE flag to Data Stack"
<a href="https://forth-standard.org/standard/core/TRUE" class="bare">https://forth-standard.org/standard/core/TRUE</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>tuck</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( b a&#8201;&#8212;&#8201;a b a ) "Copy TOS below NOS"
<a href="https://forth-standard.org/standard/core/TUCK" class="bare">https://forth-standard.org/standard/core/TUCK</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>type</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( addr u&#8201;&#8212;&#8201;) "Print string"
<a href="https://forth-standard.org/standard/core/TYPE" class="bare">https://forth-standard.org/standard/core/TYPE</a>
Works through EMIT to allow OUTPUT revectoring.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>u.</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( u&#8201;&#8212;&#8201;) "Print TOS as unsigned number"
<a href="https://forth-standard.org/standard/core/Ud" class="bare">https://forth-standard.org/standard/core/Ud</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>u.r</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( u u&#8201;&#8212;&#8201;) "Print NOS as unsigned number right-justified with TOS width"
<a href="https://forth-standard.org/standard/core/UDotR" class="bare">https://forth-standard.org/standard/core/UDotR</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>u&lt;</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n m&#8201;&#8212;&#8201;f ) "Return true if NOS &lt; TOS (unsigned)"
<a href="https://forth-standard.org/standard/core/Uless" class="bare">https://forth-standard.org/standard/core/Uless</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>u&gt;</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( n m&#8201;&#8212;&#8201;f ) "Return true if NOS &gt; TOS (unsigned)"
<a href="https://forth-standard.org/standard/core/Umore" class="bare">https://forth-standard.org/standard/core/Umore</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ud.</code>
</td>
<td class="hdlist2">
<p><em>Tali double</em> ( d&#8201;&#8212;&#8201;) "Print double as unsigned"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ud.r</code>
</td>
<td class="hdlist2">
<p><em>Tali double</em> ( d u&#8201;&#8212;&#8201;) "Print unsigned double right-justified u wide"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>um*</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( u u&#8201;&#8212;&#8201;ud ) "Multiply 16 x 16 &#8594; 32"
<a href="https://forth-standard.org/standard/core/UMTimes" class="bare">https://forth-standard.org/standard/core/UMTimes</a>
Multiply two unsigned 16 bit numbers, producing a 32 bit result.
Old Forth versions such as FIG Forth call this U*</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>um/mod</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( ud u&#8201;&#8212;&#8201;ur u ) "32/16 &#8594; 16 division"
<a href="https://forth-standard.org/standard/core/UMDivMOD" class="bare">https://forth-standard.org/standard/core/UMDivMOD</a>
Divide double cell number by single cell number, returning the
quotient as TOS and any remainder as NOS. All numbers are unsigned.
This is the basic division operation all others use. Based on FIG
Forth code, modified by Garth Wilson, see
<a href="http://6502.org/source/integers/ummodfix/ummodfix.htm" class="bare">http://6502.org/source/integers/ummodfix/ummodfix.htm</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>unloop</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (&#8201;&#8212;&#8201;)(R: n1 n2 n3 ---) "Drop loop control from Return stack"
<a href="https://forth-standard.org/standard/core/UNLOOP" class="bare">https://forth-standard.org/standard/core/UNLOOP</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>until</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> (C: dest&#8201;&#8212;&#8201;) (&#8201;&#8212;&#8201;) "Loop flow control"
<a href="http://forth-standard.org/standard/core/UNTIL" class="bare">http://forth-standard.org/standard/core/UNTIL</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>unused</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> (&#8201;&#8212;&#8201;u ) "Return size of space available to Dictionary"
<a href="https://forth-standard.org/standard/core/UNUSED" class="bare">https://forth-standard.org/standard/core/UNUSED</a>
UNUSED does not include the ACCEPT history buffers. Total RAM
should be HERE + UNUSED + &lt;history buffer size&gt;, the last of which
defaults to $400</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>update</code>
</td>
<td class="hdlist2">
<p><em>ANS block</em> (&#8201;&#8212;&#8201;) "Mark current block as dirty"
<a href="https://forth-standard.org/standard/block/UPDATE" class="bare">https://forth-standard.org/standard/block/UPDATE</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>useraddr</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> (&#8201;&#8212;&#8201;addr ) "Push address of base address of user variables"</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>value</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n "name"&#8201;&#8212;&#8201;) "Define a value"
<a href="https://forth-standard.org/standard/core/VALUE" class="bare">https://forth-standard.org/standard/core/VALUE</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>variable</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( "name"&#8201;&#8212;&#8201;) "Define a variable"
<a href="https://forth-standard.org/standard/core/VARIABLE" class="bare">https://forth-standard.org/standard/core/VARIABLE</a>
There are various Forth definitions for this word, such as
<code>CREATE 1 CELLS ALLOT</code>  or  <code>CREATE 0 ,</code>  We use a variant of the
second one so the variable is initialized to zero</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>while</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( C: dest&#8201;&#8212;&#8201;orig dest ) ( x&#8201;&#8212;&#8201;) "Loop flow control"
<a href="http://forth-standard.org/standard/core/WHILE" class="bare">http://forth-standard.org/standard/core/WHILE</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>within</code>
</td>
<td class="hdlist2">
<p><em>ANS core ext</em> ( n1 n2 n3&#8201;&#8212;&#8201;) "See if within a range"
<a href="https://forth-standard.org/standard/core/WITHIN" class="bare">https://forth-standard.org/standard/core/WITHIN</a></p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>word</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( char "name "&#8201;&#8212;&#8201;caddr ) "Parse input stream"
<a href="https://forth-standard.org/standard/core/WORD" class="bare">https://forth-standard.org/standard/core/WORD</a>
Obsolete parsing word included for backwards compatibility only.
Do not use this, use <code>PARSE</code> or <code>PARSE-NAME</code>. Skips leading delimiters
and copies word to storage area for a maximum size of 255 bytes.
Returns the result as a counted string (requires COUNT to convert
to modern format), and inserts a space after the string. See "Forth
Programmer&#8217;s Handbook" 3rd edition p. 159 and
<a href="http://www.forth200x.org/documents/html/rationale.html#rat:core:PARSE" class="bare">http://www.forth200x.org/documents/html/rationale.html#rat:core:PARSE</a>
for discussions of why you shouldn&#8217;t be using WORD anymore.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>wordlist</code>
</td>
<td class="hdlist2">
<p><em>ANS search</em> (&#8201;&#8212;&#8201;wid ) "Create new wordlist (from pool of 8)"
<a href="https://forth-standard.org/standard/search/WORDLIST" class="bare">https://forth-standard.org/standard/search/WORDLIST</a>
See the tutorial on Wordlists and the Search Order for
more information.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>words</code>
</td>
<td class="hdlist2">
<p><em>ANS tools</em> (&#8201;&#8212;&#8201;) "Print known words from Dictionary"
<a href="https://forth-standard.org/standard/tools/WORDS" class="bare">https://forth-standard.org/standard/tools/WORDS</a>
This is pretty much only used at the command line so we can
be slow and try to save space.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>wordsize</code>
</td>
<td class="hdlist2">
<p><em>Tali Forth</em> ( nt&#8201;&#8212;&#8201;u ) "Get size of word in bytes"
Given an word&#8217;s name token (nt), return the size of the
word&#8217;s payload size in bytes (CFA plus PFA) in bytes. Does not
count the final RTS.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>xor</code>
</td>
<td class="hdlist2">
<p><em>ANS core</em> ( n n&#8201;&#8212;&#8201;n ) "Logically XOR TOS and NOS"
<a href="https://forth-standard.org/standard/core/XOR" class="bare">https://forth-standard.org/standard/core/XOR</a></p>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reporting_problems">Reporting Problems</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The best way to point out a bug or make any other form of a comment is on Tali
Forth&#8217;s page on GitHub at <a href="https://github.com/scotws/TaliForth2" class="bare">https://github.com/scotws/TaliForth2</a> There, you can
"open an issue", which allows other people who might have the same problem to
help even when the author is not available.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_faq">FAQ</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">What happened to Tali Forth 1 anyway?</dt>
<dd>
<p>Tali Forth 1, informally just Tali Forth, was my first Forth.
As such, it is fondly remembered as a learning experience. You can still find
it online at GitHub at <a href="https://github.com/scotws/TaliForth" class="bare">https://github.com/scotws/TaliForth</a>. When
Tali Forth 2 entered BETA, Tali Forth was discontinued. It does not
receive bug fixes. In fact, new bugs are not even documented.</p>
</dd>
</dl>
</div>
<div id="img_talialpha" class="imageblock" style="text-align: center">
<div class="content">
<img src="pics/tali_forth_alpha003.png" alt="tali forth alpha003">
</div>
<div class="title">Figure 4. Screenshot of the Tali Forth 1 boot screen, version Alpha 3, April 2014</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Who&#8217;s "Tali"?</dt>
<dd>
<p>I like the name, and we&#8217;re probably not going to have any more kids I can give
it to. If it sounds vaguely familiar, you&#8217;re probably thinking of Tali&#8217;Zorah vas
Normandy a character in the <em>Mass
Effect</em>  universe created by BioWare. This
software has absolutely nothing to do with neither the game nor the companies and
neither do I, expect that I&#8217;ve played the whole series and enjoyed it.<sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnote_5" title="View footnote.">5</a>]</sup></p>
</dd>
<dt class="hdlist1">And who is "Liara"?</dt>
<dd>
<p>Liara Forth is another STC Forth for the big sibling of the 6502, the
65816. Tali Forth 1 came first, then I wrote Liara
with that knowledge and learned even more, and now Tali 2 is such much better
for the experience. And yes, it&#8217;s another <em>Mass Effect</em> 
character.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_tali_forth_2">Testing Tali Forth 2</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tali Forth 2 comes with a test suite in the <code>tests</code> folder. It is
based on the official ANS test code by John Hayes and was
first adapted for Tali Forth by Sam Colwell.</p>
</div>
<div class="paragraph">
<p>To run the complete test, type <code>make test</code> from the main folder (this assumes a
Unix-type system). Alternatively, switch to the test folder and start the
<code>talitest.py</code>  program with Python3. The tests should take only
a very few minutes to run and produce a lot of output, including, at the end, a
list of words that didn&#8217;t work. A detailed list of results is saved to the file
<code>results.txt</code>. </p>
</div>
<div class="sect2">
<h3 id="_user_tests">User Tests</h3>
<div class="paragraph">
<p>A special test file named <code>user.fs</code>  is available for users to add
their own tests.  The results of this will be found just before the cycle
tests near the end of <code>results.txt</code>.  To run only this set of tests, you can
use the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>./talitest.py -t user</code></pre>
</div>
</div>
<div class="paragraph">
<p>in the tests folder.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cycle_tests">Cycle Tests</h3>
<div class="paragraph">
<p>The last set of tests, found in <code>cycles.fs</code>, determines cycle counts for the
various built-in words.  Users who are adding words may want to add cycle
tests as well and there are instructions for doing that in that file.  The
cycle tests only work with the simulator and will not work on real hardware.</p>
</div>
<div class="paragraph">
<p>The cycle tests time (in 65C02 clock cycles) from the jsr that calls a word to
the rts that returns from the word, including the jsr and rts.  These cycle
counts are the number of cycles if the word was used directly in interpreted
mode.  Some words will use more or fewer cycles depending on their input, so
the cycles reported are for the input provided in the <code>cycles.fs</code> file.</p>
</div>
<div class="paragraph">
<p>The cycle tests work with some help from the py65mon simulator and extensions
to it in <code>talitest.py</code>.  Accesses to special addresses in the 65C02 memory map
are used to start, stop, and read back the cycle counter in the simulator.
A special word named <code>cycle_test</code> is created near the top of <code>cycles.fs</code> to
help with this.  It accepts the xt of the word you want to test (you
can get the xt of any word by using the word <code>'</code>) and runs that word with the special memory
accesses before and after, printing out the results.</p>
</div>
<div class="sect3">
<h4 id="_cycle_tests_and_native_compiling">Cycle Tests and Native Compiling</h4>
<div class="paragraph">
<p>Because Tali Forth 2 has native compiling capability, small words used in a
word declaration will have their assembly code compiled directly into the word
being defined, rather than using a <code>jsr</code>.  This means that small words will not
have the overhead of a <code>jsr</code> and <code>rts</code> when they are compiled into other words.</p>
</div>
<div class="paragraph">
<p>A perfect example of that is the built-in word <code>ALIGN</code>.  This word has no
assembly instructions (except for an <code>rts</code>), but the cycle testing shows it
takes 12 cycles.  This is the number of cycles to run the word by itself, and
it&#8217;s the number of cycles to run a <code>jsr</code> instruction followed immediately by
an <code>rts</code> instruction.</p>
</div>
<div class="paragraph">
<p>When this word is compiled into another word, however, Tali will use native
compiling and will put the (empty) body of this word into the word being
compiled rather than using a <code>jsr</code>.  This results in 0 extra cycles for the
word being defined.  Twelve cycles will be saved for each small word that is
natively compiled into a new definition.  See the section on Native Compiling
for more information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_old_tests">Old Tests</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
During early development, testing was done by hand with a list of words that has
since been placed in the <code>old</code>  folder. These tests might be still useful if you
are in the very early stages of developing your own Forth.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_simpler_assembler_notation_san_format">The Simpler Assembler Notation (SAN) format</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is a condensed version of the main SAN Guide at
<a href="https://github.com/scotws/SAN" class="bare">https://github.com/scotws/SAN</a> , see there for more detail.)
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_background">Background</h3>
<div class="paragraph">
<p>The Simpler Assembler Notation (SAN) for the 6502/65c02/65816 family of CPUs
cleanly separates the opcode and the operand in an assembler instruction. For
instance, the traditional notation</p>
</div>
<div class="listingblock">
<div class="content">
<pre>STA 1000,X</pre>
</div>
</div>
<div class="paragraph">
<p>adds the marker for the X-indexed mode to the operand. Though this is not hard
to read or use for the programmer on the 65c02, it makes building asssemblers
and disassemblers harder. SAN keeps the mnemonic&#8217;s "stem" - <code>STA</code> in this case -
though it is converted to lower case. The mode is added as a "suffix" after a
single dot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sta.x 1000</pre>
</div>
</div>
<div class="paragraph">
<p>In a Forth environment, this lets us trivially switch the notation to
postfix. The operand is pushed to the stack like any normal number, and the
mnemonic is a simple Forth word that picks it up there.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1000 sta.x</pre>
</div>
</div>
<div class="paragraph">
<p>As part of SAN, Zero Page modes are explicitly indicated with a <code>z</code> in the
suffix. This removes any confusion that can come from</p>
</div>
<div class="listingblock">
<div class="content">
<pre>STA 10          ; zero page addressing, two-byte instruction
STA 0010        ; absolut addressing, three-byte instruction
STA 010         ; really not sure what will happen</pre>
</div>
</div>
<div class="paragraph">
<p>by replacing the instruction with (prefix notation):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sta 10          ; absolute addressing, three-byte instruction
sta.z 10        ; zero page addressing, two-byte instruction</pre>
</div>
</div>
<div class="paragraph">
<p>SAN was originally invented to fix various issues with the traditional mnemonics
for the 65816. The advantages for the 65c02 outside a specialized environment
such as a small Forth assembler here are limited at best.</p>
</div>
</div>
<div class="sect2">
<h3 id="_complete_list_of_65c02_addressing_modes">Complete list of 65c02 addressing modes</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Mode</th>
<th class="tableblock halign-left valign-top">Traditional Notation</th>
<th class="tableblock halign-left valign-top">SAN (Forth Postfix)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implied</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEX</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dex</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Absolute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LDA $1000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1000 lda</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accumulator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INC A</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inc.a</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Immediate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LDA #$00</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>00 lda.#</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Absolute X indexed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LDA $1000,X</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1000 lda.x</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Absolute Y indexed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LDA $1000,Y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1000 lda.y</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Absolute indirect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JMP ($1000)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1000 jmp.i</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indexed indirect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JMP ($1000,X)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1000 jmp.xi</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zero Page (DP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LDA $10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10 lda.z</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zero Page X indexed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LDA $10,X</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10 lda.zx</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zero Page Y indexed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LDX $10,Y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10 ldx.zy`</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zero Page indirect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LDA ($10)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10 lda.zi</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZP indirect X indexed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LDA ($10,X)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10 lda.zxi</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZP indirect Y indexed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LDA ($10),Y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10 lda.ziy</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BRA &lt;LABEL&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;LABEL&gt; bra</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note for indirect modes, the <code>i</code> in the suffix is at the same relative position
to the index register X or Y as the closing bracket is in the traditional mode.
This way, <code>LDA ($10,X)</code> turns into <code>lda.zxi 10</code> in postfix SAN, while <code>LDA
($10),Y</code> will be <code>lda.ziy 10</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_thanks">Thanks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tali Forth would never have been possible without the help of a very large
number of people, very few of whom I have actually met.</p>
</div>
<div class="paragraph">
<p>First, there is the crew at <a href="http://6502.org">6502.org</a> who not
only helped me build my own actual, working 6502 computer, but also introduced
me to Forth. Tali would not exist without their inspiration, support, and
feedback.</p>
</div>
<div class="paragraph">
<p>Special thanks go out to Mike Barry and Lee
Pivonka, who both suggested vast improvements to the code
in size, structure, and speed. And then there is Sam Colwell
who contributed the invaluable test suite and a whole lot of code.</p>
</div>
<div class="paragraph">
<p>Thank you, everybody.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references_and_further_reading">References and Further Reading</h2>
<div class="sectionbody">
<div class="paragraph">
<p>[<a id="FB"></a>] <em>Masterminds of Programming</em>, Federico Biancuzzi,
O&#8217;Reilly Media 1st edition, 2009.</p>
</div>
<div class="paragraph">
<p>[<a id="CHM1"></a>] "Charles H. Moore: Geek of the Week", redgate Hub 2009
<a href="https://www.red-gate.com/simple-talk/opinion/geek-of-the-week/chuck-moore-geek" class="bare">https://www.red-gate.com/simple-talk/opinion/geek-of-the-week/chuck-moore-geek</a></p>
</div>
<div class="paragraph">
<p>[<a id="CHM2"></a>] "The Evolution of FORTH, an Unusual Language", Charles H. Moore,
<em>Byte</em> 1980, <a href="https://wiki.forth-ev.de/doku.php/projects:the_evolution_of_forth" class="bare">https://wiki.forth-ev.de/doku.php/projects:the_evolution_of_forth</a></p>
</div>
<div class="paragraph">
<p>[<a id="CnR"></a>] <em>Forth Programmer&#8217;s Handbook</em>, Edward K. Conklin and Elizabeth Rather,
3rd edition 2010</p>
</div>
<div class="paragraph">
<p>[<a id="DB"></a>] <em>Forth Enzyclopedia</em>, Mitch Derick and Linda Baker,
Mountain View Press 1982</p>
</div>
<div class="paragraph">
<p>[<a id="DH"></a>] "Some notes on Forth from a novice user", Douglas Hoffman, Feb 1988
<a href="https://wiki.forth-ev.de/doku.php/projects:some_notes_on_forth_from_a_novice_user" class="bare">https://wiki.forth-ev.de/doku.php/projects:some_notes_on_forth_from_a_novice_user</a></p>
</div>
<div class="paragraph">
<p>[<a id="DMR"></a>] "Reflections on Software Research", Dennis M. Ritchie, Turing Award
Lecture in <em>Communications of the ACM</em> August 1984 Volume 27 Number 8
<a href="http://www.valleytalk.org/wp-content/uploads/2011/10/p758-ritchie.pdf" class="bare">http://www.valleytalk.org/wp-content/uploads/2011/10/p758-ritchie.pdf</a></p>
</div>
<div class="paragraph">
<p>[<a id="EnL"></a>] <em>Programming the 65816, including the 6502, 65C02 and 65802</em>,
David Eyes and Ron Lichty
(Currently not available from the WDC website)</p>
</div>
<div class="paragraph">
<p>[<a id="EW"></a>] "Forth: The Hacker&#8217;s Language", Elliot Williams,
<a href="https://hackaday.com/2017/01/27/forth-the-hackers-language/" class="bare">https://hackaday.com/2017/01/27/forth-the-hackers-language/</a></p>
</div>
<div class="paragraph">
<p>[<a id="GK"></a>] "Forth System Comparisons", Guy Kelly, in <em>Forth Dimensions</em> V13N6,
March/April 1992
<a href="http://www.forth.org/fd/FD-V13N6.pdf}{http://www.forth.org/fd/FD-V13N6.pdf" class="bare">http://www.forth.org/fd/FD-V13N6.pdf}{http://www.forth.org/fd/FD-V13N6.pdf</a></p>
</div>
<div class="paragraph">
<p>[<a id="JN"></a>] <em>A Beginner&#8217;s Guide to Forth</em>, J.V. Nobel,
<a href="http://galileo.phys.virginia.edu/classes/551.jvn.fall01/primer.htm" class="bare">http://galileo.phys.virginia.edu/classes/551.jvn.fall01/primer.htm</a></p>
</div>
<div class="paragraph">
<p>[<a id="BWK"></a>] <em>A Tutorial Introduction to the UNIX Text Editor</em>, B. W. Kernighan,
<a href="http://www.psue.uni-hannover.de/wise2017_2018/material/ed.pdf" class="bare">http://www.psue.uni-hannover.de/wise2017_2018/material/ed.pdf</a></p>
</div>
<div class="paragraph">
<p>[<a id="LB1"></a>] <em>Starting Forth</em>, Leo Brodie, new edition 2003,
<a href="https://www.forth.com/starting-forth/}{https://www.forth.com/starting-forth/" class="bare">https://www.forth.com/starting-forth/}{https://www.forth.com/starting-forth/</a></p>
</div>
<div class="paragraph">
<p>[<a id="LB2"></a>] <em>Thinking Forth</em>, Leo Brodie, 1984,
<a href="http://thinking-forth.sourceforge.net/\#21CENTURY" class="bare">http://thinking-forth.sourceforge.net/\#21CENTURY</a></p>
</div>
<div class="paragraph">
<p>[<a id="LL"></a>] <em>6502 Assembly Language Programming</em>, Lance A. Leventhal,
OSBORNE/McGRAW-HILL 1979</p>
</div>
<div class="paragraph">
<p>[<a id="PHS"></a>] "The Daemon, the Gnu and the Penguin", Peter H. Saulus,
22. April 2005, <a href="http://www.groklaw.net/article.php?story=20050422235450910" class="bare">http://www.groklaw.net/article.php?story=20050422235450910</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_colophon">Colophon</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Tali Forth 2 Manual was written with the <a href="https://www.vim.org/">vim</a> editor in
<a href="https://asciidoctor.org/docs/what-is-asciidoc/">AsciiDoc</a> format, formatted to
HTML with AsciiDoctor, and version controlled with <a href="https://git-scm.com/">Git</a>, all
under <a href="https://www.ubuntu.com/">Ubuntu</a> Linux 16.04 LTS.</p>
</div>
<div class="paragraph">
<p>Authors' names are listed alphabetically based on last name.</p>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. Rumor has it that there was another MPU called "Z80", but it ended up being a mere footnote.
</div>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. If you&#8217;re going to quit anyway, speed can&#8217;t be that important
</div>
<div class="footnote" id="_footnote_3">
<a href="#_footnoteref_3">3</a>. Try reading that last sentence to a friend who isn&#8217;t into computers. Aren&#8217;t abbreviations fun?
</div>
<div class="footnote" id="_footnote_4">
<a href="#_footnoteref_4">4</a>. All quotes in the <code>ed</code> tutorial are taken from the <em>Mass Effect</em> games by BioWare/EA. As stated already, they hold the rights to all characters and whatnot.
</div>
<div class="footnote" id="_footnote_5">
<a href="#_footnoteref_5">5</a>. Though I do wish they would tell us what happened to the quarian ark in <em>Andromeda</em>.
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0<br>
Last updated 2019-01-12 16:01:50 EST
</div>
</div>
</body>
</html>